

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Python &amp; Chill</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'README';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
  
    <p class="title logo__title">None</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    Python & Chill
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">















</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/baniasbaabe/delightful-data-science" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/baniasbaabe/delightful-data-science/issues/new?title=Issue%20on%20page%20%2FREADME.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Python & Chill</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/index">1. Code Quality</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/automation">1.1. Automation</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/cicd">1.2. CI/CD</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/codestyle">1.3. Code Style</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/memory">1.4. Memory Optimization</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/security">1.5. Security in Projects</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/typing">1.6. Typing</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/principles">1.7. Principles for Code Quality</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/cooltools/index">2. Cool Tools</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/cooltools/Chapter">2.1. Cool Tools</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/jupyternotebook/index">3. Jupyter Notebook Tricks and Tips</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/jupyternotebook/Chapter">3.1. Jupyter Notebook Tips and Tricks</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/documentation/index">4. Documentation</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/documentation/Chapter">4.1. Documentation</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/index">5. Machine Learning</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/dataaugmentation">5.1. Data Augmentation</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/deployment">5.2. Deployment</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/eda">5.3. EDA</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/featureselection">5.4. Feature Selection</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/getdata">5.5. Get Data</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/modeltraining">5.6. Model Training</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/outlierdetection">5.7. Outlier Detection</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/timeseries">5.8. Time Series</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/preprocessing">5.9. Preprocessing</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/llm/index">6. LLM</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/llm/Chapter">6.1. LLM</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/numpy/index">7. NumPy Tips and Tricks</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/numpy/Chapter">7.1. NumPy Tips and Tricks</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pandas/index">8. Pandas Tricks and Tips</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pandas/Chapter">8.1. Pandas Tips and Tricks</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pandas/additionallibs">8.2. Utility Libraries for Pandas</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/polars/index">9. Polars</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/polars/Chapter">9.1. Polars Tips &amp; Tricks</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pythontricks/index">10. Python Tips and Tricks</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pythontricks/Chapter">10.1. Pure Python + Built-in libraries</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pythontricks/utility">10.2. Utilities for Python</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pythontricks/tooling">10.3. Tooling for Python Projects</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/selenium/index">11. Scraping Tips and Tricks</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/selenium/Chapter">11.1. Scraping Tips and Tricks</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/terraform/index">12. Terraform</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/terraform/Chapter">12.1. Terraform</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/testing/index">13. Testing in Python</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/testing/Chapter">13.1. Testing</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/sql/index">14. SQL Tips &amp; Tricks</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/sql/Chapter">14.1. SQL Tips &amp; Tricks</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/Miscellaneous/index">15. Miscellaneous</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/Miscellaneous/Chapter">15.1. Miscellaneous</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div align="center">
<a href="https://github.com/baniasbaabe/delightful-data-science">
<a class="reference internal image-reference" href="_images/cover.png"><img alt="Delightful Data Science Logo" class="align-center" src="_images/cover.png" style="width: 152px; height: 221px;" /></a>
</a>
</div>
<section id="python-chill">
<h1>Python &amp; Chill<a class="headerlink" href="#python-chill" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://github.com/baniasbaabe/delightful-data-science"><img alt="View on GitHub" src="https://img.shields.io/badge/GitHub-View_on_GitHub-blue?logo=GitHub" /></a> <a class="reference external" href="https://baniasbaabe.github.io/delightful-data-science/README.html"><img alt="View Book" src="https://img.shields.io/badge/Book-View%20Book-red?style=plastic&amp;logo=book" /></a></p>
<section id="why-this-book-exists">
<h2>Why this Book exists<a class="headerlink" href="#why-this-book-exists" title="Permalink to this heading">#</a></h2>
<p>It was December 2022 when I started writing daily LinkedIn posts sharing one short Python/Data Science tip per day. My main goal was to share what I learnt over the years (and what I am currently learning) with others. I thought “When it’s useful for me, it will be probably useful for other people too”.</p>
<p>As time went by, more and more people found the tips useful. Soon, I realized that these daily tips could be compiled into a comprehensive guide for anyone interested in becoming better Data Scientist.</p>
<p>Thus, the idea for “Python &amp; Chill” was born. The book contains all the tips shared by the author on LinkedIn, as well as many more to come in the future.</p>
</section>
<div class="toctree-wrapper compound">
<span id="document-book/codequality/index"></span><section id="code-quality">
<h2><span class="section-number">1. </span>Code Quality<a class="headerlink" href="#code-quality" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/codequality/automation"></span><section id="automation">
<h3><span class="section-number">1.1. </span>Automation<a class="headerlink" href="#automation" title="Permalink to this heading">#</a></h3>
<section id="automate-bash-commands-with-makefile">
<h4><span class="section-number">1.1.1. </span>Automate Bash Commands with <code class="docutils literal notranslate"><span class="pre">Makefile</span></code><a class="headerlink" href="#automate-bash-commands-with-makefile" title="Permalink to this heading">#</a></h4>
<p>Do you struggle to remember the exact series of commands needed to build and package a Python project?</p>
<p>Or manually running tests and installing dependencies?</p>
<p><code class="docutils literal notranslate"><span class="pre">Makefile</span></code> to the rescue!</p>
<p>A <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> can be used to automate bash commands and have a standardized way to execute those.</p>
<p>See below for how we define commands for testing, install our dependencies, and format our code with black.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a file named Makefile</span>
<span class="c1"># Makefile</span>

<span class="n">install</span><span class="p">:</span>
    <span class="nd">@echo</span> <span class="s2">&quot;Installing requirements ...&quot;</span>
    <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span> <span class="o">--</span><span class="n">quiet</span>

<span class="n">test</span><span class="p">:</span>
    <span class="nd">@echo</span> <span class="s2">&quot;Testing ...&quot;</span>
    <span class="n">pytest</span>

<span class="nb">format</span><span class="p">:</span>
    <span class="nd">@echo</span> <span class="s2">&quot;Formatting ...&quot;</span>
    <span class="n">black</span> <span class="o">.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="automate-testing-with-nox">
<h4><span class="section-number">1.1.2. </span>Automate Testing with Nox<a class="headerlink" href="#automate-testing-with-nox" title="Permalink to this heading">#</a></h4>
<p>Testing your code against multiple Python Versions is hard.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">Nox</span></code>, you can automate this step!</p>
<p><code class="docutils literal notranslate"><span class="pre">Nox</span></code> is a command-line tool to automate testing in multiple Python Environments locally.</p>
<p>You can customize the sessions with a Python script.</p>
<p>See the example below, where we define a session (𝐭𝐞𝐬𝐭𝐬) in our 𝐧𝐨𝐱𝐟𝐢𝐥𝐞.𝐩𝐲 and define the Python versions we want to test against. Moreover we set up another session (𝐥𝐢𝐧𝐭) to run flake8 against our code.</p>
<p><code class="docutils literal notranslate"><span class="pre">Nox</span></code> is highly customizable, so check out their documentation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># noxfile.py</span>

<span class="kn">import</span> <span class="nn">nox</span>

<span class="nd">@nox</span><span class="o">.</span><span class="n">session</span><span class="p">(</span><span class="n">python</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="s2">&quot;3.7&quot;</span><span class="p">,</span> <span class="s2">&quot;3.8&quot;</span><span class="p">,</span> <span class="s2">&quot;3.9&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">tests</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="c1"># Install testing dependency</span>
    <span class="n">session</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="s1">&#39;pytest&#39;</span><span class="p">)</span>
    <span class="c1"># Run tests</span>
    <span class="n">session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;pytest&#39;</span><span class="p">)</span>
    
<span class="nd">@nox</span><span class="o">.</span><span class="n">session</span>
<span class="k">def</span> <span class="nf">lint</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="n">session</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="s2">&quot;flake8&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;flake8&quot;</span><span class="p">,</span> <span class="s2">&quot;example.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install nox
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!nox
</pre></div>
</div>
</div>
</div>
</section>
<section id="update-your-dependencies-automatically-with-pyup">
<h4><span class="section-number">1.1.3. </span>Update Your Dependencies Automatically with <code class="docutils literal notranslate"><span class="pre">pyup</span></code><a class="headerlink" href="#update-your-dependencies-automatically-with-pyup" title="Permalink to this heading">#</a></h4>
<p>Do you need an easy way to update your project’s dependencies?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">pyup</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pyup</span></code> goes through your dependency files and searches for new package versions.</p>
<p>It will then create a new branch in your repository, a new commit for every update and a pull request containing all commits.</p>
<p>You only need to provide an access token (from GitHub or GitLab) and the repository name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pyupio
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pyup --repo=username/repo --user-token=&lt;YOUR_TOKEN&gt; --initial # After running the first time, you can remove the --initial flag
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># gitlab.com:
!pyup --provider gitlab --repo=username/repo --user-token=&lt;YOUR_TOKEN&gt;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/codequality/cicd"></span><section id="ci-cd">
<h3><span class="section-number">1.2. </span>CI/CD<a class="headerlink" href="#ci-cd" title="Permalink to this heading">#</a></h3>
<section id="test-github-actions-workflows-locally-with-act">
<h4><span class="section-number">1.2.1. </span>Test GitHub Actions Workflows Locally with <code class="docutils literal notranslate"><span class="pre">act</span></code><a class="headerlink" href="#test-github-actions-workflows-locally-with-act" title="Permalink to this heading">#</a></h4>
<p>Don’t waste time when testing Github Actions.</p>
<p>Instead, use <code class="docutils literal notranslate"><span class="pre">act</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">act</span></code> allows you to run your Github Actions workflows locally.</p>
<p>Instead of committing/pushing every time you make changes to your Workflow files.</p>
<p>It uses Docker to pull or build the necessary images, as defined in your workflow files. So you need Docker installed on your machine.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!curl -s https://raw.githubusercontent.com/nektos/act/master/install.sh | sudo bash
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">act</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cache-python-dependencies-in-github-actions">
<h4><span class="section-number">1.2.2. </span>Cache Python Dependencies in GitHub Actions<a class="headerlink" href="#cache-python-dependencies-in-github-actions" title="Permalink to this heading">#</a></h4>
<p>Don’t waste time for your GitHub Actions workflows.</p>
<p>Whenever a new run is triggered, your dependencies are probably installed again and again and again…</p>
<p>Even if you didn’t change anything in your dependency file.</p>
<p>With the small snippet below, the action caches your dependencies so you can skip the install step the next time your workflow runs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="n">ci</span>

<span class="n">on</span><span class="p">:</span>
  <span class="n">push</span><span class="p">:</span>
    <span class="n">branches</span><span class="p">:</span> <span class="p">[</span> <span class="n">main</span> <span class="p">]</span>
    
<span class="n">jobs</span><span class="p">:</span>

  <span class="n">build</span><span class="p">:</span>

    <span class="n">runs</span><span class="o">-</span><span class="n">on</span><span class="p">:</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">latest</span>
    
    <span class="n">steps</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">uses</span><span class="p">:</span> <span class="n">actions</span><span class="o">/</span><span class="n">checkout</span><span class="nd">@v4</span>
    <span class="o">-</span> <span class="n">uses</span><span class="p">:</span> <span class="n">actions</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">python</span><span class="nd">@v4</span>
      <span class="k">with</span><span class="p">:</span>
        <span class="n">python</span><span class="o">-</span><span class="n">version</span><span class="p">:</span> <span class="s1">&#39;3.9&#39;</span>
        <span class="n">cache</span><span class="p">:</span> <span class="s1">&#39;pip&#39;</span> <span class="c1"># caching pip dependencies (supports poetry and pipenv too)</span>
    <span class="o">-</span> <span class="n">run</span><span class="p">:</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>

    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Run</span> <span class="n">Python</span> <span class="n">unit</span> <span class="n">tests</span>
      <span class="n">run</span><span class="p">:</span> <span class="n">python3</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">tests</span><span class="o">/</span><span class="n">tests</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="lint-github-actions-workflow-files-with-actionlint">
<h4><span class="section-number">1.2.3. </span>Lint Github Actions Workflow Files with <code class="docutils literal notranslate"><span class="pre">actionlint</span></code><a class="headerlink" href="#lint-github-actions-workflow-files-with-actionlint" title="Permalink to this heading">#</a></h4>
<p>To lint your Github actions workflow files, use <code class="docutils literal notranslate"><span class="pre">actionlint</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">actionlint</span></code> is a tool for detecting potential problems and smells in your workflow files.</p>
<p>This includes</p>
<ul class="simple">
<li><p>Syntax checks</p></li>
<li><p>Security checks</p></li>
<li><p>Cron syntax checking</p></li>
<li><p>Checks for access to non-existent properties</p></li>
</ul>
<p>It has a pre-commit hook too.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!go install github.com/rhysd/actionlint/cmd/actionlint@latest
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!actionlint
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/codequality/codestyle"></span><section id="code-style">
<h3><span class="section-number">1.3. </span>Code Style<a class="headerlink" href="#code-style" title="Permalink to this heading">#</a></h3>
<section id="remove-unused-lines-with-autoflake">
<h4><span class="section-number">1.3.1. </span>Remove unused lines with <code class="docutils literal notranslate"><span class="pre">autoflake</span></code><a class="headerlink" href="#remove-unused-lines-with-autoflake" title="Permalink to this heading">#</a></h4>
<p>Do you always remove your unused imports and variables in Python?</p>
<p>If not, this can be problematic:</p>
<ul class="simple">
<li><p>Your code will be more difficult to read</p></li>
<li><p>Reduced performance because the Python interpreter has to spend less time importing and evaluating unnecessary code</p></li>
<li><p>Potential issues can arise such as conflicts with other variables</p></li>
</ul>
<p>If you want to clean and optimize your code, try <code class="docutils literal notranslate"><span class="pre">autoflake</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">autoflake</span></code> is a tool that automatically removes unused imports and variables for you.</p>
<p>You can also customize to fine-tune how <code class="docutils literal notranslate"><span class="pre">autoflake</span></code> processes your code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install autoflake
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!autoflake --in-place &lt;example.py&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="ensure-documentation-with-interrogate">
<h4><span class="section-number">1.3.2. </span>Ensure Documentation with <code class="docutils literal notranslate"><span class="pre">interrogate</span></code><a class="headerlink" href="#ensure-documentation-with-interrogate" title="Permalink to this heading">#</a></h4>
<p>One aspect of code quality and maintainability is documenting your code.</p>
<p>In Python, there are docstrings to do this job.</p>
<p>How about to check if all of your methods and classes use docstrings?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">interrogate</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">interrogate</span></code> is a Python tool for checking and enforcing docstrings.</p>
<p>You can even print out a coverage report.</p>
<p>Say goodbye to poorly-documented code!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install interrogate
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!interrogate . -v
</pre></div>
</div>
</div>
</div>
</section>
<section id="sort-your-imports-automatically-with-isort">
<h4><span class="section-number">1.3.3. </span>Sort your imports automatically with <code class="docutils literal notranslate"><span class="pre">isort</span></code><a class="headerlink" href="#sort-your-imports-automatically-with-isort" title="Permalink to this heading">#</a></h4>
<p>When your Python app gets bigger, you will have more and more import statements.</p>
<p>This can look nasty when you don’t order them.</p>
<p>Don’t sort them manually.</p>
<p>Instead, use <code class="docutils literal notranslate"><span class="pre">isort</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">isort</span></code> is a Python library that sorts your imports alphabetically and separates them into sections.</p>
<p>You only need to type one line into your CLI.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install isort
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!isort .
</pre></div>
</div>
</div>
</div>
</section>
<section id="format-your-code-automatically-with-black">
<h4><span class="section-number">1.3.4. </span>Format your code automatically with <code class="docutils literal notranslate"><span class="pre">black</span></code><a class="headerlink" href="#format-your-code-automatically-with-black" title="Permalink to this heading">#</a></h4>
<p>If you want to avoid manual code formatting, use <code class="docutils literal notranslate"><span class="pre">black</span></code> for Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">black</span></code> is a library providing automatic formatting of Python code.</p>
<p>It makes it easier for you to focus on writing high-quality code.</p>
<p>Instead of wasting time formatting it by hand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install black
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!black .
</pre></div>
</div>
</div>
</div>
</section>
<section id="lint-your-yaml-files-with-yamllint">
<h4><span class="section-number">1.3.5. </span>Lint your YAML files with <code class="docutils literal notranslate"><span class="pre">yamllint</span></code><a class="headerlink" href="#lint-your-yaml-files-with-yamllint" title="Permalink to this heading">#</a></h4>
<p>Are you tired of manually checking YAML files for errors and formatting issues?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">yamllint</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">yamllint</span></code> is a Python library to lint YAML files, ensuring that they are well-formed.</p>
<p>Since yaml is a popular choice for Config files, yamllint is a nice tool to catch errors before they cause problems.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install yamllint
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!yamllint .
</pre></div>
</div>
</div>
</div>
</section>
<section id="blazingly-fast-linting-with-ruff">
<h4><span class="section-number">1.3.6. </span>Blazingly fast linting with <code class="docutils literal notranslate"><span class="pre">ruff</span></code><a class="headerlink" href="#blazingly-fast-linting-with-ruff" title="Permalink to this heading">#</a></h4>
<p>Are you still using flake8 or pylint?</p>
<p>Instead, use <code class="docutils literal notranslate"><span class="pre">ruff</span></code>, with 10x-100x faster performance.</p>
<p><code class="docutils literal notranslate"><span class="pre">ruff</span></code> is a blazingly fast linter for Python, written in Rust.</p>
<p>It is orders of magnitudes faster than flake8 and pylint  while integrating more functionality like import sorting or removing unused code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># some_file.py</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;infinity&#39;</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install ruff
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!ruff some_file.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="format-python-code-in-documentation-files">
<h4><span class="section-number">1.3.7. </span>Format Python Code in Documentation Files<a class="headerlink" href="#format-python-code-in-documentation-files" title="Permalink to this heading">#</a></h4>
<p>Do you want to apply black on your documentation files?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">blacken-docs</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">blacken-docs</span></code> apply the popular code formatting tool black in your documentation.</p>
<p>It supports Code snippets in:</p>
<ul class="simple">
<li><p>Markdown</p></li>
<li><p>LaTeX</p></li>
<li><p>reStructuredText</p></li>
</ul>
<p>Don’t write unformatted code in your documentation anymore!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install blacken-docs
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!blacken-docs TEST.md
</pre></div>
</div>
</div>
</div>
</section>
<section id="correct-misspellings-in-your-codebase-with-codespell">
<h4><span class="section-number">1.3.8. </span>Correct Misspellings in Your Codebase with <code class="docutils literal notranslate"><span class="pre">codespell</span></code><a class="headerlink" href="#correct-misspellings-in-your-codebase-with-codespell" title="Permalink to this heading">#</a></h4>
<p>Typos in your codebase are nasty.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">codespell</span></code>, you can correct them automatically.</p>
<p><code class="docutils literal notranslate"><span class="pre">codespell</span></code> corrects your misspelled words in your source code and other files.</p>
<p>But it makes sure to not touch niche terms to reduce false positives.</p>
<p>Clean up your codebase.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install codespell
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!codespell # Running codespell in all files of current directory
</pre></div>
</div>
</div>
</div>
</section>
<section id="lint-your-dockerfile-with-hadolint">
<h4><span class="section-number">1.3.9. </span>Lint Your Dockerfile with <code class="docutils literal notranslate"><span class="pre">hadolint</span></code><a class="headerlink" href="#lint-your-dockerfile-with-hadolint" title="Permalink to this heading">#</a></h4>
<p>Do you want to lint your Dockerfiles?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">hadolint</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">hadolint</span></code> enforces Dockerfile best practices by parsing the Dockerfile into an AST and performing rules.</p>
<p>It’s available as a Docker container image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!docker run -rm -i hadolint/hadolint &lt; Dockerfile
</pre></div>
</div>
</div>
</div>
</section>
<section id="detect-typos-in-your-codebase-with-typos">
<h4><span class="section-number">1.3.10. </span>Detect Typos in your codebase with <code class="docutils literal notranslate"><span class="pre">typos</span></code><a class="headerlink" href="#detect-typos-in-your-codebase-with-typos" title="Permalink to this heading">#</a></h4>
<p>To find typos in your code base, use <code class="docutils literal notranslate"><span class="pre">typos</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">typos</span></code> is a fast code spell checker written in Rust for high performance.</p>
<p>It has a low false positive rate, so you can easily run it in your CI pipeline or as a pre-commit hook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!brew install typos-cli
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!typos
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/codequality/memory"></span><section id="memory-optimization">
<h3><span class="section-number">1.4. </span>Memory Optimization<a class="headerlink" href="#memory-optimization" title="Permalink to this heading">#</a></h3>
<section id="identify-your-bottleneck-regarding-memory-with-memory-profiler">
<h4><span class="section-number">1.4.1. </span>Identify your bottleneck regarding memory with <code class="docutils literal notranslate"><span class="pre">memory_profiler</span></code><a class="headerlink" href="#identify-your-bottleneck-regarding-memory-with-memory-profiler" title="Permalink to this heading">#</a></h4>
<p>Want to identify which lines use the most amount of memory in your Python script?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">memory_profiler</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">memory_profiler</span></code> is a Python module to make a line-by-line analysis of memory consumption for Python functions.</p>
<p>Below you can see how to use <code class="docutils literal notranslate"><span class="pre">memory_profiler</span></code> within your Python script.</p>
<ul class="simple">
<li><p>Decorate the function you want to profile with <code class="docutils literal notranslate"><span class="pre">&#64;profile</span></code>.</p></li>
<li><p>Run the script by passing the option <code class="docutils literal notranslate"><span class="pre">-m</span> <span class="pre">memory_profiler</span></code> to load the <code class="docutils literal notranslate"><span class="pre">memory_profiler</span></code> module.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">memory_profiler</span> <span class="kn">import</span> <span class="n">profile</span>

<span class="nd">@profile</span>
<span class="k">def</span> <span class="nf">my_func</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">a</span>

<span class="n">my_func</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install memory_profiler
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!python -m memory_profiler memory.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Line #    Mem usage    Increment  Occurrences   Line Contents</span>
<span class="sd">=============================================================</span>
<span class="sd">     3     41.9 MiB     41.9 MiB           1   @profile</span>
<span class="sd">     4                                         def my_func():</span>
<span class="sd">     5     49.5 MiB      7.6 MiB         102       a = [i**2 for i in range(1,100)] * (10**4)</span>
<span class="sd">     6    194.5 MiB    145.0 MiB          22       b = [i**i for i in range(1,20)] * (10**6)</span>
<span class="sd">     7    194.5 MiB      0.0 MiB           1       return a, b</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/codequality/security"></span><section id="security-in-projects">
<h3><span class="section-number">1.5. </span>Security in Projects<a class="headerlink" href="#security-in-projects" title="Permalink to this heading">#</a></h3>
<section id="detect-common-security-issues-with-bandit">
<h4><span class="section-number">1.5.1. </span>Detect Common Security Issues with <code class="docutils literal notranslate"><span class="pre">bandit</span></code><a class="headerlink" href="#detect-common-security-issues-with-bandit" title="Permalink to this heading">#</a></h4>
<p>Do you want to find potential security issues in your Python code?</p>
<p>Try using <code class="docutils literal notranslate"><span class="pre">bandit</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">bandit</span></code> is a Python package to find common security issues and known vulnerabilities automatically.</p>
<p>It works by processing files to create an abstract syntax tree, which is then used to run plugins against. It then produces a report on the results.</p>
<p>In the example below, we will try to use the <code class="docutils literal notranslate"><span class="pre">requests</span></code> library and ignore verifying the SSL certificate with 𝐯𝐞𝐫𝐢𝐟𝐲=𝐅𝐚𝐥𝐬𝐞.</p>
<p><code class="docutils literal notranslate"><span class="pre">bandit</span></code> will immediately identify this line as a security issue.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># bandit_test.py</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.google.de/&quot;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>bandit
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>bandit<span class="w"> </span>-r<span class="w"> </span>bandit_test.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">[main]  INFO    profile include tests: None</span>
<span class="sd">[main]  INFO    profile exclude tests: None</span>
<span class="sd">[main]  INFO    cli include tests: None</span>
<span class="sd">[main]  INFO    cli exclude tests: None</span>
<span class="sd">[main]  INFO    running on Python 3.10.8</span>
<span class="sd">[node_visitor]  WARNING Unable to find qualified name for module: bandit_test.py</span>
<span class="sd">Run started:2022-12-23 15:32:44.650893</span>
<span class="sd">Test results:</span>
<span class="sd">&gt;&gt; Issue: [B501:request_with_no_cert_validation] Requests call with verify=False disabling SSL certificate checks, security issue.</span>
<span class="sd">   Severity: High   Confidence: High</span>
<span class="sd">   CWE: CWE-295 (https://cwe.mitre.org/data/definitions/295.html)     </span>
<span class="sd">   Location: bandit_test.py:3:7</span>
<span class="sd">   More Info: https://bandit.readthedocs.io/en/1.7.4/plugins/b501_request_with_no_cert_validation.html</span>
<span class="sd">2</span>
<span class="sd">3       data = requests.get(&quot;https://www.google.de/&quot;, verify = False) </span>
<span class="sd">4       print(data.status_code)</span>
<span class="sd">--------------------------------------------------</span>
<span class="sd">Code scanned:</span>
<span class="sd">        Total lines of code: 3</span>
<span class="sd">        Total lines skipped (#nosec): 0</span>
<span class="sd">Run metrics:</span>
<span class="sd">        Total issues (by severity):</span>
<span class="sd">                Undefined: 0</span>
<span class="sd">                Low: 0</span>
<span class="sd">                Medium: 0</span>
<span class="sd">                High: 1</span>
<span class="sd">        Total issues (by confidence):</span>
<span class="sd">                Undefined: 0</span>
<span class="sd">                Low: 0</span>
<span class="sd">                Medium: 0</span>
<span class="sd">                High: 1</span>
<span class="sd">Files skipped (0):</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="detect-vulnerabilities-in-your-environment">
<h4><span class="section-number">1.5.2. </span>Detect vulnerabilities in your Environment<a class="headerlink" href="#detect-vulnerabilities-in-your-environment" title="Permalink to this heading">#</a></h4>
<p>Do you want to detect vulnerabilities in your Python environment?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">pip-audit</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pip-audit</span></code> is a CLI tool to detect vulnerabilities in the packages installed in your Python environment.</p>
<p>It checks your packages against the Python Packaging Advisory Database.</p>
<p>The tool also provides suggestions to which version you should upgrade your package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pip-audit
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip-audit
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Found 3 known vulnerabilities in 2 packages</span>
<span class="sd">Name       Version ID                  Fix Versions</span>
<span class="sd">---------- ------- ------------------- ------------</span>
<span class="sd">flask      0.5     PYSEC-2019-179      1.0</span>
<span class="sd">flask      0.5     PYSEC-2018-66       0.12.3</span>
<span class="sd">setuptools 56.0.0  GHSA-r9hx-vwmv-q579 65.5.1</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="store-credentials-safely-with-keyring">
<h4><span class="section-number">1.5.3. </span>Store Credentials safely with <code class="docutils literal notranslate"><span class="pre">keyring</span></code><a class="headerlink" href="#store-credentials-safely-with-keyring" title="Permalink to this heading">#</a></h4>
<p>Almost every application needs credentials like password or API keys.</p>
<p>But you should never store them in plain text files.
They would be trivially accessible to anybody who has access to the text file.</p>
<p>To store credentials securely, use <code class="docutils literal notranslate"><span class="pre">keyring</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">keyring</span></code> provides a Python wrapper around your system’s password store (macOS Keychain, Windows Credential Locker, etc.), which is safer than a plain text file.</p>
<p>The example below stores and retrieves the password easily, but you can store any of the other fields.</p>
<p>(This can also be done through CLI, since <code class="docutils literal notranslate"><span class="pre">keyring</span></code> also comes with a command-line functionality).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>keyring
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">keyring</span>

<span class="c1"># set your password</span>
<span class="n">keyring</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s2">&quot;mydb&quot;</span><span class="p">,</span> <span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">)</span>

<span class="c1"># get your password</span>
<span class="n">keyring</span><span class="o">.</span><span class="n">get_password</span><span class="p">(</span><span class="s2">&quot;mydb&quot;</span><span class="p">,</span> <span class="s2">&quot;username&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/codequality/typing"></span><section id="typing">
<h3><span class="section-number">1.6. </span>Typing<a class="headerlink" href="#typing" title="Permalink to this heading">#</a></h3>
<section id="enforce-types-with-typeguard">
<h4><span class="section-number">1.6.1. </span>Enforce types with <code class="docutils literal notranslate"><span class="pre">typeguard</span></code><a class="headerlink" href="#enforce-types-with-typeguard" title="Permalink to this heading">#</a></h4>
<p>How to enforce types in Python easily?</p>
<p>You can try type hinting and define the expected types.</p>
<p>But you can still pass the wrong types and get away without an error.</p>
<p>Instead, use <code class="docutils literal notranslate"><span class="pre">typeguard</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">typeguard</span></code>’s decorator makes sure that an error gets raised when a variable of a wrong type is passed.</p>
<p>See below, how you only need to add a decorator to the function to make things work.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install typeguard
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typeguard</span> <span class="kn">import</span> <span class="n">typechecked</span>

<span class="nd">@typechecked</span>
<span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    

<span class="n">say_hello</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="static-type-checking-with-mypy">
<h4><span class="section-number">1.6.2. </span>Static type checking with <code class="docutils literal notranslate"><span class="pre">mypy</span></code><a class="headerlink" href="#static-type-checking-with-mypy" title="Permalink to this heading">#</a></h4>
<p>Do you want to catch type errors before they cause problems in production?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">mypy</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">mypy</span></code> is a static type checker for Python that can help you catch type errors before you even run your code.</p>
<p>It analyzes your code to ensure that the types of your variables and functions align with the expected types.</p>
<p>So <code class="docutils literal notranslate"><span class="pre">mypy</span></code> helps you to write more reliable code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># bank.py</span>
<span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">balance</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">balance</span> <span class="o">+</span> <span class="n">amount</span>
    
<span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">balance</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">balance</span> <span class="o">-</span> <span class="n">amount</span>
    

<span class="n">deposit</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;1000&quot;</span><span class="p">)</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install mypy
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!mypy bank.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="faster-static-type-checking-with-pyright">
<h4><span class="section-number">1.6.3. </span>Faster Static Type Checking with <code class="docutils literal notranslate"><span class="pre">pyright</span></code><a class="headerlink" href="#faster-static-type-checking-with-pyright" title="Permalink to this heading">#</a></h4>
<p>Do you wish to find type errors before they make problems in production?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">pyright</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">pyright</span></code> is a fast static type checker for Python, which helps you find type errors even before you run your code.</p>
<p>It checks your code to make sure that the types of your variables and functions match what is expected.</p>
<p><code class="docutils literal notranslate"><span class="pre">pyright</span></code> is written in TypeScript, so check the community version to avoid going through installing extra things (Link is below).</p>
<p>It’s 3x-5x times than the OG static type checker, mypy.</p>
<p>Whether it’s pyright or mypy, please consider to integrate static type checkers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pyright
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pyright
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/codequality/principles"></span><section id="principles-for-code-quality">
<h3><span class="section-number">1.7. </span>Principles for Code Quality<a class="headerlink" href="#principles-for-code-quality" title="Permalink to this heading">#</a></h3>
<section id="the-law-of-demeter">
<h4><span class="section-number">1.7.1. </span>The Law of Demeter<a class="headerlink" href="#the-law-of-demeter" title="Permalink to this heading">#</a></h4>
<p>It’s also known as the Principle of Least Knowledge, saying that an object should only communicate with its immediate neighbors, avoiding to access deeper and deeper objects.</p>
<p>See below for a small example how we would violate and obey the Law of Demeter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bad Example</span>
<span class="k">class</span> <span class="nc">Department</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">manager</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="n">manager</span>

    <span class="k">def</span> <span class="nf">get_manager_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Bad: Accessing a method of an object deep within the hierarchy</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">employee</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Employee</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">employee</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">employee</span> <span class="o">=</span> <span class="n">employee</span>

<span class="c1"># Good Example</span>
<span class="k">class</span> <span class="nc">Department</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">manager</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="n">manager</span>
    
    <span class="k">def</span> <span class="nf">get_manager_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Good: Not going deeper</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Employee</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">employee</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">employee</span> <span class="o">=</span> <span class="n">employee</span>

    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">employee</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/cooltools/index"></span><section id="cool-tools">
<h2><span class="section-number">2. </span>Cool Tools<a class="headerlink" href="#cool-tools" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/cooltools/Chapter"></span><section id="cool-tools">
<h3><span class="section-number">2.1. </span>Cool Tools<a class="headerlink" href="#cool-tools" title="Permalink to this heading">#</a></h3>
<section id="work-with-countries-currencies-subdivisions-and-more">
<h4><span class="section-number">2.1.1. </span>Work with Countries, Currencies, Subdivisions, and more<a class="headerlink" href="#work-with-countries-currencies-subdivisions-and-more" title="Permalink to this heading">#</a></h4>
<p>Do you work with international data?</p>
<p>You probably know how important it is to use the correct codes for countries, currencies, languages, and subdivisions.</p>
<p>To save the headache, try <code class="docutils literal notranslate"><span class="pre">pycountry</span></code> for Python!</p>
<p><code class="docutils literal notranslate"><span class="pre">pycountry</span></code> makes it easy to work with these codes.</p>
<p>It allows you to look up country and currency information by name or code based on ISO.</p>
<p>But it can also be used to get the name or code for a specific currency or country.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pycountry
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pycountry</span>

<span class="c1"># Get Country</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pycountry</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alpha_2</span><span class="o">=</span><span class="s2">&quot;DE&quot;</span><span class="p">))</span>

<span class="c1"># Get Currency</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pycountry</span><span class="o">.</span><span class="n">currencies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alpha_3</span><span class="o">=</span><span class="s2">&quot;EUR&quot;</span><span class="p">))</span>

<span class="c1"># Get Language</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pycountry</span><span class="o">.</span><span class="n">languages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alpha_2</span><span class="o">=</span><span class="s1">&#39;DE&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-better-requirements-files-with-pipreqs">
<h4><span class="section-number">2.1.2. </span>Generate better requirements files with <code class="docutils literal notranslate"><span class="pre">pipreqs</span></code><a class="headerlink" href="#generate-better-requirements-files-with-pipreqs" title="Permalink to this heading">#</a></h4>
<p>To generate a requirements.txt file, don’t do pip freeze &gt; requirements.txt</p>
<p>It will save all packages in your environment including those you are not currently using in your project (but still have installed).</p>
<p>Instead, use <code class="docutils literal notranslate"><span class="pre">pipreqs</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pipreqs</span></code> will only save those packages based on imports in your project.</p>
<p>A very good option for plain virtual environments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pipreqs
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pipreqs .
</pre></div>
</div>
</div>
</div>
</section>
<section id="remove-a-package-and-its-dependencies-with-pip-autoremove">
<h4><span class="section-number">2.1.3. </span>Remove a package and its dependencies with <code class="docutils literal notranslate"><span class="pre">pip-autoremove</span></code><a class="headerlink" href="#remove-a-package-and-its-dependencies-with-pip-autoremove" title="Permalink to this heading">#</a></h4>
<p>When you want to remove a package via pip, you will encounter following problem:</p>
<p>pip will remove the desired package but not its unused dependencies.</p>
<p>Instead, try <code class="docutils literal notranslate"><span class="pre">pip-autoremove</span></code>.</p>
<p>It will automatically remove a package and its unused dependencies.</p>
<p>A really good option when you are not using something like Poetry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pip-autoremove
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip-autoremove flask -y
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-distance-between-postal-codes">
<h4><span class="section-number">2.1.4. </span>Get distance between postal codes<a class="headerlink" href="#get-distance-between-postal-codes" title="Permalink to this heading">#</a></h4>
<p>Do you want the distance between two postal codes?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">pgeocode</span></code>.</p>
<p>Just specify your country + postal codes and get the distance in KM.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pgeocode
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pgeocode</span>

<span class="n">dist</span> <span class="o">=</span> <span class="n">pgeocode</span><span class="o">.</span><span class="n">GeoDistance</span><span class="p">(</span><span class="s1">&#39;DE&#39;</span><span class="p">)</span>
<span class="n">dist</span><span class="o">.</span><span class="n">query_postal_code</span><span class="p">(</span><span class="s1">&#39;10117&#39;</span><span class="p">,</span> <span class="s1">&#39;80331&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="working-with-units-with-pint">
<h4><span class="section-number">2.1.5. </span>Working with units with <code class="docutils literal notranslate"><span class="pre">pint</span></code><a class="headerlink" href="#working-with-units-with-pint" title="Permalink to this heading">#</a></h4>
<p>Have you ever struggled with units in Python?</p>
<p>With <code class="docutils literal notranslate"><span class="pre">pint</span></code>, you don’t have to.</p>
<p><code class="docutils literal notranslate"><span class="pre">pint</span></code> is a Python library for easy unit conversion and manipulation.</p>
<p>You can handle physical quantities with units, perform conversions, and perform arithmetic with physical quantities.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">pint</span></code>, you keep track of your units and ensure accurate results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pint
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pint</span>

<span class="c1"># Initializing the unit registry</span>
<span class="n">ureg</span> <span class="o">=</span> <span class="n">pint</span><span class="o">.</span><span class="n">UnitRegistry</span><span class="p">()</span>

<span class="c1"># Defining a physical quantity with units</span>
<span class="n">distance</span> <span class="o">=</span> <span class="mf">33.0</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">kilometers</span>
<span class="nb">print</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
<span class="c1"># 33.0 kilometer</span>

<span class="c1"># Converting between units</span>
<span class="nb">print</span><span class="p">(</span><span class="n">distance</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">ureg</span><span class="o">.</span><span class="n">feet</span><span class="p">))</span>
<span class="c1"># 108267.71653543308 foot</span>

<span class="c1"># Performing arithmetic operations</span>
<span class="n">speed</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">distance</span> <span class="o">/</span> <span class="n">ureg</span><span class="o">.</span><span class="n">hour</span>
<span class="nb">print</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
<span class="c1"># 198.0 kilometer / hour</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="supercharge-your-python-profiling-with-scalene">
<h4><span class="section-number">2.1.6. </span>Supercharge your Python profiling with <code class="docutils literal notranslate"><span class="pre">Scalene</span></code><a class="headerlink" href="#supercharge-your-python-profiling-with-scalene" title="Permalink to this heading">#</a></h4>
<p>Want to identify Python performance issues?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">Scalene</span></code>, your Profiler on steroids!</p>
<p><code class="docutils literal notranslate"><span class="pre">Scalene</span></code> is a Python CPU + GPU + Memory profiler to identify bottlenecks.</p>
<p>Even with AI-powered optimization proposals!</p>
<p><code class="docutils literal notranslate"><span class="pre">Scalene</span></code> comes with an easy-to-use CLI and web-based GUI.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install scalene
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!scalene &lt;my_module.py&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="fix-unicode-errors-with-ftfy">
<h4><span class="section-number">2.1.7. </span>Fix unicode errors with <code class="docutils literal notranslate"><span class="pre">ftfy</span></code><a class="headerlink" href="#fix-unicode-errors-with-ftfy" title="Permalink to this heading">#</a></h4>
<p>Have you ever struggled with Unicode errors in your Python code?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">ftfy</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">ftfy</span></code> repairs scrambled text which occurs as a result of encoding or decoding problems.</p>
<p>You will probably know it when text in a foreign language can’t appear correctly.</p>
<p>In Python you only have to call one method from <code class="docutils literal notranslate"><span class="pre">ftfy</span></code> to fix it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install ftfy
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ftfy</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ftfy</span><span class="o">.</span><span class="n">fix_text</span><span class="p">(</span><span class="s1">&#39;What does â€œftfyâ€</span><span class="se">\x9d</span><span class="s1"> mean?&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ftfy</span><span class="o">.</span><span class="n">fix_text</span><span class="p">(</span><span class="s1">&#39;âœ” Check&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ftfy</span><span class="o">.</span><span class="n">fix_text</span><span class="p">(</span><span class="s1">&#39;The Mona Lisa doesnÃƒÂ¢Ã¢â€šÂ¬Ã¢â€žÂ¢t have eyebrows.&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="remove-the-background-from-images-with-rembg">
<h4><span class="section-number">2.1.8. </span>Remove the background from images with <code class="docutils literal notranslate"><span class="pre">rembg</span></code><a class="headerlink" href="#remove-the-background-from-images-with-rembg" title="Permalink to this heading">#</a></h4>
<p>Do you want to remove the background from images with Python?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">rembg</span></code>.</p>
<p>With its pre-trained models, <code class="docutils literal notranslate"><span class="pre">rembg</span></code> makes removing the background of your images easy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install rembg
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rembg</span> <span class="kn">import</span> <span class="n">remove</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="n">input_path</span> <span class="o">=</span> <span class="s1">&#39;car.jpg&#39;</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="s1">&#39;car2.jpg&#39;</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="n">remove</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="build-modern-cli-apps-with-typer">
<h4><span class="section-number">2.1.9. </span>Build modern CLI apps with <code class="docutils literal notranslate"><span class="pre">typer</span></code><a class="headerlink" href="#build-modern-cli-apps-with-typer" title="Permalink to this heading">#</a></h4>
<p>Tired of building clunky CLI for your Python applications?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">typer</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">typer</span></code> makes it easy to create clean, intuitive CLI apps that are easy to use and maintain.</p>
<p>It also comes with auto-generated help messages.</p>
<p>Ditch argparse.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install typer
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># hello_script.py</span>
<span class="kn">import</span> <span class="nn">typer</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Typer</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
    
<span class="nd">@app</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">bye</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bye, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!python hello_script.py hello John
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-realistic-fake-data-with-faker">
<h4><span class="section-number">2.1.10. </span>Generate realistic fake data with <code class="docutils literal notranslate"><span class="pre">faker</span></code><a class="headerlink" href="#generate-realistic-fake-data-with-faker" title="Permalink to this heading">#</a></h4>
<p>Creating realistic test data for your Python projects is annoying.</p>
<p><code class="docutils literal notranslate"><span class="pre">faker</span></code> helps you to do that!</p>
<p>With just a few lines of code, you can generate realistic and diverse test data, such as :</p>
<ul class="simple">
<li><p>Names</p></li>
<li><p>Addresses</p></li>
<li><p>Phone numbers</p></li>
<li><p>Email addresses</p></li>
<li><p>Jobs</p></li>
</ul>
<p>And more!</p>
<p>You can even set the local or language for more diverse output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install faker
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">job</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">phone_number</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="enrich-your-progress-bars-with-rich">
<h4><span class="section-number">2.1.11. </span>Enrich your progress bars with <code class="docutils literal notranslate"><span class="pre">rich</span></code><a class="headerlink" href="#enrich-your-progress-bars-with-rich" title="Permalink to this heading">#</a></h4>
<p>Do you want a more colorful output for progress bars?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">rich</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rich</span></code> offers a beautiful progress bar, instead of tqdm’s boring output.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">rich.progress.track</span></code>, you can get a colorful output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install rich
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rich.progress</span> <span class="kn">import</span> <span class="n">track</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">25000000</span><span class="p">)):</span>
    <span class="c1"># Do something</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-the-description-for-tqdm-bars">
<h4><span class="section-number">2.1.12. </span>Set the description for <code class="docutils literal notranslate"><span class="pre">tqdm</span></code> bars<a class="headerlink" href="#set-the-description-for-tqdm-bars" title="Permalink to this heading">#</a></h4>
<p>When you work with progress bars, you will probably use 𝐭𝐪𝐝𝐦.</p>
<p>Do you know you can add descriptions to your bar?</p>
<p>You can do that with <code class="docutils literal notranslate"><span class="pre">set_description()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tqdm</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;sample_data/*.csv&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">files</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Read </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-emojis-to-text-with-emot">
<h4><span class="section-number">2.1.13. </span>Convert Emojis to Text with <code class="docutils literal notranslate"><span class="pre">emot</span></code><a class="headerlink" href="#convert-emojis-to-text-with-emot" title="Permalink to this heading">#</a></h4>
<p>Analyzing emojis and emoticons in texts can give you useful insights.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">emot</span></code>, you can convert emoticons into words.</p>
<p>Especially useful for sentiment analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install emot
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">emot</span> 
<span class="n">emot_obj</span> <span class="o">=</span> <span class="n">emot</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">emot</span><span class="p">()</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;I love python ☮ 🙂 ❤ :-) :-( :-)))&quot;</span> 
<span class="n">emot_obj</span><span class="o">.</span><span class="n">emoji</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="print-hardware-information-and-version-numbers">
<h4><span class="section-number">2.1.14. </span>Print hardware information and version numbers<a class="headerlink" href="#print-hardware-information-and-version-numbers" title="Permalink to this heading">#</a></h4>
<p>When raising an issue, you should provide version numbers and hardware information.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">watermark</span></code>, you can do that easily.</p>
<p>Just install the package and print.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install watermark
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">watermark</span> <span class="kn">import</span> <span class="n">watermark</span>
<span class="nb">print</span><span class="p">(</span><span class="n">watermark</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cache-requests-with-requests-cache">
<h4><span class="section-number">2.1.15. </span>Cache requests with <code class="docutils literal notranslate"><span class="pre">requests-cache</span></code><a class="headerlink" href="#cache-requests-with-requests-cache" title="Permalink to this heading">#</a></h4>
<p>Do you want better performance for requests?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">requests-cache</span></code>.</p>
<p>It caches HTTP requests so you don’t have to make the same requests again and again.</p>
<p>In the example below, a test endpoint with a 1-second delay will be called.</p>
<p>With the standard <code class="docutils literal notranslate"><span class="pre">requests</span></code> library, this takes 60 seconds.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">requests-cache</span></code>, this takes 1 second.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install requests-cache
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This takes 60 seconds</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">60</span><span class="p">):</span>
    <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://httpbin.org/delay/1&#39;</span><span class="p">)</span>
    
    

<span class="c1"># This takes 1 second</span>
<span class="kn">import</span> <span class="nn">requests_cache</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">requests_cache</span><span class="o">.</span><span class="n">CachedSession</span><span class="p">(</span><span class="s1">&#39;test_cache&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">60</span><span class="p">):</span>
    <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://httpbin.org/delay/1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="unify-messy-columns-with-unifyname">
<h4><span class="section-number">2.1.16. </span>Unify messy columns with <code class="docutils literal notranslate"><span class="pre">unifyname</span></code><a class="headerlink" href="#unify-messy-columns-with-unifyname" title="Permalink to this heading">#</a></h4>
<p>Do you want to unify messy string columns?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">unifyname</span></code>, based on fuzzy string matching.</p>
<p>This small library cleans up your messy columns with 100s of different variations for one word.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install unifyname
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">unifyname.utils</span> <span class="kn">import</span> <span class="n">unify_names</span><span class="p">,</span> <span class="n">deduplicate_list_string</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s2">&quot;BAIRRO DO IMOVEL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">unify_names</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;BAIRRO DO IMOVEL&#39;</span><span class="p">,</span><span class="n">threshold_count</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s2">&quot;BAIRRO DO IMOVEL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-for-broken-links-in-a-website">
<h4><span class="section-number">2.1.17. </span>Check for broken links in a website<a class="headerlink" href="#check-for-broken-links-in-a-website" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">𝐥𝐢𝐧𝐤𝐜𝐡𝐞𝐜𝐤𝐞𝐫</span></code> is a Python library for recursively going through a website and checking for broken links.</p>
<p>You may not have the time to do that manually.</p>
<p>And broken links can harm your Search Engine Ranking.</p>
<p>See below how easy it can be to set up and use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install linkchecker
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!linkchecker https://www.example.com
</pre></div>
</div>
</div>
</div>
</section>
<section id="matplotlib-for-your-terminal">
<h4><span class="section-number">2.1.18. </span>Matplotlib for your Terminal<a class="headerlink" href="#matplotlib-for-your-terminal" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">bashplotlib</span></code> is a little library that displays basic ASCII graphs in your terminal.</p>
<p>It provides a quick way to visualize your data.</p>
<p>Currently, <code class="docutils literal notranslate"><span class="pre">bashplotlib</span></code> only supports histogram and scatter plots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install bashplotlib
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!hist --file test.txt
</pre></div>
</div>
</div>
</div>
</section>
<section id="display-a-dependency-tree-of-your-environment">
<h4><span class="section-number">2.1.19. </span>Display a Dependency Tree of your Environment<a class="headerlink" href="#display-a-dependency-tree-of-your-environment" title="Permalink to this heading">#</a></h4>
<p>Do you want to stop resolving dependency issues?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">pipdeptree</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pipdeptree</span></code> displays your installed Python packages in the form of a dependency tree.</p>
<p>It will also show you warnings when there are possible version conflicts.</p>
<p>An alternative to tools like Poetry which resolves dependency issues for you automatically.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pipdeptree
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pipdeptree
</pre></div>
</div>
</div>
</div>
</section>
<section id="sort-latex-acronyms-automatically">
<h4><span class="section-number">2.1.20. </span>Sort LaTeX acronyms automatically<a class="headerlink" href="#sort-latex-acronyms-automatically" title="Permalink to this heading">#</a></h4>
<p>I wrote a small library (<code class="docutils literal notranslate"><span class="pre">acrosort-tex</span></code>) to sort LaTeX acronyms with one command automatically.</p>
<p>It was a fun Sunday project where I really learned how easy it is to publish a package with Poetry.</p>
<p>Currently, it only supports acronyms in the following format:</p>
<p>\𝒂𝒄𝒓𝒐{𝒂𝒃𝒃𝒓𝒆𝒗𝒊𝒂𝒕𝒊𝒐𝒏}[𝒔𝒉𝒐𝒓𝒕𝒇𝒐𝒓𝒎]{𝒍𝒐𝒏𝒈𝒇𝒐𝒓𝒎}</p>
<p>but it’s a beginning :)</p>
<p>See below for a small example.</p>
<p>Link to the repository: https://lnkd.in/eTF8qs5w</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install acrosort_tex
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!acrosort old.tex new.tex
</pre></div>
</div>
</div>
</div>
</section>
<section id="make-ascii-art-from-text">
<h4><span class="section-number">2.1.21. </span>Make ASCII Art from Text<a class="headerlink" href="#make-ascii-art-from-text" title="Permalink to this heading">#</a></h4>
<p>Create ASCII Art From Text in your Terminal</p>
<p>With <code class="docutils literal notranslate"><span class="pre">pyfiglet</span></code>, you can generate banner-like text with Python.</p>
<p>This is a nice feature to introduce your users to your Python CLI apps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pyfiglet
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Default font</span>
<span class="n">ascii_art</span> <span class="o">=</span> <span class="n">pyfiglet</span><span class="o">.</span><span class="n">figlet_format</span><span class="p">(</span><span class="s1">&#39;Hello, world!&#39;</span><span class="p">)</span>

<span class="c1"># Alphabet font</span>
<span class="n">ascii_art</span> <span class="o">=</span> <span class="n">pyfiglet</span><span class="o">.</span><span class="n">figlet_format</span><span class="p">(</span><span class="s1">&#39;Hello, world!&#39;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s1">&#39;Alphabet&#39;</span><span class="p">)</span>

<span class="c1"># Bubblehead font</span>
<span class="n">ascii_art</span> <span class="o">=</span> <span class="n">pyfiglet</span><span class="o">.</span><span class="n">figlet_format</span><span class="p">(</span><span class="s1">&#39;Hello, world!&#39;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s1">&#39;bulbhead&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="display-ner-with-spacy">
<h4><span class="section-number">2.1.22. </span>Display NER with <code class="docutils literal notranslate"><span class="pre">spacy</span></code><a class="headerlink" href="#display-ner-with-spacy" title="Permalink to this heading">#</a></h4>
<p>If you want to perform and visualize Named-entity Recognition, use <code class="docutils literal notranslate"><span class="pre">spacy.displacy</span></code>.</p>
<p>It makes NER and visualizing detected entities super easy.</p>
<p><code class="docutils literal notranslate"><span class="pre">displacy</span></code> has some other cool tools like visualizing dependencies within a sentence or visualizing spans, so check it out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>
<span class="kn">from</span> <span class="nn">spacy</span> <span class="kn">import</span> <span class="n">displacy</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Chelsea Football Club is an English professional football club based in Fulham, West London.</span><span class="se">\</span>
<span class="s2">        Founded in 1905, they play their home games at Stamford Bridge. </span><span class="se">\</span>
<span class="s2">        The club competes in the Premier League, the top division of English football. </span><span class="se">\</span>
<span class="s2">        They won their first major honour, the League championship, in 1955.&quot;</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;en_core_web_sm&quot;</span><span class="p">)</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">displacy</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;ent&quot;</span><span class="p">,</span> <span class="n">jupyter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-tikz-pictures-with-python">
<h4><span class="section-number">2.1.23. </span>Create TikZ pictures with Python<a class="headerlink" href="#create-tikz-pictures-with-python" title="Permalink to this heading">#</a></h4>
<p>If you have ever written a paper in LaTeX, you probably used TikZ for your graphics.</p>
<p>TikZ is probably the most powerful tool to create graphic elements.</p>
<p>And notoriously hard to learn.</p>
<p>No need to worry, you can create TikZ-figures in Python too.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">tikzplotlib</span></code>, you can convert matplotlib figures into TikZ.</p>
<p>You can then insert the resulting plot in your LaTeX file.</p>
<p>Really useful when you don’t want the hassle with TikZ.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install tikzplotlib
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tikzplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;ggplot&quot;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;o-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">4.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="s2">&quot;o-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">4.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Voltage (mV)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Simple plot $</span><span class="se">\\</span><span class="s2">frac{</span><span class="se">\\</span><span class="s2">alpha}</span><span class="si">{2}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">tikzplotlib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;mytikz.tex&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="human-readable-regex-with-pregex">
<h4><span class="section-number">2.1.24. </span>Human-readable RegEx with <code class="docutils literal notranslate"><span class="pre">PRegEx</span></code><a class="headerlink" href="#human-readable-regex-with-pregex" title="Permalink to this heading">#</a></h4>
<p>RegEx is notoriously nasty to read and write.</p>
<p>For a human-readable alternative, try <code class="docutils literal notranslate"><span class="pre">PRegEx</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">PRegEx</span></code> is a Python library aiming to have an easy-to-remember syntax to write RegEx patterns.</p>
<p>It offers a way to easily break down a complex pattern into multiple simpler ones that can then be combined.</p>
<p>See below how we can write a pattern that matches any URL that ends with either “.com” or “.org” as well as any IP address for which a 4-digit port number is specified.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pregex.core.classes</span> <span class="kn">import</span> <span class="n">AnyLetter</span><span class="p">,</span> <span class="n">AnyDigit</span><span class="p">,</span> <span class="n">AnyFrom</span>
<span class="kn">from</span> <span class="nn">pregex.core.quantifiers</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">AtLeastAtMost</span>
<span class="kn">from</span> <span class="nn">pregex.core.operators</span> <span class="kn">import</span> <span class="n">Either</span>
<span class="kn">from</span> <span class="nn">pregex.core.groups</span> <span class="kn">import</span> <span class="n">Capture</span>
<span class="kn">from</span> <span class="nn">pregex.core.pre</span> <span class="kn">import</span> <span class="n">Pregex</span>

<span class="n">http_protocol</span> <span class="o">=</span> <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;http&#39;</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;://&#39;</span><span class="p">)</span>

<span class="n">www</span> <span class="o">=</span> <span class="n">Optional</span><span class="p">(</span><span class="s1">&#39;www.&#39;</span><span class="p">)</span>

<span class="n">alphanum</span> <span class="o">=</span> <span class="n">AnyLetter</span><span class="p">()</span> <span class="o">|</span> <span class="n">AnyDigit</span><span class="p">()</span>

<span class="n">domain_name</span> <span class="o">=</span> \
  <span class="n">alphanum</span> <span class="o">+</span> \
  <span class="n">AtLeastAtMost</span><span class="p">(</span><span class="n">alphanum</span> <span class="o">|</span> <span class="n">AnyFrom</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">61</span><span class="p">)</span> <span class="o">+</span> \
  <span class="n">alphanum</span>

<span class="n">tld</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">Either</span><span class="p">(</span><span class="s1">&#39;com&#39;</span><span class="p">,</span> <span class="s1">&#39;org&#39;</span><span class="p">)</span>

<span class="n">ip_octet</span> <span class="o">=</span> <span class="n">AnyDigit</span><span class="p">()</span><span class="o">.</span><span class="n">at_least_at_most</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">port_number</span> <span class="o">=</span> <span class="p">(</span><span class="n">AnyDigit</span><span class="p">()</span> <span class="o">-</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">AnyDigit</span><span class="p">()</span>

<span class="c1"># Combine sub-patterns together.</span>
<span class="n">pre</span><span class="p">:</span> <span class="n">Pregex</span> <span class="o">=</span> \
    <span class="n">http_protocol</span> <span class="o">+</span> \
    <span class="n">Either</span><span class="p">(</span>
        <span class="n">www</span> <span class="o">+</span> <span class="n">Capture</span><span class="p">(</span><span class="n">domain_name</span><span class="p">)</span> <span class="o">+</span> <span class="n">tld</span><span class="p">,</span>
        <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">ip_octet</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">ip_octet</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">port_number</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="perform-ocr-with-easyocr">
<h4><span class="section-number">2.1.25. </span>Perform OCR with <code class="docutils literal notranslate"><span class="pre">easyOCR</span></code><a class="headerlink" href="#perform-ocr-with-easyocr" title="Permalink to this heading">#</a></h4>
<p>Effortlessly extract text from Images with <code class="docutils literal notranslate"><span class="pre">EasyOCR</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">EasyOCR</span></code> is a Python library for Optical Character Recognition (OCR), built on top of PyTorch.</p>
<p>It supports over 80 languages and writing scripts like Latin, Chinese, Arabic and Cyrillic.</p>
<p>See below how easy we can extract text from a given image.</p>
<p>PS: Even if it’s working on CPU, running on GPU is recommended.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install easyocr
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">easyocr</span>

<span class="n">reader</span> <span class="o">=</span> <span class="n">easyocr</span><span class="o">.</span><span class="n">Reader</span><span class="p">([</span><span class="s1">&#39;en&#39;</span><span class="p">])</span>
<span class="n">image_path</span> <span class="o">=</span> <span class="s1">&#39;english_image.png&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readtext</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>

<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="diagram-as-code-with-diagrams">
<h4><span class="section-number">2.1.26. </span>Diagram-as-Code with <code class="docutils literal notranslate"><span class="pre">diagrams</span></code><a class="headerlink" href="#diagram-as-code-with-diagrams" title="Permalink to this heading">#</a></h4>
<p>With the package <code class="docutils literal notranslate"><span class="pre">diagrams</span></code>, you can draw various types of diagrams with Python code.</p>
<p>It offers a simple syntax and nodes from many Cloud Providers like AWS, Azure or GCP.</p>
<p>See below how easy it is to draw a simple architecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install diagrams
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">diagrams</span> <span class="kn">import</span> <span class="n">Diagram</span>
<span class="kn">from</span> <span class="nn">diagrams.aws.compute</span> <span class="kn">import</span> <span class="n">EC2</span>
<span class="kn">from</span> <span class="nn">diagrams.aws.database</span> <span class="kn">import</span> <span class="n">RDS</span>
<span class="kn">from</span> <span class="nn">diagrams.aws.network</span> <span class="kn">import</span> <span class="n">ELB</span>

<span class="k">with</span> <span class="n">Diagram</span><span class="p">(</span><span class="s2">&quot;Grouped Workers&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;TB&quot;</span><span class="p">):</span>
    <span class="n">ELB</span><span class="p">(</span><span class="s2">&quot;lb&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="p">[</span><span class="n">EC2</span><span class="p">(</span><span class="s2">&quot;worker1&quot;</span><span class="p">),</span>
                  <span class="n">EC2</span><span class="p">(</span><span class="s2">&quot;worker2&quot;</span><span class="p">),</span>
                  <span class="n">EC2</span><span class="p">(</span><span class="s2">&quot;worker3&quot;</span><span class="p">),</span>
                  <span class="n">EC2</span><span class="p">(</span><span class="s2">&quot;worker4&quot;</span><span class="p">),</span>
                  <span class="n">EC2</span><span class="p">(</span><span class="s2">&quot;worker5&quot;</span><span class="p">)]</span> <span class="o">&gt;&gt;</span> <span class="n">RDS</span><span class="p">(</span><span class="s2">&quot;events&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="Example of a small Architecture" src="_images/aws_im.png" /></p>
</section>
<section id="powerful-retry-functionality-with-tenacity">
<h4><span class="section-number">2.1.27. </span>Powerful Retry Functionality with <code class="docutils literal notranslate"><span class="pre">tenacity</span></code><a class="headerlink" href="#powerful-retry-functionality-with-tenacity" title="Permalink to this heading">#</a></h4>
<p>What, if an API call in your program fails?</p>
<p>Because of, let’s say, instable internet connection?</p>
<p>This is not so uncommon.</p>
<p>You usually should have some sort of retry mechanism in your program.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">tenacity</span></code> in Python, this isn’t a problem anymore.</p>
<p><code class="docutils literal notranslate"><span class="pre">tenacity</span></code> offers a retrying behaviour with a decorator with powerful features like:</p>
<ul class="simple">
<li><p>Define Stop Conditions</p></li>
<li><p>Define Wait Conditions</p></li>
<li><p>Customize retrying on Exception</p></li>
<li><p>Retry on Coroutines</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install tenacity
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tenacity</span> <span class="k">as</span> <span class="nn">t</span>

<span class="c1"># Stop after N attempts</span>
<span class="nd">@retry</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">stop_after_5_attempts</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stopping after 5 attempts&quot;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">Exception</span>
    
<span class="c1"># OR Condition</span>
<span class="nd">@retry</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">stop_after_delay</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="n">t</span><span class="o">.</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
<span class="k">def</span> <span class="nf">stop_after_10_s_or_5_retries</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stopping after 10 seconds or 5 retries&quot;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">Exception</span>
<span class="c1"># Wait for X Seconds</span>
<span class="nd">@retry</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">wait_fixed</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">wait_2_s</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wait 2 second between retries&quot;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">Exception</span>
    
<span class="c1"># Retry for specific Exceptions</span>
<span class="nd">@retry</span><span class="p">(</span><span class="n">retry</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">retry_if_exception_type</span><span class="p">(</span><span class="ne">IOError</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">might_io_error</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retry forever with no wait if an IOError occurs, raise any other errors&quot;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">Exception</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="performant-graph-analysis-with-python-igraph">
<h4><span class="section-number">2.1.28. </span>Performant Graph Analysis with <code class="docutils literal notranslate"><span class="pre">python-igraph</span></code><a class="headerlink" href="#performant-graph-analysis-with-python-igraph" title="Permalink to this heading">#</a></h4>
<p>When you want to work with graphs in Python</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">python-igraph</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">python-igraph</span></code> offers a Python Interface to igraph, a fast and open source C library to manipulate and analyze graphs.</p>
<p>Due to its high performance, it can handle larger graphs for complex network research which you can visualize with matplotlib or plotly.</p>
<p>It’s documentation also offers neat tutorials for different purposes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install igraph
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">igraph</span> <span class="k">as</span> <span class="nn">ig</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span>
    <span class="mi">6</span><span class="p">,</span>
    <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
<span class="p">)</span>

<span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">g</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span>
    <span class="n">vertex_color</span><span class="o">=</span><span class="s1">&#39;steelblue&#39;</span><span class="p">,</span>
    <span class="n">vertex_label</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()),</span>
    <span class="n">edge_width</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span>
    <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;#666&#39;</span><span class="p">,</span>
    <span class="n">edge_background</span><span class="o">=</span><span class="s1">&#39;white&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="speedtests-via-cli-with-speedtest-cli">
<h4><span class="section-number">2.1.29. </span>Speedtests via CLI with <code class="docutils literal notranslate"><span class="pre">speedtest-cli</span></code><a class="headerlink" href="#speedtests-via-cli-with-speedtest-cli" title="Permalink to this heading">#</a></h4>
<p>If you want to test your internet bandwidth via your CLI</p>
<p>try <code class="docutils literal notranslate"><span class="pre">speedtest-cli</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">speedtest-cli</span></code> tests your internet bandwidth via speedtest(dot)net.</p>
<p>It’s installable via pip.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install speedtest-cli
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!speedtest-cli
</pre></div>
</div>
</div>
</div>
</section>
<section id="minimalistic-database-for-python-with-tinydb">
<h4><span class="section-number">2.1.30. </span>Minimalistic Database for Python with <code class="docutils literal notranslate"><span class="pre">tinydb</span></code><a class="headerlink" href="#minimalistic-database-for-python-with-tinydb" title="Permalink to this heading">#</a></h4>
<p>Do you search for a minimalistic document-oriented database in Python?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">tinydb</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">tinydb</span></code> is written in pure Python and offers a lightweight document-oriented database.</p>
<p>It’s perfect for small apps and hobby projects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install tinydb
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tinydb</span> <span class="kn">import</span> <span class="n">TinyDB</span><span class="p">,</span> <span class="n">Query</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">TinyDB</span><span class="p">(</span><span class="s1">&#39;/path/to/db.json&#39;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;char&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">})</span>
<span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;char&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-code-metrics-with-radon">
<h4><span class="section-number">2.1.31. </span>Calculate Code Metrics with <code class="docutils literal notranslate"><span class="pre">radon</span></code><a class="headerlink" href="#calculate-code-metrics-with-radon" title="Permalink to this heading">#</a></h4>
<p>How do you ensure your codebase stays clean and maintainable?</p>
<p>What if you can calculate how complex your codebase is?</p>
<p>There are different metrics to do that:</p>
<ul class="simple">
<li><p>Raw Metrics like Source Lines of Code (SLOC) or Logical Lines of Code (LLOC). They are not a good estimator for the complexity.</p></li>
<li><p>Cyclomatic Complexity: Corresponds to the number of decisions in the code + 1 (e.g. every for or if counts).</p></li>
<li><p>Halstead Metrics: Metrics derived from the number of distinct and total operators and operands.</p></li>
<li><p>Maintainability Index: Measures how maintainable the code is. It’s a mix of SLOC, Cyclomatic Complexity, and a Halstead Metric.</p></li>
</ul>
<p>With <code class="docutils literal notranslate"><span class="pre">radon</span></code>, you can calculate those metrics described above in Python (or via CLI).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install radon
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!radon cc example.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="better-alternative-to-requests">
<h4><span class="section-number">2.1.32. </span>Better Alternative to <code class="docutils literal notranslate"><span class="pre">requests</span></code><a class="headerlink" href="#better-alternative-to-requests" title="Permalink to this heading">#</a></h4>
<p>Want a better alternative to <code class="docutils literal notranslate"><span class="pre">requests</span></code>?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">httpx</span></code> for Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">httpx</span></code> is a modern alternative to <code class="docutils literal notranslate"><span class="pre">requests</span></code> to make HTTP requests (while having a similar API).</p>
<p>One of the main advantages is it supports asynchronous requests (while <code class="docutils literal notranslate"><span class="pre">requests</span></code> doesn’t).</p>
<p>This can lead to performance improvements when dealing with multiple endpoints concurrently.</p>
<p>Just try it for yourself.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install httpx
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">httpx</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;https://httpbin.org/put&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">})</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;https://httpbin.org/delete&#39;</span><span class="p">)</span>

<span class="c1"># Async support</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
     <span class="n">r</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.example.com/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="managing-configurations-with-python-dotenv">
<h4><span class="section-number">2.1.33. </span>Managing Configurations with <code class="docutils literal notranslate"><span class="pre">python-dotenv</span></code><a class="headerlink" href="#managing-configurations-with-python-dotenv" title="Permalink to this heading">#</a></h4>
<p>Struggling with managing your Python project’s configuration?</p>
<p>Try python-dotenv.</p>
<p>python-dotenv reads key-value pairs from a <code class="docutils literal notranslate"><span class="pre">.env</span></code> file and can set them as environment variables.</p>
<p>You don’t have to hard-code those in your code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install python-dotenv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># .env</span>
<span class="n">API_KEY</span><span class="o">=</span><span class="n">MySuperSecretAPIKey</span>
<span class="n">DOMAIN</span><span class="o">=</span><span class="n">MyDomain</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span><span class="p">,</span> <span class="n">dotenv_values</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Set environment variables defined in .env</span>
<span class="n">load_dotenv</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">))</span>

<span class="c1"># Or as a dictionary, without touching environment variables</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">dotenv_values</span><span class="p">(</span><span class="s2">&quot;.env&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;DOMAIN&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="work-with-notion-via-python-with">
<h4><span class="section-number">2.1.34. </span>Work with Notion via Python with<a class="headerlink" href="#work-with-notion-via-python-with" title="Permalink to this heading">#</a></h4>
<p>Did you know you can interact with Notion via Python?</p>
<p><code class="docutils literal notranslate"><span class="pre">notion-client</span></code> is a Python SDK for working with the Notion API.</p>
<p>You can create databases, search for items, interact with pages, etc.</p>
<p>Check the example below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install notion-client
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">notion_client</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="n">notion</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s2">&quot;&lt;NOTION_TOKEN&gt;&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">notion</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">list</span><span class="p">())</span>

<span class="n">my_page</span> <span class="o">=</span> <span class="n">notion</span><span class="o">.</span><span class="n">databases</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
        <span class="o">**</span><span class="p">{</span>
            <span class="s2">&quot;database_id&quot;</span><span class="p">:</span> <span class="s2">&quot;897e5a76-ae52-4b48-9fdf-e71f5945d1af&quot;</span><span class="p">,</span>
            <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;property&quot;</span><span class="p">:</span> <span class="s2">&quot;Landmark&quot;</span><span class="p">,</span>
                <span class="s2">&quot;rich_text&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;contains&quot;</span><span class="p">:</span> <span class="s2">&quot;Bridge&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
        <span class="p">}</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sql-query-builder-in-python">
<h4><span class="section-number">2.1.35. </span>SQL Query Builder in Python<a class="headerlink" href="#sql-query-builder-in-python" title="Permalink to this heading">#</a></h4>
<p>You can build SQL queries in Python with pypika.</p>
<p>pypika provides a simple interface to build SQL queries with an easy syntax.</p>
<p>It supports nearly every SQL command.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pypika</span> <span class="kn">import</span> <span class="n">Tables</span><span class="p">,</span> <span class="n">Query</span>

<span class="n">history</span><span class="p">,</span> <span class="n">customers</span> <span class="o">=</span> <span class="n">Tables</span><span class="p">(</span><span class="s1">&#39;history&#39;</span><span class="p">,</span> <span class="s1">&#39;customers&#39;</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">Query</span> \
    <span class="o">.</span><span class="n">from_</span><span class="p">(</span><span class="n">history</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">==</span> <span class="n">customers</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">star</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">customers</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
    
<span class="n">q</span><span class="o">.</span><span class="n">get_sql</span><span class="p">()</span>
<span class="c1"># SELECT &quot;history&quot;.* FROM &quot;history&quot; JOIN &quot;customers&quot; </span>
<span class="c1"># ON &quot;history&quot;.&quot;customer_id&quot;=&quot;customers&quot;.&quot;id&quot; WHERE &quot;customers&quot;.&quot;id&quot;=5</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="text-to-speech-generation-with-melotts">
<h4><span class="section-number">2.1.36. </span>Text-to-Speech Generation with <code class="docutils literal notranslate"><span class="pre">MeloTTS</span></code><a class="headerlink" href="#text-to-speech-generation-with-melotts" title="Permalink to this heading">#</a></h4>
<p>Do you want high-quality text-to-speech in Python?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">MeloTTS</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">MeloTTS</span></code> supports various languages for speech generation without needing a GPU.</p>
<p>You can use it via CLI, Python API or Web UI.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!git clone https://github.com/myshell-ai/MeloTTS.git
!cd MeloTTS
!pip install -e .
!python -m unidic download
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!melo &quot;Text to read&quot; output.wav --language EN
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!melo-ui
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">melo.api</span> <span class="kn">import</span> <span class="n">TTS</span>

<span class="n">speed</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;La lueur dorée du soleil caresse les vagues, peignant le ciel d&#39;une palette éblouissante.&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TTS</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="n">speaker_ids</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">hps</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">spk2id</span>

<span class="n">output_path</span> <span class="o">=</span> <span class="s1">&#39;fr.wav&#39;</span>
<span class="n">model</span><span class="o">.</span><span class="n">tts_to_file</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">speaker_ids</span><span class="p">[</span><span class="s1">&#39;FR&#39;</span><span class="p">],</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="powerful-sql-parser-and-transpiler-with-sqlglot">
<h4><span class="section-number">2.1.37. </span>Powerful SQL Parser and Transpiler with <code class="docutils literal notranslate"><span class="pre">SQLGlot</span></code><a class="headerlink" href="#powerful-sql-parser-and-transpiler-with-sqlglot" title="Permalink to this heading">#</a></h4>
<p>With <code class="docutils literal notranslate"><span class="pre">SQLGlot</span></code>, you can parse, optimize, transpile and format SQL queries.</p>
<p>You can even translate between 21 different flavours like DuckDB, Snowflake, Spark and Hive.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install sqlglot
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlglot</span>

<span class="n">sqlglot</span><span class="o">.</span><span class="n">transpile</span><span class="p">(</span><span class="s2">&quot;SELECT TOP 1 salary FROM employees WHERE age &gt; 30&quot;</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="s2">&quot;tsql&quot;</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="s2">&quot;hive&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># SELECT salary FROM employees WHERE age &gt; 30 LIMIT 1</span>

<span class="n">sqlglot</span><span class="o">.</span><span class="n">transpile</span><span class="p">(</span><span class="s2">&quot;SELECT foo FROM (SELECT baz FROM t&quot;</span><span class="p">)</span>
<span class="c1">#ParseError: Expecting ). Line 1, Col: 34. SELECT foo FROM (SELECT baz FROM t</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="prettify-python-errors-with-pretty-errors">
<h4><span class="section-number">2.1.38. </span>Prettify Python Errors with <code class="docutils literal notranslate"><span class="pre">pretty_errors</span></code><a class="headerlink" href="#prettify-python-errors-with-pretty-errors" title="Permalink to this heading">#</a></h4>
<p>Are you annoyed from the unclear Python error messages?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">pretty_errors</span></code>.</p>
<p>It’s a library to prettify Python exception output to make it more readable and clear.</p>
<p>It also allows you to configure the output like changing colors, separator character, displaying locals, etc..</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pretty_errors
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pretty_errors</span>

<span class="c1"># Optional: Configurations</span>
<span class="n">pretty_errors</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">separator_character</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
    <span class="n">filename_display</span>    <span class="o">=</span> <span class="n">pretty_errors</span><span class="o">.</span><span class="n">FILENAME_EXTENDED</span><span class="p">,</span>
    <span class="n">line_number_first</span>   <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">display_link</span>        <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">lines_before</span>        <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">lines_after</span>         <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">line_color</span>          <span class="o">=</span> <span class="n">pretty_errors</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="s1">&#39;&gt; &#39;</span> <span class="o">+</span> <span class="n">pretty_errors</span><span class="o">.</span><span class="n">default_config</span><span class="o">.</span><span class="n">line_color</span><span class="p">,</span>
    <span class="n">code_color</span>          <span class="o">=</span> <span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="n">pretty_errors</span><span class="o">.</span><span class="n">default_config</span><span class="o">.</span><span class="n">line_color</span><span class="p">,</span>
    <span class="n">truncate_code</span>       <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">display_locals</span>      <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">/</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="unified-python-dataframe-api-with-ibis">
<h4><span class="section-number">2.1.39. </span>Unified Python DataFrame API with <code class="docutils literal notranslate"><span class="pre">ibis</span></code><a class="headerlink" href="#unified-python-dataframe-api-with-ibis" title="Permalink to this heading">#</a></h4>
<p>Are you annoyed by learning a new API for handling dataframes every week?</p>
<p>With <code class="docutils literal notranslate"><span class="pre">ibis</span></code>, you don’t have to anymore.</p>
<p><code class="docutils literal notranslate"><span class="pre">ibis</span></code> defines a Python dataframe API which runs on over 20+ backends.</p>
<p>Polars, Pandas, PySpark, Snowflake, BigQuery - you name it.</p>
<p>You just have to install <code class="docutils literal notranslate"><span class="pre">ibis</span></code> with the corresponding backend, the rest stays the same.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install &#39;ibis-framework[duckdb]&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ibis</span>

<span class="c1"># Set different backends</span>
<span class="n">ibis</span><span class="o">.</span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;duckdb&quot;</span><span class="p">)</span> <span class="c1"># or ibis.set_backend(&quot;polars&quot;)</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;data.parquet&quot;</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s2">&quot;species&quot;</span><span class="p">,</span> <span class="s2">&quot;island&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">())</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-beautiful-tables-with-great-tables">
<h4><span class="section-number">2.1.40. </span>Create Beautiful Tables with <code class="docutils literal notranslate"><span class="pre">great_tables</span></code><a class="headerlink" href="#create-beautiful-tables-with-great-tables" title="Permalink to this heading">#</a></h4>
<p>Do you want to create nice-looking tables in Python?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">great_tables</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">great_tables</span></code> lets you create beautiful and high-quality tables with an easy API.</p>
<p>You can use the pre-defined table components like footer, header, and table body by bringing your dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install great_tables
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">great_tables</span> <span class="kn">import</span> <span class="n">GT</span>
<span class="kn">from</span> <span class="nn">great_tables.data</span> <span class="kn">import</span> <span class="n">sp500</span>

<span class="n">start_date</span> <span class="o">=</span> <span class="s2">&quot;2010-06-07&quot;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s2">&quot;2010-06-14&quot;</span>

<span class="p">(</span>
    <span class="n">GT</span><span class="p">(</span><span class="n">sp500</span><span class="p">)</span>
    <span class="o">.</span><span class="n">tab_header</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;S&amp;P 500&quot;</span><span class="p">,</span> <span class="n">subtitle</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">fmt_currency</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">fmt_date</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">date_style</span><span class="o">=</span><span class="s2">&quot;wd_m_day_year&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">fmt_number</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">cols_hide</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;adj_close&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-quality-checks-for-dataframes-with-cuallee">
<h4><span class="section-number">2.1.41. </span>Data Quality Checks for Dataframes with <code class="docutils literal notranslate"><span class="pre">cuallee</span></code><a class="headerlink" href="#data-quality-checks-for-dataframes-with-cuallee" title="Permalink to this heading">#</a></h4>
<p>Do you want to make quality checks for your dataframes?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">cuallee</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">cuallee</span></code> provides an API to validate your dataframe for common things like completeness, dates, anomalies or membership.</p>
<p><code class="docutils literal notranslate"><span class="pre">cuallee</span></code> supports the most popular libraries and providers like Polars, DuckDB, BigQuery, and Snowflake.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install cuallee
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cuallee</span> <span class="kn">import</span> <span class="n">Check</span><span class="p">,</span> <span class="n">CheckLevel</span>

<span class="n">check</span> <span class="o">=</span> <span class="n">Check</span><span class="p">(</span><span class="n">CheckLevel</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Completeness&quot;</span><span class="p">)</span>
<span class="p">(</span>
    <span class="n">check</span>
    <span class="o">.</span><span class="n">is_complete</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">is_unique</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">check</span> <span class="o">=</span> <span class="n">Check</span><span class="p">(</span><span class="n">CheckLevel</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;CheckIsBetweenDates&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SELECT</span>
<span class="sd">        explode(</span>
<span class="sd">            sequence(</span>
<span class="sd">                to_date(&#39;2022-01-01&#39;),</span>
<span class="sd">                to_date(&#39;2022-01-10&#39;),</span>
<span class="sd">                interval 1 day)) as date</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="n">check</span><span class="o">.</span><span class="n">is_between</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;2022-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2022-01-10&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;PASS&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="ocr-line-detection-and-layout-analysis-with-surya">
<h4><span class="section-number">2.1.42. </span>OCR, Line Detection and Layout Analysis with <code class="docutils literal notranslate"><span class="pre">surya</span></code><a class="headerlink" href="#ocr-line-detection-and-layout-analysis-with-surya" title="Permalink to this heading">#</a></h4>
<p>Do you need an open-source OCR package?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">surya</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">surya</span></code> is an OCR + layout analysis + line detection library for Python, supporting over 90 languages.</p>
<p>A great alternative to popular libraries like easyocr.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install surya-ocr
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">surya.ocr</span> <span class="kn">import</span> <span class="n">run_ocr</span>
<span class="kn">from</span> <span class="nn">surya.model.detection</span> <span class="kn">import</span> <span class="n">segformer</span>
<span class="kn">from</span> <span class="nn">surya.model.recognition.model</span> <span class="kn">import</span> <span class="n">load_model</span>
<span class="kn">from</span> <span class="nn">surya.model.recognition.processor</span> <span class="kn">import</span> <span class="n">load_processor</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">IMAGE_PATH</span><span class="p">)</span>
<span class="n">langs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;en&quot;</span><span class="p">]</span>
<span class="n">det_processor</span><span class="p">,</span> <span class="n">det_model</span> <span class="o">=</span> <span class="n">segformer</span><span class="o">.</span><span class="n">load_processor</span><span class="p">(),</span> <span class="n">segformer</span><span class="o">.</span><span class="n">load_model</span><span class="p">()</span>
<span class="n">rec_model</span><span class="p">,</span> <span class="n">rec_processor</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(),</span> <span class="n">load_processor</span><span class="p">()</span>

<span class="n">predictions</span> <span class="o">=</span> <span class="n">run_ocr</span><span class="p">([</span><span class="n">image</span><span class="p">],</span> <span class="p">[</span><span class="n">langs</span><span class="p">],</span> <span class="n">det_model</span><span class="p">,</span> <span class="n">det_processor</span><span class="p">,</span> <span class="n">rec_model</span><span class="p">,</span> <span class="n">rec_processor</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="decode-encode-jwts-with-pyjwt">
<h4><span class="section-number">2.1.43. </span>Decode/Encode JWTs with <code class="docutils literal notranslate"><span class="pre">PyJWT</span></code><a class="headerlink" href="#decode-encode-jwts-with-pyjwt" title="Permalink to this heading">#</a></h4>
<p>For working with JWT in Python, use <code class="docutils literal notranslate"><span class="pre">PyJWT</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">PyJWT</span></code> is a Python library for encoding/decoding JWTs easily.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pyjwt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jwt</span>
<span class="n">encoded_jwt</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">({</span><span class="s2">&quot;some&quot;</span><span class="p">:</span> <span class="s2">&quot;payload&quot;</span><span class="p">},</span> <span class="s2">&quot;secret&quot;</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;HS256&quot;</span><span class="p">)</span>
<span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoded_jwt</span><span class="p">,</span> <span class="s2">&quot;secret&quot;</span><span class="p">,</span> <span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;HS256&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-html-to-markdown-with-markdownify">
<h4><span class="section-number">2.1.44. </span>Convert HTML to Markdown with <code class="docutils literal notranslate"><span class="pre">markdownify</span></code><a class="headerlink" href="#convert-html-to-markdown-with-markdownify" title="Permalink to this heading">#</a></h4>
<p>To convert HTML to Markdown with Python, use <code class="docutils literal notranslate"><span class="pre">markdownify</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">markdownify</span></code> is a Python library which provides a simple function to convert HTML to markdown.</p>
<p>It also supports many options like stripping out elements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install markdownify
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">markdownify</span> <span class="kn">import</span> <span class="n">markdownify</span> <span class="k">as</span> <span class="n">md</span>
<span class="n">md</span><span class="p">(</span><span class="s1">&#39;&lt;b&gt;Yay&lt;/b&gt; &lt;a href=&quot;http://github.com&quot;&gt;GitHub&lt;/a&gt;&#39;</span><span class="p">)</span>  
<span class="c1"># Output: &#39;**Yay** [GitHub](http://github.com)&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="build-web-apps-with-mesop">
<h4><span class="section-number">2.1.45. </span>Build Web Apps with <code class="docutils literal notranslate"><span class="pre">mesop</span></code><a class="headerlink" href="#build-web-apps-with-mesop" title="Permalink to this heading">#</a></h4>
<p>Google Devs published a new open-source Streamlit competitor.</p>
<p>It’s called <code class="docutils literal notranslate"><span class="pre">mesop</span></code> to build web apps in Python rapidly.</p>
<p>It provides ready-to-use components or you can build your ones, without writing HTML/CSS/JS code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install mesop
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mesop</span> <span class="k">as</span> <span class="nn">me</span>
<span class="kn">import</span> <span class="nn">mesop.labs</span> <span class="k">as</span> <span class="nn">mel</span>

<span class="nd">@me</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/chat&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">chat</span><span class="p">():</span>
  <span class="n">mel</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">history</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">mel</span><span class="o">.</span><span class="n">ChatMessage</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
  <span class="k">return</span> <span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="n">prompt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="anonymize-pii-data-with-presidio">
<h4><span class="section-number">2.1.46. </span>Anonymize PII Data with <code class="docutils literal notranslate"><span class="pre">presidio</span></code><a class="headerlink" href="#anonymize-pii-data-with-presidio" title="Permalink to this heading">#</a></h4>
<p>Working with PII data can be a neckbreaker in some cases.</p>
<p>Luckily, for fast anonymization, you can use presidio.</p>
<p>presidio handles anonymization of popular entities like names, phone numbers, credit card numbers or Bitcoin wallets.</p>
<p>It can even handle text in images!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install presidio_analyzer presidio_anonymizer
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!python -m spacy download en_core_web_lg
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">presidio_analyzer</span> <span class="kn">import</span> <span class="n">AnalyzerEngine</span>
<span class="kn">from</span> <span class="nn">presidio_anonymizer</span> <span class="kn">import</span> <span class="n">AnonymizerEngine</span>

<span class="n">text_to_anonymize</span> <span class="o">=</span> <span class="s2">&quot;His name is Mr. Jones. His phone number is 212-555-5555.&quot;</span>

<span class="n">analyzer</span> <span class="o">=</span> <span class="n">AnalyzerEngine</span><span class="p">()</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text_to_anonymize</span><span class="p">,</span> <span class="n">entities</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PHONE_NUMBER&quot;</span><span class="p">,</span> <span class="s2">&quot;PERSON&quot;</span><span class="p">],</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">)</span>

<span class="n">anonymizer</span> <span class="o">=</span> <span class="n">AnonymizerEngine</span><span class="p">()</span>

<span class="n">anonymized_text</span> <span class="o">=</span> <span class="n">anonymizer</span><span class="o">.</span><span class="n">anonymize</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text_to_anonymize</span><span class="p">,</span> <span class="n">analyzer_results</span><span class="o">=</span><span class="n">results</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">anonymized_text</span><span class="p">)</span>

<span class="c1"># Output: His name is Mr. &lt;PERSON&gt;. His phone number is &lt;PHONE_NUMBER&gt;.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="extract-skills-from-job-postings-with-skillner">
<h4><span class="section-number">2.1.47. </span>Extract Skills from Job Postings with <code class="docutils literal notranslate"><span class="pre">skillner</span></code><a class="headerlink" href="#extract-skills-from-job-postings-with-skillner" title="Permalink to this heading">#</a></h4>
<p>Extracting skills from unstructured data can be difficult.</p>
<p>With 𝐬𝐤𝐢𝐥𝐥𝐧𝐞𝐫 it doesn’t have to be.</p>
<p>𝐬𝐤𝐢𝐥𝐥𝐧𝐞𝐫 extracts skills and certifications from data based on an open source skills database.</p>
<p>Based on spacy and some simple rules, it achieved good results in some tests I ran.</p>
<p>Of course, you could also run an LLM on job ads, but do you need it?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install skillNer
!python -m spacy download en_core_web_lg
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>
<span class="kn">from</span> <span class="nn">spacy.matcher</span> <span class="kn">import</span> <span class="n">PhraseMatcher</span>
<span class="kn">from</span> <span class="nn">skillNer.general_params</span> <span class="kn">import</span> <span class="n">SKILL_DB</span>
<span class="kn">from</span> <span class="nn">skillNer.skill_extractor_class</span> <span class="kn">import</span> <span class="n">SkillExtractor</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;en_core_web_lg&quot;</span><span class="p">)</span>
<span class="n">skill_extractor</span> <span class="o">=</span> <span class="n">SkillExtractor</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">SKILL_DB</span><span class="p">,</span> <span class="n">PhraseMatcher</span><span class="p">)</span>

<span class="n">job_description</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are a Python developer with a expertise in backend development</span>
<span class="s2">and can manage projects. You quickly adapt to new environments</span>
<span class="s2">and speak fluently English and German.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">annotations</span> <span class="o">=</span> <span class="n">skill_extractor</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">job_description</span><span class="p">)</span>

<span class="n">skill_extractor</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">annotations</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="rate-limiting-fastapi-with-slowapi">
<h4><span class="section-number">2.1.48. </span>Rate Limiting FastAPI with <code class="docutils literal notranslate"><span class="pre">slowapi</span></code><a class="headerlink" href="#rate-limiting-fastapi-with-slowapi" title="Permalink to this heading">#</a></h4>
<p>Preventing abuse of your API is crucial.</p>
<p>To implement rate limiting for FastAPI, you can use <code class="docutils literal notranslate"><span class="pre">slowapi</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">slowapi</span></code> offers utility functions to limit your FastAPI or Starlette app based on e.g. the IP address.</p>
<p>In the example below, we limit our API to 5 requests per minute.</p>
<p>A note from the author: This is alpha quality code still, the API may change, and things may fall apart while you try it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install slowapi
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">slowapi</span> <span class="kn">import</span> <span class="n">Limiter</span><span class="p">,</span> <span class="n">_rate_limit_exceeded_handler</span>
<span class="kn">from</span> <span class="nn">slowapi.util</span> <span class="kn">import</span> <span class="n">get_remote_address</span>
<span class="kn">from</span> <span class="nn">slowapi.errors</span> <span class="kn">import</span> <span class="n">RateLimitExceeded</span>

<span class="c1"># Limiting based on user&#39;s IP address</span>
<span class="n">limiter</span> <span class="o">=</span> <span class="n">Limiter</span><span class="p">(</span><span class="n">key_func</span><span class="o">=</span><span class="n">get_remote_address</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">limiter</span> <span class="o">=</span> <span class="n">limiter</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_exception_handler</span><span class="p">(</span><span class="n">RateLimitExceeded</span><span class="p">,</span> <span class="n">_rate_limit_exceeded_handler</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/home&quot;</span><span class="p">)</span>
<span class="nd">@limiter</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="s2">&quot;5/minute&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;response&quot;</span><span class="p">:</span><span class="s2">&quot;Hello&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-cli-out-of-any-python-object-with-fire">
<h4><span class="section-number">2.1.49. </span>Create CLI out of any Python Object with <code class="docutils literal notranslate"><span class="pre">fire</span></code><a class="headerlink" href="#create-cli-out-of-any-python-object-with-fire" title="Permalink to this heading">#</a></h4>
<p>Transform any Python object into a CLI with <code class="docutils literal notranslate"><span class="pre">fire</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">fire</span></code> is a neat library for turning your Python object into a CLI and making the transition between Python and Bash easier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install fire
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># hello.py</span>
<span class="kn">import</span> <span class="nn">fire</span>

<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;World&quot;</span><span class="p">):</span>
  <span class="k">return</span> <span class="s2">&quot;Hello </span><span class="si">%s</span><span class="s2">!&quot;</span> <span class="o">%</span> <span class="n">name</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">fire</span><span class="o">.</span><span class="n">Fire</span><span class="p">(</span><span class="n">hello</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!python hello.py --name=David
</pre></div>
</div>
</div>
</div>
</section>
<section id="environment-variables-management-with-pydantic-settings">
<h4><span class="section-number">2.1.50. </span>Environment Variables Management with <code class="docutils literal notranslate"><span class="pre">pydantic-settings</span></code><a class="headerlink" href="#environment-variables-management-with-pydantic-settings" title="Permalink to this heading">#</a></h4>
<p>Is this the best way to work with environment variables?</p>
<p><strong>pydantic-settings</strong> makes it so easy to work with your environment variables in an easy way.</p>
<p>Why it’s a great tool:</p>
<ul class="simple">
<li><p>Type-safe configuration with zero boilerplate</p></li>
<li><p>Automatic environment variable loading</p></li>
<li><p>Built-in validation and error handling</p></li>
<li><p>Seamless .env file support</p></li>
</ul>
<p>For your settings, just create a class which inherits from <strong>BaseSettings</strong> and define your variables there.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pydantic-settings
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic_settings</span> <span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>
<span class="kn">from</span> <span class="nn">pydanctic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">Environment</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">DEV</span> <span class="o">=</span> <span class="s1">&#39;dev&#39;</span>
    <span class="n">STAGING</span> <span class="o">=</span> <span class="s1">&#39;staging&#39;</span>
    <span class="n">PROD</span> <span class="o">=</span> <span class="s1">&#39;prod&#39;</span>
    
<span class="k">class</span> <span class="nc">RedisSettings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">AppSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span><span class="n">env_file</span><span class="o">=</span><span class="s1">&#39;.env&#39;</span><span class="p">)</span>
    
    <span class="n">redis</span><span class="p">:</span> <span class="n">RedisSettings</span>
    <span class="n">app_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Environment</span>
    <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    
<span class="n">settings</span> <span class="o">=</span> <span class="n">AppSettings</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">redis</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"># .env</span>
<span class="sd">APP_NAME=YourAppName</span>
<span class="sd">ENVIRONMENT=dev</span>
<span class="sd">DEBUG_MODE=False</span>
<span class="sd">REDIS=&#39;{&quot;host&quot;: &quot;localhost&quot;, &quot;port&quot;: 6379}&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="deduplicate-huge-datasets-with-semhash">
<h4><span class="section-number">2.1.51. </span>Deduplicate Huge Datasets with <code class="docutils literal notranslate"><span class="pre">semhash</span></code><a class="headerlink" href="#deduplicate-huge-datasets-with-semhash" title="Permalink to this heading">#</a></h4>
<p>Deduplicate your data at lightning speed in Python! 🔥</p>
<p>Having duplicates in your dataset is annoying and needs to be removed as they do not contribute positively to model training.</p>
<p>But they can be difficult to detect, especially semantic duplicates.</p>
<p>Fortunately, 𝐬𝐞𝐦𝐡𝐚𝐬𝐡 has you covered!</p>
<p>𝐬𝐞𝐦𝐡𝐚𝐬𝐡 deduplicates your dataset at lightning speed.</p>
<p>It uses fast embedding generation with Model2Vec and optional ANN-based similarity search with Vicinity.</p>
<p>For a dataset of 1.8M rows, 𝐬𝐞𝐦𝐡𝐚𝐬𝐡 takes 83 seconds to deduplicate. 🔥</p>
<p>You can, of course, use any model supported by sentence-transformers, or bring your own model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install semhash
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
<span class="kn">from</span> <span class="nn">semhash</span> <span class="kn">import</span> <span class="n">SemHash</span>

<span class="n">texts</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;ag_news&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>

<span class="n">semhash</span> <span class="o">=</span> <span class="n">SemHash</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">records</span><span class="o">=</span><span class="n">texts</span><span class="p">)</span>

<span class="n">deduplicated_texts</span> <span class="o">=</span> <span class="n">semhash</span><span class="o">.</span><span class="n">self_deduplicate</span><span class="p">()</span><span class="o">.</span><span class="n">deduplicated</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="fast-http-server-robyn">
<h4><span class="section-number">2.1.52. </span>Fast HTTP Server: <code class="docutils literal notranslate"><span class="pre">robyn</span></code><a class="headerlink" href="#fast-http-server-robyn" title="Permalink to this heading">#</a></h4>
<p>Do you need a lightweight alternative to FastAPI?</p>
<p>Try out 𝗿𝗼𝗯𝘆𝗻.</p>
<p>𝗿𝗼𝗯𝘆𝗻 is a fast and lightweight web framework written in Rust (like everything else these days).</p>
<p>It combines Python’s async capabilities with a Rust runtime.</p>
<p>With a similar syntax and a great documentation, 𝗿𝗼𝗯𝘆𝗻 makes it easy to switch from other frameworks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install robyn
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># app.py</span>
<span class="kn">from</span> <span class="nn">robyn</span> <span class="kn">import</span> <span class="n">Robyn</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Robyn</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Hello, world!&quot;</span>

<span class="n">app</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!python app.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="gzip-compression-with-fastapi">
<h4><span class="section-number">2.1.53. </span>GZip Compression with FastAPI<a class="headerlink" href="#gzip-compression-with-fastapi" title="Permalink to this heading">#</a></h4>
<p>One small trick to optimize your FastAPI application.
(with 2 lines of code!)</p>
<p>Whenever your API sends larger amounts of data, GZip compression helps in improving latency and reducing bandwidth usage.</p>
<p>Starlette provides the <strong>GZipMiddleware</strong>, which can be used by FastAPI to compress the response data.</p>
<p>-&gt; Adjust the <strong>minimum_size</strong> parameter to set the minimum size before compression is applied.
-&gt; Adjust the <strong>compresslevel</strong> parameter to control how fast the compression is vs how big the compressed file will be.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">starlette.middleware.gzip</span> <span class="kn">import</span> <span class="n">GZipMiddleware</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span><span class="n">GZipMiddleware</span><span class="p">,</span> <span class="n">minimum_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">compresslevel</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/large-data&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_large_data</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]}</span>
    

<span class="c1"># curl -I -H &quot;Accept-Encoding: gzip&quot; http://127.0.0.1:8000/large-data</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/jupyternotebook/index"></span><section id="jupyter-notebook-tricks-and-tips">
<h2><span class="section-number">3. </span>Jupyter Notebook Tricks and Tips<a class="headerlink" href="#jupyter-notebook-tricks-and-tips" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/jupyternotebook/Chapter"></span><section id="jupyter-notebook-tips-and-tricks">
<h3><span class="section-number">3.1. </span>Jupyter Notebook Tips and Tricks<a class="headerlink" href="#jupyter-notebook-tips-and-tricks" title="Permalink to this heading">#</a></h3>
<section id="identify-your-bottleneck-with-line-profiler">
<h4><span class="section-number">3.1.1. </span>Identify your bottleneck with <code class="docutils literal notranslate"><span class="pre">line_profiler</span></code><a class="headerlink" href="#identify-your-bottleneck-with-line-profiler" title="Permalink to this heading">#</a></h4>
<p>Want to identify the bottleneck in your Python code?</p>
<p>Try the module <code class="docutils literal notranslate"><span class="pre">line_profiler</span></code> for Python.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">line_profiler</span></code>, you will get a line-by-line profiling of your functions.</p>
<p>So you can exactly see the execution time for every line.</p>
<p>Below you can see how to use <code class="docutils literal notranslate"><span class="pre">line_profiler</span></code> within a Jupyter Notebook.</p>
<ul class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">%load_ext</span></code> magic command to load the <code class="docutils literal notranslate"><span class="pre">line_profiler</span></code> extension.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">%lprun</span></code> magic command to profile a specific cell or function in the notebook.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install line_profiler
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">line_profiler</span>

<span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">):</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">400</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">y</span>
    
<span class="o">%</span><span class="n">lprun</span> <span class="o">-</span><span class="n">u</span> <span class="mf">1e-3</span> <span class="o">-</span><span class="n">f</span> <span class="n">my_function</span> <span class="n">my_function</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Timer unit: 0.001 s</span>

<span class="sd">Total time: 0.0160793 s</span>
<span class="sd">File: &lt;ipython-input-18-790da5f104f0&gt;</span>
<span class="sd">Function: my_function at line 1</span>

<span class="sd">Line #      Hits         Time  Per Hit   % Time  Line Contents</span>
<span class="sd">==============================================================</span>
<span class="sd">     1                                           def my_function(x):</span>
<span class="sd">     2      9999          2.6      0.0     16.3      for x in range(1, 10000):</span>
<span class="sd">     3      9999          6.1      0.0     37.7        x = x**2</span>
<span class="sd">     4      9999          7.4      0.0     46.1        x = x / 400</span>
<span class="sd">     5         1          0.0      0.0      0.0      y = x + x</span>
<span class="sd">     6         1          0.0      0.0      0.0      return y</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="render-live-loss-of-deep-learning-models-in-jupyter-notebooks">
<h4><span class="section-number">3.1.2. </span>Render Live loss of Deep Learning Models in Jupyter Notebooks<a class="headerlink" href="#render-live-loss-of-deep-learning-models-in-jupyter-notebooks" title="Permalink to this heading">#</a></h4>
<p>Plot your live training loss in Jupyter Notebooks with <code class="docutils literal notranslate"><span class="pre">livelossplot</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">livelossplot</span></code> lets you track your model’s training process in real time, only adding one callback.</p>
<p>A nice alternative to TensorBoard, if you want to train a small model and visualize its progress quickly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install livelossplot
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">keras.datasets</span> <span class="kn">import</span> <span class="n">mnist</span>
<span class="kn">from</span> <span class="nn">keras.utils</span> <span class="kn">import</span> <span class="n">to_categorical</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Activation</span>

<span class="kn">from</span> <span class="nn">livelossplot</span> <span class="kn">import</span> <span class="n">PlotLossesKeras</span>

<span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

<span class="n">Y_train</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">Y_test</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>

<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Flatten</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">&#39;softmax&#39;</span><span class="p">))</span>

<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;rmsprop&#39;</span><span class="p">,</span>
              <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>

<span class="n">plotlosses</span> <span class="o">=</span> <span class="n">PlotLossesKeras</span><span class="p">()</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span>
          <span class="n">epochs</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
          <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">),</span>
          <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">plotlosses</span><span class="p">],</span>
          <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-latex-expressions-from-python-code">
<h4><span class="section-number">3.1.3. </span>Generate LaTeX Expressions from Python Code<a class="headerlink" href="#generate-latex-expressions-from-python-code" title="Permalink to this heading">#</a></h4>
<p>With <code class="docutils literal notranslate"><span class="pre">latexify</span></code>, you can compile Python source code to a beautiful LaTeX expression.</p>
<p>In a quick and easy way!</p>
<p>Useful, when you don’t want to write the LaTeX expression by yourself.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install latexify-py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">latexify</span>
<span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@latexify</span><span class="o">.</span><span class="n">function</span>
<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">solve</span><span class="p">)</span>
<span class="n">solve</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="display-scikit-learn-pipelines-as-html">
<h4><span class="section-number">3.1.4. </span>Display Scikit-Learn Pipelines as HTML<a class="headerlink" href="#display-scikit-learn-pipelines-as-html" title="Permalink to this heading">#</a></h4>
<p>You can display an interactive HTML diagram of scikit-learn pipelines.</p>
<p>Just set the config to <code class="docutils literal notranslate"><span class="pre">diagram</span></code> (you can still switch back to <code class="docutils literal notranslate"><span class="pre">text</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">RobustScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>

<span class="n">numeric_preprocessor</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;imputation_mean&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;scaling&quot;</span><span class="p">,</span> <span class="n">RobustScaler</span><span class="p">()),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">categorical_preprocessor</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span>
            <span class="s2">&quot;imputation_constant&quot;</span><span class="p">,</span>
            <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;one_hot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;categorical&quot;</span><span class="p">,</span> <span class="n">categorical_preprocessor</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;gender&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;numerical&quot;</span><span class="p">,</span> <span class="n">numeric_preprocessor</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="autoreload-your-modules-in-jupyter-notebook">
<h4><span class="section-number">3.1.5. </span>Autoreload your Modules in Jupyter Notebook<a class="headerlink" href="#autoreload-your-modules-in-jupyter-notebook" title="Permalink to this heading">#</a></h4>
<p>When you work on a new Python module and test it in a Jupyter notebook</p>
<p>You have to reload the module when you change it.</p>
<p><code class="docutils literal notranslate"><span class="pre">autoreload</span></code> makes sure all modules will be reimported.</p>
<p>Just by adding two lines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>

<span class="kn">from</span> <span class="nn">my_module</span> <span class="kn">import</span> <span class="n">my_function1</span><span class="p">,</span> <span class="n">my_function2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_function1</span><span class="p">()</span>

<span class="n">my_function2</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="apply-code-quality-tools-to-jupyter-notebooks">
<h4><span class="section-number">3.1.6. </span>Apply Code Quality Tools to Jupyter Notebooks<a class="headerlink" href="#apply-code-quality-tools-to-jupyter-notebooks" title="Permalink to this heading">#</a></h4>
<p>Do you look for Code quality within Jupyter Notebooks?</p>
<p>One limitation of widespread tools like black, flake8 or isort is the incompatibility with notebooks.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">nbqa</span></code>, you can effortlessly apply code quality tools to notebooks.</p>
<p>See below how we can apply black and isort on notebooks.</p>
<p>Say hello to clean(er) notebooks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install &quot;nbqa[toolchain]&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!nbqa black my_notebook.ipynb
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!nbqa isort my_notebook.ipynb --float-to-top
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-and-reuse-juptyer-notebook-templates">
<h4><span class="section-number">3.1.7. </span>Create and Reuse Juptyer Notebook Templates<a class="headerlink" href="#create-and-reuse-juptyer-notebook-templates" title="Permalink to this heading">#</a></h4>
<p>If you are a heavy JupyterLab user,</p>
<p>do you create a new notebook from scratch every time?</p>
<p>With <code class="docutils literal notranslate"><span class="pre">jupytertemplate</span></code>, you don’t need to.</p>
<p><code class="docutils literal notranslate"><span class="pre">jupytertemplate</span></code> lets you create Notebook templates you can reuse every time.</p>
<p>Do you have the same structure for every EDA? Create a template and reuse it.</p>
<p>No need to create a notebook and structure it manually.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!jupyter labextension install jupyterlab_templates
!jupyter server extension enable --py jupyterlab_templates
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the following to jupyter_notebook_config.py</span>

<span class="n">c</span><span class="o">.</span><span class="n">JupyterLabTemplates</span><span class="o">.</span><span class="n">allowed_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*.ipynb&quot;</span><span class="p">]</span>
<span class="n">c</span><span class="o">.</span><span class="n">JupyterLabTemplates</span><span class="o">.</span><span class="n">template_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;of&#39;</span><span class="p">,</span> <span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;directories&#39;</span><span class="p">]</span>
<span class="n">c</span><span class="o">.</span><span class="n">JupyterLabTemplates</span><span class="o">.</span><span class="n">include_default</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">c</span><span class="o">.</span><span class="n">JupyterLabTemplates</span><span class="o">.</span><span class="n">include_core_paths</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="remove-output-cells-automatically-with-nbstripout">
<h4><span class="section-number">3.1.8. </span>Remove Output Cells Automatically with <code class="docutils literal notranslate"><span class="pre">nbstripout</span></code><a class="headerlink" href="#remove-output-cells-automatically-with-nbstripout" title="Permalink to this heading">#</a></h4>
<p>Are you tracking outputs of Jupyter Notebooks in Git?</p>
<p>Stop that.</p>
<p>Output cells in Notebooks can contain large amounts of data, such as the results of computations or visualizations.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">nbstripout</span></code>, you can strip them out.</p>
<p>It helps you to reduce the size of committed changes and the risk of pushing sensitive data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install nbstripout
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!nbstripout FILE.ipynb
</pre></div>
</div>
</div>
</div>
</section>
<section id="bring-llms-into-your-notebook-with-jupyter-ai">
<h4><span class="section-number">3.1.9. </span>Bring LLMs Into Your Notebook with <code class="docutils literal notranslate"><span class="pre">jupyter-ai</span></code><a class="headerlink" href="#bring-llms-into-your-notebook-with-jupyter-ai" title="Permalink to this heading">#</a></h4>
<p>Bring GenAI into your Jupyter Notebooks with <code class="docutils literal notranslate"><span class="pre">jupyter-ai</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">jupyter-ai</span></code> lets you use LLMs from vendors like OpenAI, Huggingface and Anthropic within your Notebook cells.</p>
<p>You can just ask for a code snippet and the result will be rendered into your Notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">env</span> <span class="n">PROVIDER_API_KEY</span><span class="o">=</span><span class="n">YOUR_API_KEY_HERE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install jupyter_ai
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">jupyter_ai</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">ai</span> <span class="n">chatgpt</span>
<span class="n">Provide</span> <span class="n">a</span> <span class="n">hello</span> <span class="n">world</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">Python</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="modern-alternative-to-jupyter-notebook">
<h4><span class="section-number">3.1.10. </span>Modern Alternative to Jupyter Notebook<a class="headerlink" href="#modern-alternative-to-jupyter-notebook" title="Permalink to this heading">#</a></h4>
<p>Forget Jupyter Notebooks.</p>
<p><code class="docutils literal notranslate"><span class="pre">Marimo</span></code> Notebook is the future.</p>
<p><code class="docutils literal notranslate"><span class="pre">Marimo</span></code> Notebooks are a git-friendly, reactive and interactive alternative to Jupyter Notebooks by providing the following features:</p>
<ul class="simple">
<li><p>Automatically re-running affected cells when changing something</p></li>
<li><p>Notebooks are executed in a deterministic order, with no hidden state</p></li>
<li><p>Easily deployable</p></li>
<li><p>Interactive elements</p></li>
</ul>
<p>Just give it a try, it’s open-source too!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install marimo
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!marimo edit
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/documentation/index"></span><section id="documentation">
<h2><span class="section-number">4. </span>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/documentation/Chapter"></span><section id="documentation">
<h3><span class="section-number">4.1. </span>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading">#</a></h3>
<section id="auto-generate-documentation-for-your-api">
<h4><span class="section-number">4.1.1. </span>Auto-generate Documentation for your API<a class="headerlink" href="#auto-generate-documentation-for-your-api" title="Permalink to this heading">#</a></h4>
<p>If you want to Auto-generate Documentation for your API</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">pdoc</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pdoc</span></code> is a simple library to create a cool documentation page that follows your project’s Python module hierarchy.</p>
<p>No need for difficult configuration, it runs without configuring 100 things.</p>
<p>A cool alternative to Sphinx.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pdoc
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pdoc preprocessing.py
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/machinelearning/index"></span><section id="machine-learning">
<h2><span class="section-number">5. </span>Machine Learning<a class="headerlink" href="#machine-learning" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/machinelearning/dataaugmentation"></span><section id="data-augmentation">
<h3><span class="section-number">5.1. </span>Data Augmentation<a class="headerlink" href="#data-augmentation" title="Permalink to this heading">#</a></h3>
<section id="image-augmentation-with-albumentations">
<h4><span class="section-number">5.1.1. </span>Image augmentation with <code class="docutils literal notranslate"><span class="pre">albumentations</span></code><a class="headerlink" href="#image-augmentation-with-albumentations" title="Permalink to this heading">#</a></h4>
<p>Are you looking for a powerful library for image augmentation?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">albumentations</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">albumentations</span></code> is a Python library for fast and easy image augmentation, working seamlessly with PyTorch and Tensorflow.</p>
<p>You can easily apply over 70 different transformations.</p>
<p>And boost your Computer Vision model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install albumentations
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">albumentations</span> <span class="k">as</span> <span class="nn">A</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;image.jpg&quot;</span><span class="p">)</span>

<span class="c1"># Define the augmentations you want to apply</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
    <span class="n">A</span><span class="o">.</span><span class="n">HorizontalFlip</span><span class="p">(),</span>
    <span class="n">A</span><span class="o">.</span><span class="n">ToGray</span><span class="p">(),</span>
    <span class="n">A</span><span class="o">.</span><span class="n">GridDropout</span><span class="p">(),</span>
    <span class="n">A</span><span class="o">.</span><span class="n">VerticalFlip</span><span class="p">(),</span>
    <span class="n">A</span><span class="o">.</span><span class="n">ChannelShuffle</span><span class="p">(),</span>
<span class="p">])</span>



<span class="c1"># Apply the augmentations to the image</span>
<span class="n">augmented_images</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="p">))[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/machinelearning/deployment"></span><section id="deployment">
<h3><span class="section-number">5.2. </span>Deployment<a class="headerlink" href="#deployment" title="Permalink to this heading">#</a></h3>
<section id="deploy-ml-models-with-litserve">
<h4><span class="section-number">5.2.1. </span>Deploy ML Models with <code class="docutils literal notranslate"><span class="pre">litserve</span></code><a class="headerlink" href="#deploy-ml-models-with-litserve" title="Permalink to this heading">#</a></h4>
<p>This is the best way to deploy your Machine Learning model.</p>
<p>(I am not exaggerating)</p>
<p><code class="docutils literal notranslate"><span class="pre">litserve</span></code> is the new kid on the ML deployment block.</p>
<p>Based on FastAPI, <code class="docutils literal notranslate"><span class="pre">litserve</span></code> provides a great serving engine for any kind of model.</p>
<p>✅ Open-source
✅ Easy to use
✅ 2x faster than using FastAPI by yourself
✅ Supports Batching and Streaming
✅ GPU Autoscaling
✅ Automatic Dockerization
… and so much more!</p>
<p>I am really in love with it because it is so easy to use and does not make things more complicated than they already are.</p>
<p>The team behind the project is also very active and supportive.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install litserve
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">litserve</span> <span class="k">as</span> <span class="nn">ls</span>

<span class="k">class</span> <span class="nc">XGBoostAPI</span><span class="p">(</span><span class="n">ls</span><span class="o">.</span><span class="n">LitAPI</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;model.joblib&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decode_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">encode_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;class_idx&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">output</span><span class="p">)}</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">XGBoostAPI</span><span class="p">()</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">LitServer</span><span class="p">(</span><span class="n">api</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/machinelearning/eda"></span><section id="eda">
<h3><span class="section-number">5.3. </span>EDA<a class="headerlink" href="#eda" title="Permalink to this heading">#</a></h3>
<section id="analyze-and-visualize-data-interactively-with-d-tale">
<h4><span class="section-number">5.3.1. </span>Analyze and visualize data interactively with <code class="docutils literal notranslate"><span class="pre">D-Tale</span></code><a class="headerlink" href="#analyze-and-visualize-data-interactively-with-d-tale" title="Permalink to this heading">#</a></h4>
<p>Do you still perform your EDA manually?</p>
<p>And do the same repetitive steps?</p>
<p>Let <code class="docutils literal notranslate"><span class="pre">D-Tale</span></code> help you.</p>
<p><code class="docutils literal notranslate"><span class="pre">D-Tale</span></code> is a powerful Python library that allows you to easily inspect and analyze your data interactively.</p>
<p>You can view your data in a web-based interface with various visualizations.</p>
<p><code class="docutils literal notranslate"><span class="pre">D-Tale</span></code> supports a wide variety of data types and formats, including CSV, Excel, JSON, SQL, and more.</p>
<p>Bonus: You can export the corresponding source code for your steps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install dtale
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dtale</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)])</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">dtale</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="use-dark-mode-in-matplotlib">
<h4><span class="section-number">5.3.2. </span>Use Dark Mode in Matplotlib<a class="headerlink" href="#use-dark-mode-in-matplotlib" title="Permalink to this heading">#</a></h4>
<p>For all Dark Mode fans:</p>
<p>You can use Matplotlib in Dark Mode too.</p>
<p>Just set the background appropriately.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;dark_background&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="no-code-eda-with-pandasgui">
<h4><span class="section-number">5.3.3. </span>No-Code EDA with <code class="docutils literal notranslate"><span class="pre">PandasGUI</span></code><a class="headerlink" href="#no-code-eda-with-pandasgui" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">PandasGUI</span></code> provides a PyQT application to analyze and interactively plot your Pandas DataFrames.</p>
<p>Without writing a lot of code.</p>
<p>It offers various functionalities like:</p>
<ul class="simple">
<li><p>Filtering</p></li>
<li><p>Summary Statistics</p></li>
<li><p>Different Visualizations like Word Clouds, Bar Charts, etc.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandasgui</span> <span class="kn">import</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">pandasgui.datasets</span> <span class="kn">import</span> <span class="n">pokemon</span>
<span class="n">show</span><span class="p">(</span><span class="n">pokemon</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="analyze-missing-values-with-missingno">
<h4><span class="section-number">5.3.4. </span>Analyze Missing Values with <code class="docutils literal notranslate"><span class="pre">missingno</span></code><a class="headerlink" href="#analyze-missing-values-with-missingno" title="Permalink to this heading">#</a></h4>
<p>If you want to analyze missing values in your data</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">missingno</span></code>’s nullity correlation.</p>
<p>It lets us understand how the missing value of one column is related to missing values in other columns.</p>
<p>The heatmap works great for picking out data completeness relationships between variable pairs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install missingno
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">missingno</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;your_data.csv&quot;</span><span class="p">)</span>

<span class="n">missingno</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="powerful-correlation-with-phik">
<h4><span class="section-number">5.3.5. </span>Powerful Correlation with <code class="docutils literal notranslate"><span class="pre">phik</span></code><a class="headerlink" href="#powerful-correlation-with-phik" title="Permalink to this heading">#</a></h4>
<p>Do you look for a powerful correlation method?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">Phik</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">Phik</span></code> (or ϕk) works consistently beween categorical, ordinal and interval variables while capturing non-linear dependencies.</p>
<p>It reverts to Pearson’s correlation only for bivariate normal distribution of the input.</p>
<p>See below how you can use it in Python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install phik
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">phik</span>
<span class="kn">from</span> <span class="nn">phik.report</span> <span class="kn">import</span> <span class="n">plot_correlation_matrix</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span> <span class="n">phik</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="s1">&#39;fake_insurance_data.csv.gz&#39;</span><span class="p">)</span> <span class="p">)</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">phik_matrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot_correlation_matrix</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                        <span class="n">x_labels</span><span class="o">=</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> 
                        <span class="n">y_labels</span><span class="o">=</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                        <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
                        <span class="n">color_map</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Correlation Matrix&quot;</span><span class="p">,</span> 
                        <span class="n">fontsize_factor</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> 
                        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="display-x-axis-of-time-series-plots-correctly-with-autofmt-xdate">
<h4><span class="section-number">5.3.6. </span>Display X-Axis of Time Series Plots Correctly with <code class="docutils literal notranslate"><span class="pre">autofmt_xdate()</span></code><a class="headerlink" href="#display-x-axis-of-time-series-plots-correctly-with-autofmt-xdate" title="Permalink to this heading">#</a></h4>
<p>Plotting Time Series data in Matplotlib makes your x-axis ugly.</p>
<p>It results in overlapping and unreadable labels.</p>
<p>To solve this problem, use <code class="docutils literal notranslate"><span class="pre">fig.autofmt_xdate()</span></code>.</p>
<p>This will automatically format and adjust the x-axis labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">35</span><span class="p">])</span>

<span class="c1"># Create a figure and an axes object</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="beautiful-map-plots-with-plotly">
<h4><span class="section-number">5.3.7. </span>Beautiful Map Plots with <code class="docutils literal notranslate"><span class="pre">Plotly</span></code><a class="headerlink" href="#beautiful-map-plots-with-plotly" title="Permalink to this heading">#</a></h4>
<p>With <code class="docutils literal notranslate"><span class="pre">Plotly</span></code>, you can create beautiful geo maps with a few lines of code.</p>
<p><code class="docutils literal notranslate"><span class="pre">Plotly</span></code> supports map plots like:</p>
<ul class="simple">
<li><p>Filled areas on maps</p></li>
<li><p>Bubble Maps</p></li>
<li><p>Hexbin maps</p></li>
<li><p>Lines on maps</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">gapminder</span><span class="p">()</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;year == 2007&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_geo</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="s2">&quot;iso_alpha&quot;</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="s2">&quot;pop&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mosaic-plots-with-matplotlib">
<h4><span class="section-number">5.3.8. </span>Mosaic Plots with <code class="docutils literal notranslate"><span class="pre">Matplotlib</span></code><a class="headerlink" href="#mosaic-plots-with-matplotlib" title="Permalink to this heading">#</a></h4>
<p>You can create a mosaic of subplots in Matplotlib.</p>
<p><code class="docutils literal notranslate"><span class="pre">plt.subplot_mosaic()</span></code> allows you to arrange multiple subplots in a grid-like fashion, specifying their positions and sizes using a string.</p>
<p>A powerful function to control your subplots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Define the layout of subplots</span>
<span class="n">layout</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    AAE</span>
<span class="s1">    C.E</span>
<span class="s1">    &#39;&#39;&#39;</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axd</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplot_mosaic</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axd</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/machinelearning/featureselection"></span><section id="feature-selection">
<h3><span class="section-number">5.4. </span>Feature Selection<a class="headerlink" href="#feature-selection" title="Permalink to this heading">#</a></h3>
<section id="calculate-variance-inflation-factor-vif">
<h4><span class="section-number">5.4.1. </span>Calculate Variance Inflation Factor (VIF)<a class="headerlink" href="#calculate-variance-inflation-factor-vif" title="Permalink to this heading">#</a></h4>
<p>How to detect Multicollinearity?</p>
<p>Multicollinearity is a statistical phenomenon that occurs when two or more predictor variables in a multiple regression model are highly correlated.
This can lead to unstable and inconsistent coefficients, making it difficult to interpret the model’s results.</p>
<p>To measure multicollinearity, you can use the 𝐕𝐚𝐫𝐢𝐚𝐧𝐜𝐞 𝐈𝐧𝐟𝐥𝐚𝐭𝐢𝐨𝐧 𝐅𝐚𝐜𝐭𝐨𝐫 (VIF)</p>
<p>VIF is defined as the ratio of the variance of an estimated regression coefficient to the variance of the coefficient when the predictor variables are not correlated.</p>
<p>A high VIF value (VIF &gt; 5 or &gt; 10) indicates that multicollinearity is present and may be a problem.</p>
<p>To calculate the VIF for a predictor variable, you can fit a multiple regression model with all of the predictor variables except for that variable, and then calculate the VIF using the following formula:</p>
<p>VIF = 1 / (1 - R^2)</p>
<p>where R^2 is the coefficient of determination from the regression model.</p>
<p>You can repeat this process for each predictor variable and compare the VIF values to determine which predictor variables contribute to multicollinearity.</p>
<p>Now you could drop the predictor variables with high VIF and calculate the VIF for the remaining again to see, how their VIF has changed.</p>
<p>Below you can see how to calculate VIF with 𝐬𝐭𝐚𝐭𝐬𝐦𝐨𝐝𝐞𝐥𝐬.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_boston</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>

<span class="n">boston</span> <span class="o">=</span> <span class="n">load_boston</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">boston</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">boston</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>

<span class="n">vif</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;Predictor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vif</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">   Predictor        VIF</span>
<span class="sd">0       CRIM   2.100373</span>
<span class="sd">1         ZN   2.844013</span>
<span class="sd">2      INDUS  14.485758</span>
<span class="sd">3       CHAS   1.152952</span>
<span class="sd">4        NOX  73.894947</span>
<span class="sd">5         RM  77.948283</span>
<span class="sd">6        AGE  21.386850</span>
<span class="sd">7        DIS  14.699652</span>
<span class="sd">8        RAD  15.167725</span>
<span class="sd">9        TAX  61.227274</span>
<span class="sd">10   PTRATIO  85.029547</span>
<span class="sd">11         B  20.104943</span>
<span class="sd">12     LSTAT  11.102025</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-for-new-categories-in-test-set-with-deepchecks">
<h4><span class="section-number">5.4.2. </span>Check for new categories in test set with <code class="docutils literal notranslate"><span class="pre">Deepchecks</span></code><a class="headerlink" href="#check-for-new-categories-in-test-set-with-deepchecks" title="Permalink to this heading">#</a></h4>
<p>Always check if your test set has new categories when training a Machine Learning Model.</p>
<p>Some algorithms like CatBoost can handle unknown categories.</p>
<p>But when you have more and more unknown categories, it will harm your model.</p>
<p>Instead, check the mismatch beforehand with <code class="docutils literal notranslate"><span class="pre">Deepchecks’</span></code> <code class="docutils literal notranslate"><span class="pre">CategoryMismatchTrainTest</span></code>.</p>
<p>It will show you if there are new categories so you can handle them appropriate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">deepchecks.tabular.checks.train_test_validation</span> <span class="kn">import</span> <span class="n">CategoryMismatchTrainTest</span>
<span class="n">checker</span> <span class="o">=</span> <span class="n">CategoryMismatchTrainTest</span><span class="p">()</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Col1&quot;</span><span class="p">,</span> <span class="s2">&quot;Col2&quot;</span><span class="p">,</span> <span class="s2">&quot;Col3&quot;</span><span class="p">])</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Col1&quot;</span><span class="p">,</span> <span class="s2">&quot;Col2&quot;</span><span class="p">,</span> <span class="s2">&quot;Col3&quot;</span><span class="p">])</span>

<span class="n">checker</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-permutation-importance-with-eli5">
<h4><span class="section-number">5.4.3. </span>Get Permutation Importance with <code class="docutils literal notranslate"><span class="pre">eli5</span></code><a class="headerlink" href="#get-permutation-importance-with-eli5" title="Permalink to this heading">#</a></h4>
<p>Use Permutation Importance method to obtain feature importances.</p>
<p>Permutation Importance calculates feature importance by randomly shuffling the values of a feature and observing how the model’s performance changes.</p>
<p>In comparison to Feature Importance, Permutation Importance works for every model (and not only for tree-based models).</p>
<p>With <code class="docutils literal notranslate"><span class="pre">eli5</span></code>, you can calculate Permutation Importance with ease.</p>
<p><code class="docutils literal notranslate"><span class="pre">show_weights()</span></code> will show you the features which hurts the performance the most, so they are more important.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">eli5</span>
<span class="kn">from</span> <span class="nn">eli5.sklearn</span> <span class="kn">import</span> <span class="n">PermutationImportance</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">iris</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span> 
<span class="n">X</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">data</span> 
<span class="n">target</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span> 
<span class="n">names</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">target_names</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

<span class="n">svc</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">perm</span> <span class="o">=</span> <span class="n">PermutationImportance</span><span class="p">(</span><span class="n">svc</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="n">eli5</span><span class="o">.</span><span class="n">show_weights</span><span class="p">(</span><span class="n">perm</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Feature_1&quot;</span><span class="p">,</span> <span class="s2">&quot;Feature_2&quot;</span><span class="p">,</span> <span class="s2">&quot;Feature_3&quot;</span><span class="p">,</span> <span class="s2">&quot;Feature_4&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-the-most-predictive-variables-for-your-target-variable">
<h4><span class="section-number">5.4.4. </span>Find the Most Predictive Variables for Your Target Variable<a class="headerlink" href="#find-the-most-predictive-variables-for-your-target-variable" title="Permalink to this heading">#</a></h4>
<p>You know about Correlation. But do you know the Predictive Power Score?</p>
<p>Predictive Power Score (PPS) is a data-type-agnostic score that can detect linear and non-linear relationships between two columns, with an output ranging from 0 to 1.</p>
<p>So, a PPS of 1 means Column A is very likely to predict the values of Column B.</p>
<p>You can use it to identify which variables are most useful to predict the target variable.</p>
<p>In Python, you can use the <code class="docutils literal notranslate"><span class="pre">ppscore</span></code> library.</p>
<p>It can calculate the PPS of all the features in a dataframe against a target.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install ppscore
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ppscore</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>

<span class="n">iris</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">iris</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">iris</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]],</span>
                     <span class="n">columns</span><span class="o">=</span> <span class="n">iris</span><span class="p">[</span><span class="s1">&#39;feature_names&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ppscore</span><span class="o">.</span><span class="n">predictors</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="feature-selection-at-scale-with-mrmr">
<h4><span class="section-number">5.4.5. </span>Feature Selection at Scale with <code class="docutils literal notranslate"><span class="pre">mrmr</span></code><a class="headerlink" href="#feature-selection-at-scale-with-mrmr" title="Permalink to this heading">#</a></h4>
<p>Do you want to do Feature Selection automatically?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">mrmr</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">mrmr</span></code> (minimum-Redundancy-Maximum-Relevance) is a minimal-optimal feature selection algorithm at scale.</p>
<p>It means <code class="docutils literal notranslate"><span class="pre">mrmr</span></code> will find the smallest relevant subset of features your ML Model needs.</p>
<p><code class="docutils literal notranslate"><span class="pre">mrmr</span></code> supports common tools like Pandas, Polars and Spark.</p>
<p>See below how we want to select the best K features.</p>
<p>The output is a ranked list of the relevant features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install mrmr_selection
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">from</span> <span class="nn">mrmr</span> <span class="kn">import</span> <span class="n">mrmr_classif</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span><span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">n_features</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">n_informative</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n_redundant</span> <span class="o">=</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">selected_features</span> <span class="o">=</span> <span class="n">mrmr_classif</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/machinelearning/getdata"></span><section id="get-data">
<h3><span class="section-number">5.5. </span>Get Data<a class="headerlink" href="#get-data" title="Permalink to this heading">#</a></h3>
<section id="scrape-data-from-twitter-youtube-and-more-with-snscrape">
<h4><span class="section-number">5.5.1. </span>Scrape Data from Twitter, Youtube and more with <code class="docutils literal notranslate"><span class="pre">snscrape</span></code><a class="headerlink" href="#scrape-data-from-twitter-youtube-and-more-with-snscrape" title="Permalink to this heading">#</a></h4>
<p>Do you want to scrape Twitter data? Without restrictions?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">snscrape</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">snscrape</span></code> is a Python library for social networking services to scrape information like users, hashtags, threads, likes, etc. easily.</p>
<p>It can also be used for other social network platforms like Instagram or Facebook.</p>
<p><code class="docutils literal notranslate"><span class="pre">snscrape</span></code> comes with a CLI functionality and with a Python wrapper.</p>
<p>In the example below, to get 500 tweets from Elon Musk between January 1, 2022 and December 11, 2022, we can simply use the CLI command below. We want to return the data in a JSON format and save it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install snscrape
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!snscrape --jsonl --max-results 500 --since 2022-01-01 twitter-search &quot;from:elonmusk until:2022-12-11&quot; &gt; elon-tweets.json
</pre></div>
</div>
</div>
</div>
</section>
<section id="scrape-google-play-reviews">
<h4><span class="section-number">5.5.2. </span>Scrape Google Play Reviews<a class="headerlink" href="#scrape-google-play-reviews" title="Permalink to this heading">#</a></h4>
<p>Do you want to scrape Google Play Reviews?</p>
<p>Without effort?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">google-play-scraper</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">google-play-scraper</span></code> provides APIs to easily retrieve reviews for apps from the Google Play Store for Python.</p>
<p>Below you can see how easy it is to get reviews for the LinkedIn App by providing its ID (you can get the ID from the URL of the corresponding Playstore page)</p>
<ul class="simple">
<li><p>You can sort the reviews by their date or relevance</p></li>
<li><p>You can filter by rating, country and language</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install google-play-scraper
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google_play_scraper</span> <span class="kn">import</span> <span class="n">Sort</span><span class="p">,</span> <span class="n">reviews</span>

<span class="n">result</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">reviews</span><span class="p">(</span>
    <span class="s1">&#39;com.linkedin.android&#39;</span><span class="p">,</span>
    <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="n">country</span><span class="o">=</span><span class="s1">&#39;us&#39;</span><span class="p">,</span>
    <span class="n">sort</span><span class="o">=</span><span class="n">Sort</span><span class="o">.</span><span class="n">NEWEST</span><span class="p">,</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">filter_score_with</span><span class="o">=</span><span class="mi">5</span> 
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="scrape-reviews-from-app-store">
<h4><span class="section-number">5.5.3. </span>Scrape Reviews from App Store<a class="headerlink" href="#scrape-reviews-from-app-store" title="Permalink to this heading">#</a></h4>
<p>Do you want to scrape App Store Reviews?</p>
<p>Without effort?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">app_store_scraper</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">app_store_scraper</span></code> provides APIs to easily retrieve reviews for apps and podcasts from the Apple App Store for Python.</p>
<p>Below you can see how easy it is to get reviews for the Instagram App by providing its ID and app name (you can get the ID and app name from the URL of the corresponding App Store page)</p>
<p>A nice library for your next side project!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install app_store_scraper
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">app_store_scraper</span> <span class="kn">import</span> <span class="n">AppStore</span>
<span class="c1"># app_name and app_id is derived from url</span>
<span class="c1"># https://apps.apple.com/de/app/instagram/id389801252</span>
<span class="n">insta</span> <span class="o">=</span> <span class="n">AppStore</span><span class="p">(</span><span class="n">country</span><span class="o">=</span><span class="s1">&#39;us&#39;</span><span class="p">,</span> <span class="n">app_name</span><span class="o">=</span><span class="s1">&#39;instagram&#39;</span><span class="p">,</span> <span class="n">app_id</span> <span class="o">=</span> <span class="s1">&#39;389801252&#39;</span><span class="p">)</span>

<span class="n">insta</span><span class="o">.</span><span class="n">review</span><span class="p">(</span><span class="n">how_many</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">insta</span><span class="o">.</span><span class="n">reviews</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-csv-files-without-a-problem-with-clevercsv">
<h4><span class="section-number">5.5.4. </span>Read CSV files without a problem with <code class="docutils literal notranslate"><span class="pre">clevercsv</span></code><a class="headerlink" href="#read-csv-files-without-a-problem-with-clevercsv" title="Permalink to this heading">#</a></h4>
<p>Do you want to read CSV files without problems?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">clevercsv</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">clevercsv</span></code> handles messy CSV files for you.</p>
<p>The problem with CSV files is that CSV isn’t a standard file format.</p>
<p>Thus, every CSV you face could be different.</p>
<p>Pandas and the standard CSV module of Python throw errors if the CSV is too messy.</p>
<p><code class="docutils literal notranslate"><span class="pre">clevercsv</span></code> detects the “real” dialect of the CSV and knows what to do.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install clevercsv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">clevercsv</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">clevercsv</span><span class="o">.</span><span class="n">read_dataframe</span><span class="p">(</span><span class="s1">&#39;imdb.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="powerful-web-text-gathering-with-trafilatura">
<h4><span class="section-number">5.5.5. </span>Powerful Web Text Gathering with <code class="docutils literal notranslate"><span class="pre">trafilatura</span></code><a class="headerlink" href="#powerful-web-text-gathering-with-trafilatura" title="Permalink to this heading">#</a></h4>
<p>Do you need a powerful text extractor on the web?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">trafilatura</span></code>!</p>
<p>It’s a Python package for Web Crawling, Downloads and Scraping of text, metadata and comments from websites.</p>
<p>Trafilatura supports different output formats like JSON, XML and CSV.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install trafilatura
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">trafilatura</span> <span class="kn">import</span> <span class="n">fetch_url</span><span class="p">,</span> <span class="n">extract</span>

<span class="n">downloaded</span> <span class="o">=</span> <span class="n">fetch_url</span><span class="p">(</span><span class="s1">&#39;https://github.com/adbar/trafilatura&#39;</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">extract</span><span class="p">(</span><span class="n">downloaded</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s2">&quot;xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/machinelearning/modeltraining"></span><section id="model-training">
<h3><span class="section-number">5.6. </span>Model Training<a class="headerlink" href="#model-training" title="Permalink to this heading">#</a></h3>
<section id="compute-class-weights">
<h4><span class="section-number">5.6.1. </span>Compute Class Weights<a class="headerlink" href="#compute-class-weights" title="Permalink to this heading">#</a></h4>
<p>To handle class imbalance in Machine Learning, there are several methods.
<br><br>
One of them is adjusting the class weights.
<br><br>
By giving higher weights to the minority class and lower weights to the majority class, we can regularize the loss function.
<br><br>
Misclassifying the minority class will result in a higher loss due to the higher weight.
<br><br>
To incorporate class weights in Tensorflow, use <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">compute_class_weight</span></code> function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">compute_class_weight</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># will return an array with weights for each class, e.g. [0.6, 0.6, 1.]</span>
<span class="n">class_weights</span> <span class="o">=</span> <span class="n">compute_class_weight</span><span class="p">(</span>
  <span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">,</span>
  <span class="n">classes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
  <span class="n">y</span><span class="o">=</span><span class="n">y</span>
<span class="p">)</span>

<span class="c1"># to get a dictionary with {&lt;class&gt;:&lt;weight&gt;}</span>
<span class="n">class_weights</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">class_weights</span><span class="p">))</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># using class_weights in the .fit() method</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weights</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="reset-tensorflow-keras-global-state">
<h4><span class="section-number">5.6.2. </span>Reset TensorFlow/Keras Global State<a class="headerlink" href="#reset-tensorflow-keras-global-state" title="Permalink to this heading">#</a></h4>
<p>In Tensorflow/Keras, when you create multiple models in a loop, you will need <code class="docutils literal notranslate"><span class="pre">tf.keras.backend.clear_session()</span></code>.</p>
<p>Keras manages a global state, which includes configurations and the current values (weights and biases) of the models.</p>
<p>So when you create a model in a loop, the global state gets bigger and bigger with every created model. To clear the state, 𝐝𝐞𝐥 𝐦𝐨𝐝𝐞𝐥 will not work because it will only delete the Python variable.</p>
<p>So <code class="docutils literal notranslate"><span class="pre">tf.keras.backend.clear_session()</span></code> is a better option. It will reset the state of a model and helps avoid clutter from old models.</p>
<p>See the first example below. Each iteration of this loop will increase the size of the global state and of your memory.</p>
<p>In the second example, the memory consumption stays constant by clearing the state with every iteration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">def</span> <span class="nf">create_model</span><span class="p">():</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">model</span>

<span class="c1"># without clearing session</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">()</span>
  
<span class="c1"># with clearing session</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">clear_session</span><span class="p">()</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">create_model</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-dirty-labels-with-cleanlab">
<h4><span class="section-number">5.6.3. </span>Find dirty labels with <code class="docutils literal notranslate"><span class="pre">cleanlab</span></code><a class="headerlink" href="#find-dirty-labels-with-cleanlab" title="Permalink to this heading">#</a></h4>
<p>Do you want to identify noisy labels in your dataset?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">cleanlab</span></code> for Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">cleanlab</span></code> is a data-centric AI package to automatically detect noisy labels and address dataset issues to fix them via confident learning algorithms.</p>
<p>It works with nearly every model possible:</p>
<ul class="simple">
<li><p>XGBoost</p></li>
<li><p>scikit-learn models</p></li>
<li><p>Tensorflow</p></li>
<li><p>PyTorch</p></li>
<li><p>HuggingFace</p></li>
<li><p>etc.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>cleanlab
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cleanlab</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>

<span class="n">iris</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">data</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">cl</span> <span class="o">=</span> <span class="n">cleanlab</span><span class="o">.</span><span class="n">classification</span><span class="o">.</span><span class="n">CleanLearning</span><span class="p">(</span><span class="n">clf</span><span class="p">)</span>

<span class="n">label_issues</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">find_label_issues</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">label_issues</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;is_label_issue == True&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluate-your-classifier-with-sklearn-s-classification-report">
<h4><span class="section-number">5.6.4. </span>Evaluate your Classifier with sklearn’s <code class="docutils literal notranslate"><span class="pre">classification_report</span></code><a class="headerlink" href="#evaluate-your-classifier-with-sklearn-s-classification-report" title="Permalink to this heading">#</a></h4>
<p>Would you like to evaluate your Machine Learning model quickly?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">classification_report</span></code> from scikit-learn</p>
<p>With <code class="docutils literal notranslate"><span class="pre">classification_report</span></code>, you can quickly assess the performance of your model.</p>
<p>It summarizes Precision, Recall, F1-Score, and Support for each class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a small script where sklearns classification_report is used</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>

<span class="n">y_true</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">target_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;class 0&#39;</span><span class="p">,</span> <span class="s1">&#39;class 1&#39;</span><span class="p">,</span> <span class="s1">&#39;class 2&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">target_names</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">             precision    recall  f1-score   support</span>

<span class="sd">     class 0       0.50      1.00      0.67         1</span>
<span class="sd">     class 1       0.00      0.00      0.00         1</span>
<span class="sd">     class 2       1.00      0.67      0.80         3</span>

<span class="sd">    accuracy                           0.60         5</span>
<span class="sd">   macro avg       0.50      0.56      0.49         5</span>
<span class="sd">weighted avg       0.70      0.60      0.61         5</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="obtain-reproducible-optimizations-results-in-optuna">
<h4><span class="section-number">5.6.5. </span>Obtain Reproducible Optimizations Results in Optuna<a class="headerlink" href="#obtain-reproducible-optimizations-results-in-optuna" title="Permalink to this heading">#</a></h4>
<p>Optuna is a powerful hyperparameter optimization framework that supports many machine learning frameworks, including TensorFlow, PyTorch, and XGBoost.</p>
<p>But you need to be careful with reproducible results for hyperparameter tuning.tuple</p>
<p>To achieve reproducible results, you need to set the seed for your Sampler.</p>
<p>Below you can see how it is done for <code class="docutils literal notranslate"><span class="pre">TPESampler</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">optuna</span>
<span class="kn">from</span> <span class="nn">optuna.samplers</span> <span class="kn">import</span> <span class="n">TPESampler</span>

<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="o">...</span>
    
<span class="n">sampler</span> <span class="o">=</span> <span class="n">TPESampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">)</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-bad-labels-with-doubtlab">
<h4><span class="section-number">5.6.6. </span>Find bad labels with <code class="docutils literal notranslate"><span class="pre">doubtlab</span></code><a class="headerlink" href="#find-bad-labels-with-doubtlab" title="Permalink to this heading">#</a></h4>
<p>Do you want to find bad labels in your data?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">doubtlab</span></code> for Python.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">doubtlab</span></code>, you can define reasons to doubt your labels and take a closer look.</p>
<p>Reasons to doubt your labels can be for example:</p>
<ul class="simple">
<li><p>𝐏𝐫𝐨𝐛𝐚𝐑𝐞𝐚𝐬𝐨𝐧: When the confidence values are low for any label</p></li>
<li><p>𝐖𝐫𝐨𝐧𝐠𝐏𝐫𝐞𝐝𝐢𝐜𝐭𝐢𝐨𝐧𝐑𝐞𝐚𝐬𝐨𝐧: When a model cannot predict the listed label</p></li>
<li><p>𝐃𝐢𝐬𝐚𝐠𝐫𝐞𝐞𝐑𝐞𝐚𝐬𝐨𝐧: When two models disagree on a prediction.</p></li>
<li><p>𝐑𝐞𝐥𝐚𝐭𝐢𝐯𝐞𝐃𝐢𝐟𝐟𝐞𝐫𝐞𝐧𝐜𝐞𝐑𝐞𝐚𝐬𝐨𝐧: When the relative difference between label and prediction is too high</p></li>
</ul>
<p>So, identify your noisy labels and fix them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>doubtlab
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">doubtlab.ensemble</span> <span class="kn">import</span> <span class="n">DoubtEnsemble</span>
<span class="kn">from</span> <span class="nn">doubtlab.reason</span> <span class="kn">import</span> <span class="n">ProbaReason</span><span class="p">,</span> <span class="n">WrongPredictionReason</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Define reasons to check</span>
<span class="n">reasons</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;proba&#39;</span><span class="p">:</span> <span class="n">ProbaReason</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">),</span>
    <span class="s1">&#39;wrong_pred&#39;</span><span class="p">:</span> <span class="n">WrongPredictionReason</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Pass reasons to DoubtLab instance</span>
<span class="n">doubt</span> <span class="o">=</span> <span class="n">DoubtEnsemble</span><span class="p">(</span><span class="o">**</span><span class="n">reasons</span><span class="p">)</span>

<span class="c1"># Returns DataFrame with reasoning</span>
<span class="n">predicates</span> <span class="o">=</span> <span class="n">doubt</span><span class="o">.</span><span class="n">get_predicates</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-notified-when-your-model-is-finished-with-training">
<h4><span class="section-number">5.6.7. </span>Get notified when your model is finished with training<a class="headerlink" href="#get-notified-when-your-model-is-finished-with-training" title="Permalink to this heading">#</a></h4>
<p>Never stare at your screen, waiting for your model to finish training.</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">knockknock</span></code> for Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">knockknock</span></code> is a library that notifies you when your training is finished.</p>
<p>You only need to add a decorator.</p>
<p>Currently, you can get a notification through 12 different channels
like:</p>
<ul class="simple">
<li><p>Email</p></li>
<li><p>Slack</p></li>
<li><p>Telegram</p></li>
<li><p>Discord</p></li>
<li><p>MS Teams</p></li>
</ul>
<p>Use it for your future model training and don’t stick to your screen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>knockknock
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">knockknock</span> <span class="kn">import</span> <span class="n">email_sender</span>

<span class="nd">@email_sender</span><span class="p">(</span><span class="n">recipient_emails</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;coolmail@python.com&quot;</span><span class="p">,</span> <span class="s2">&quot;2coolmail@python.com&quot;</span><span class="p">],</span> <span class="n">sender_email</span><span class="o">=</span><span class="s2">&quot;anothercoolmail@python.com&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-model-summary-in-pytorch-with-torchinfo">
<h4><span class="section-number">5.6.8. </span>Get Model Summary in PyTorch with <code class="docutils literal notranslate"><span class="pre">torchinfo</span></code><a class="headerlink" href="#get-model-summary-in-pytorch-with-torchinfo" title="Permalink to this heading">#</a></h4>
<p>Do you want a Model summary in PyTorch?</p>
<p>Like in Keras with <code class="docutils literal notranslate"><span class="pre">model.summary()</span></code>?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">torchinfo</span></code>.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">torchinfo</span></code>, you can get a model summary as you know it from
Keras.</p>
<p>Just add one line of code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>torchinfo
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torchinfo</span> <span class="kn">import</span> <span class="n">summary</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span>
  <span class="o">...</span>
  
<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>

<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">summary</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">input_size</span><span class="o">=</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">==========================================================================================</span>
<span class="sd">Layer (type:depth-idx)                   Output Shape              Param #</span>
<span class="sd">==========================================================================================</span>
<span class="sd">Net                                      [16, 10]                  --</span>
<span class="sd">├─Sequential: 1-1                        [16, 4, 7, 7]             --</span>
<span class="sd">│    └─Conv2d: 2-1                       [16, 4, 28, 28]           40</span>
<span class="sd">│    └─BatchNorm2d: 2-2                  [16, 4, 28, 28]           8</span>
<span class="sd">│    └─ReLU: 2-3                         [16, 4, 28, 28]           --</span>
<span class="sd">│    └─MaxPool2d: 2-4                    [16, 4, 14, 14]           --</span>
<span class="sd">│    └─Conv2d: 2-5                       [16, 4, 14, 14]           148</span>
<span class="sd">│    └─BatchNorm2d: 2-6                  [16, 4, 14, 14]           8</span>
<span class="sd">│    └─ReLU: 2-7                         [16, 4, 14, 14]           --</span>
<span class="sd">│    └─MaxPool2d: 2-8                    [16, 4, 7, 7]             --</span>
<span class="sd">├─Sequential: 1-2                        [16, 10]                  --</span>
<span class="sd">│    └─Linear: 2-9                       [16, 10]                  1,970</span>
<span class="sd">==========================================================================================</span>
<span class="sd">Total params: 2,174</span>
<span class="sd">Trainable params: 2,174</span>
<span class="sd">Non-trainable params: 0</span>
<span class="sd">Total mult-adds (M): 1.00</span>
<span class="sd">==========================================================================================</span>
<span class="sd">Input size (MB): 0.05</span>
<span class="sd">Forward/backward pass size (MB): 1.00</span>
<span class="sd">Params size (MB): 0.01</span>
<span class="sd">Estimated Total Size (MB): 1.06</span>
<span class="sd">==========================================================================================</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="boost-scikit-learns-performance-with-intel-extension">
<h4><span class="section-number">5.6.9. </span>Boost scikit-learns performance with Intel Extension<a class="headerlink" href="#boost-scikit-learns-performance-with-intel-extension" title="Permalink to this heading">#</a></h4>
<p>Scikit-learn is one of the most popular ML packages for Python.</p>
<p>But, to be honest, their algorithms are not the fastest ones.</p>
<p>With Intel’s Extension for scikit-learn, <code class="docutils literal notranslate"><span class="pre">scikit-learn-intelex</span></code>. you can speed up training time for some favourite algorithms like:</p>
<ul class="simple">
<li><p>Support Vector Classifier/Regressor</p></li>
<li><p>Random Forest Classifier/Regressor</p></li>
<li><p>LASSO</p></li>
<li><p>DBSCAN</p></li>
</ul>
<p>Just add two lines of code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>scikit-learn-intelex
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearnex</span> <span class="kn">import</span> <span class="n">patch_sklearn</span>
<span class="n">patch_sklearn</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_regression</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_regression</span><span class="p">(</span>
<span class="n">n_samples</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> 
<span class="n">n_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
<span class="n">noise</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">svr</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">()</span>

<span class="n">svr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="incorportate-domain-knowledge-into-xgboost-with-feature-interaction-constraints">
<h4><span class="section-number">5.6.10. </span>Incorportate Domain Knowledge into XGBoost with Feature Interaction Constraints<a class="headerlink" href="#incorportate-domain-knowledge-into-xgboost-with-feature-interaction-constraints" title="Permalink to this heading">#</a></h4>
<p>Want to incorporate your domain knowledge into <code class="docutils literal notranslate"><span class="pre">𝐗𝐆𝐁𝐨𝐨𝐬𝐭</span></code>?</p>
<p>Try using 𝐅𝐞𝐚𝐭𝐮𝐫𝐞 𝐈𝐧𝐭𝐞𝐫𝐚𝐜𝐭𝐢𝐨𝐧 𝐂𝐨𝐧𝐬𝐭𝐫𝐚𝐢𝐧𝐭𝐬.</p>
<p>Feature Interaction Constraints allow you to control which features are allowed to interact with each other and which are not while building the trees.</p>
<p>For example, the constraint [0, 1] means that Feature_0 and Feature_1 are allowed to interact with each other but with no other variable. Similarly, [3, 5, 9] means that Feature_3, Feature_5, and Feature_9 are allowed to interact with each other but with no other variable.</p>
<p>With this in mind, you can define feature interaction constraints:</p>
<ul class="simple">
<li><p>Based on domain knowledge, when you know that some features interactions will lead to better results</p></li>
<li><p>Based on regulatory constraints in your industry/company where some features can not interact with each other.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">dmatrix</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;objective&quot;</span><span class="p">:</span> <span class="s2">&quot;reg:squarederror&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eval_metric&quot;</span><span class="p">:</span> <span class="s2">&quot;rmse&quot;</span><span class="p">,</span>
    <span class="s2">&quot;interaction_constraints&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span> <span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="p">}</span>

<span class="n">model_with_constraints</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">dmatrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="powerful-automl-with-flaml">
<h4><span class="section-number">5.6.11. </span>Powerful AutoML with <code class="docutils literal notranslate"><span class="pre">FLAML</span></code><a class="headerlink" href="#powerful-automl-with-flaml" title="Permalink to this heading">#</a></h4>
<p>Do you always hear about AutoML?</p>
<p>And want to try it out?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">FLAML</span></code> for Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">FLAML</span></code> (Fast and Lightweight AutoML) is an AutoML package developed by Microsoft.</p>
<p>It can do Model Selection, Hyperparameter tuning, and Feature Engineering automatically.</p>
<p>Thus, it removes the pain of choosing the best model and parameters so that you can focus more on your data.</p>
<p>Per default, its estimator list contains only tree-based models like XGBoost, CatBoost, and LightGBM. But you can also add custom models.</p>
<p>A powerful library!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>flaml
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flaml</span> <span class="kn">import</span> <span class="n">AutoML</span>
<span class="n">automl</span> <span class="o">=</span> <span class="n">AutoML</span><span class="p">()</span>
<span class="n">automl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="aspect-based-seniment-analysis-with-pyabsa">
<h4><span class="section-number">5.6.12. </span>Aspect-based Seniment Analysis with <code class="docutils literal notranslate"><span class="pre">PyABSA</span></code><a class="headerlink" href="#aspect-based-seniment-analysis-with-pyabsa" title="Permalink to this heading">#</a></h4>
<p>Traditional sentiment analysis focuses on determining the overall sentiment of a piece of text.</p>
<p>For example, the sentence :</p>
<p>“The food was bad and the staff was rude”</p>
<p>would output only a negative sentiment.</p>
<p>But, what if I want to extract, which aspects have a negative or positive sentiment?</p>
<p>That’s the responsibility of aspect-based sentiment analysis.</p>
<p>It aims to identify and extract the sentiment expressed towards specific aspects of a text.</p>
<p>For the sentence:</p>
<p>”The battery life is excellent but the camera quality is bad.”</p>
<p>a model’s output would be:</p>
<ul class="simple">
<li><p>Battery life: positive</p></li>
<li><p>Camera quality: negative</p></li>
</ul>
<p>With aspect-based sentiment analysis, you can understand the opinions and feelings expressed about specific aspects.</p>
<p>To do that in Python, use the package <code class="docutils literal notranslate"><span class="pre">PyABSA</span></code>.</p>
<p>It contains pre-trained models with an easy-to-use API for aspect-term extraction and sentiment classification.</p>
<p><code class="docutils literal notranslate"><span class="pre">PyABSA</span></code> can be used for a variety of applications, such as:</p>
<ul class="simple">
<li><p>Customer feedback analysis</p></li>
<li><p>Product reviews analysis</p></li>
<li><p>Social media monitoring</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">pyabsa</span><span class="o">==</span><span class="m">1</span>.16.27
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyabsa</span> <span class="kn">import</span> <span class="n">ATEPCCheckpointManager</span>

<span class="n">extractor</span> <span class="o">=</span> <span class="n">ATEPCCheckpointManager</span><span class="o">.</span><span class="n">get_aspect_extractor</span><span class="p">(</span>
                  <span class="n">checkpoint</span><span class="o">=</span><span class="s2">&quot;multilingual&quot;</span><span class="p">,</span>
                  <span class="n">auto_device</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
                                                        
<span class="n">example</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Location and food were excellent but stuff was very unfriendly.&quot;</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">extract_aspect</span><span class="p">(</span><span class="n">inference_source</span><span class="o">=</span><span class="n">example</span><span class="p">,</span> <span class="n">pred_sentiment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="use-xgboost-for-random-forests">
<h4><span class="section-number">5.6.13. </span>Use XGBoost for Random Forests<a class="headerlink" href="#use-xgboost-for-random-forests" title="Permalink to this heading">#</a></h4>
<p>Are you still using Random Forests from sklearn?</p>
<p>XGBoost implements Random Forests too, and much faster than sklearn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRFRegressor</span>

<span class="n">xgbrf</span> <span class="o">=</span> <span class="n">XGBRFRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>

<span class="n">xgbrf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="identify-problematic-images-with-cleanvision">
<h4><span class="section-number">5.6.14. </span>Identify problematic images with <code class="docutils literal notranslate"><span class="pre">cleanvision</span></code><a class="headerlink" href="#identify-problematic-images-with-cleanvision" title="Permalink to this heading">#</a></h4>
<p>Your Deep Learning Model doesn’t perform?</p>
<p>It’s probably because of your data.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">cleanvision</span></code>, you can detect issues in image data.</p>
<p><code class="docutils literal notranslate"><span class="pre">cleanvision</span></code> is a relatively new data-centric AI package to find problems in your image dataset.</p>
<p>It can detect issues like:</p>
<ul class="simple">
<li><p>Exact or Near Duplicates</p></li>
<li><p>Blurry Images</p></li>
<li><p>Odd Aspect Ratios</p></li>
<li><p>Irregularly Dark/Light images</p></li>
<li><p>Images lacking content</p></li>
</ul>
<p>A good first step to try before applying crazy Vision Transformers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>wget<span class="w"> </span>-<span class="w"> </span>nc<span class="w"> </span><span class="s1">&#39;https://cleanlab-public.s3.amazonaws.com/CleanVision/image_files.zip&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>unzip<span class="w"> </span>-q<span class="w"> </span>image_files.zip
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>cleanvision
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cleanvision.imagelab</span> <span class="kn">import</span> <span class="n">Imagelab</span>

<span class="c1"># Path to your dataset, you can specify your own dataset path</span>
<span class="n">dataset_path</span> <span class="o">=</span> <span class="s2">&quot;./image_files/&quot;</span>

<span class="c1"># Initialize imagelab with your dataset</span>
<span class="n">imagelab</span> <span class="o">=</span> <span class="n">Imagelab</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="n">dataset_path</span><span class="p">)</span>

<span class="c1"># Find issues</span>
<span class="n">imagelab</span><span class="o">.</span><span class="n">find_issues</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get summary of issues with prevalence per issue</span>
<span class="n">imagelab</span><span class="o">.</span><span class="n">issue_summary</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize Top examples for blurry images</span>
<span class="n">imagelab</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">issue_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;blurry&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="select-the-optimal-regularization-parameter">
<h4><span class="section-number">5.6.15. </span>Select the optimal Regularization Parameter<a class="headerlink" href="#select-the-optimal-regularization-parameter" title="Permalink to this heading">#</a></h4>
<p>How do you choose your Regularization Parameter?</p>
<p>Your model’s complexity decreases with a higher Regularization Parameter (Alpha).</p>
<p>It shouldn’t be too high or too low.</p>
<p>Yellowbrick’s <code class="docutils literal notranslate"><span class="pre">𝐀𝐥𝐩𝐡𝐚𝐒𝐞𝐥𝐞𝐜𝐭𝐢𝐨𝐧</span></code> can help you to find the best Alpha.</p>
<p>It takes your model and visualizes the Alpha/Error curve so you can see how the model’s error responds to different alpha values.</p>
<p>Below you can see how to do it with scikit-learn’s LassoCV.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span>
<span class="kn">from</span> <span class="nn">yellowbrick.datasets</span> <span class="kn">import</span> <span class="n">load_concrete</span>
<span class="kn">from</span> <span class="nn">yellowbrick.regressor</span> <span class="kn">import</span> <span class="n">AlphaSelection</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_concrete</span><span class="p">()</span>

<span class="c1"># Create a list of alphas to cross-validate against</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">)</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">AlphaSelection</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="decision-forests-in-tensorflow">
<h4><span class="section-number">5.6.16. </span>Decision Forests in TensorFlow<a class="headerlink" href="#decision-forests-in-tensorflow" title="Permalink to this heading">#</a></h4>
<p>Did you know there are Decision Forests from TensorFlow?</p>
<p><code class="docutils literal notranslate"><span class="pre">tensorflow_decision_forests</span></code> implements decision forest models like Random Forest or GBDT for classification, regression, and ranking.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>tensorflow_decision_forests
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tensorflow_decision_forests</span> <span class="k">as</span> <span class="nn">tfdf</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_path</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span>
      <span class="s2">&quot;adult.csv&quot;</span><span class="p">,</span>
      <span class="s2">&quot;https://raw.githubusercontent.com/google/yggdrasil-decision-forests/&quot;</span>
      <span class="s2">&quot;main/yggdrasil_decision_forests/test_data/dataset/adult.csv&quot;</span><span class="p">)</span>

<span class="n">dataset_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">)</span>
<span class="n">test_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_df</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">0.30</span>
<span class="n">test_ds_pd</span> <span class="o">=</span> <span class="n">dataset_df</span><span class="p">[</span><span class="n">test_indices</span><span class="p">]</span>
<span class="n">train_ds_pd</span> <span class="o">=</span> <span class="n">dataset_df</span><span class="p">[</span><span class="o">~</span><span class="n">test_indices</span><span class="p">]</span>


<span class="n">train_ds</span> <span class="o">=</span> <span class="n">tfdf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">pd_dataframe_to_tf_dataset</span><span class="p">(</span><span class="n">train_ds_pd</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;income&quot;</span><span class="p">)</span>
<span class="n">test_ds</span> <span class="o">=</span> <span class="n">tfdf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">pd_dataframe_to_tf_dataset</span><span class="p">(</span><span class="n">test_ds_pd</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;income&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">tfdf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">GradientBoostedTreesModel</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_ds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="automl-with-autogluon">
<h4><span class="section-number">5.6.17. </span>AutoML with <code class="docutils literal notranslate"><span class="pre">AutoGluon</span></code><a class="headerlink" href="#automl-with-autogluon" title="Permalink to this heading">#</a></h4>
<p>Do you always hear about AutoML?</p>
<p>And want to try it out?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">AutoGluon</span></code> for Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">AutoGluon</span></code> is a Python package from AWS.</p>
<p>It lets you perform AutoML on:</p>
<ul class="simple">
<li><p>Tabular Data (Classification, Regression)</p></li>
<li><p>Time Series Data</p></li>
<li><p>Multimodal Data (Images + Text + Tabular)</p></li>
</ul>
<p>Thus, it removes the pain of choosing the best model and best parameter.</p>
<p>AutoGluon also offers utilities for EDA, like:</p>
<ul class="simple">
<li><p>Detecting Covariate Shift</p></li>
<li><p>Target Variable Analysis</p></li>
<li><p>Feature Interaction Charts</p></li>
</ul>
<p>See below for a quickstart for tabular data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>autogluon
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">autogluon.tabular</span> <span class="kn">import</span> <span class="n">TabularDataset</span><span class="p">,</span> <span class="n">TabularPredictor</span>

<span class="n">train_data</span> <span class="o">=</span> <span class="n">TabularDataset</span><span class="p">(</span><span class="s1">&#39;https://autogluon.s3.amazonaws.com/datasets/Inc/train.csv&#39;</span><span class="p">)</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">TabularDataset</span><span class="p">(</span><span class="s1">&#39;https://autogluon.s3.amazonaws.com/datasets/Inc/test.csv&#39;</span><span class="p">)</span>

<span class="n">predictor</span> <span class="o">=</span> <span class="n">TabularPredictor</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;class&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">time_limit</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>
<span class="n">predictor</span><span class="o">.</span><span class="n">leaderboard</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-keras-models-with-visualkeras">
<h4><span class="section-number">5.6.18. </span>Visualize Keras Models with <code class="docutils literal notranslate"><span class="pre">visualkeras</span></code><a class="headerlink" href="#visualize-keras-models-with-visualkeras" title="Permalink to this heading">#</a></h4>
<p>Do you want some cool visualization for your Deep Learning Models?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">visualkeras</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">visualkeras</span></code> visualizes your Keras models (as an alternative to model.summary())</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>visualkeras
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">visualkeras</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">MaxPooling2D</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Dense</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Flatten</span><span class="p">())</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">))</span>

<span class="n">visualkeras</span><span class="o">.</span><span class="n">layered_view</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="s1">&#39;output.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="perform-multilabel-stratified-kfold-with-iterative-stratification">
<h4><span class="section-number">5.6.19. </span>Perform Multilabel Stratified KFold with <code class="docutils literal notranslate"><span class="pre">iterative-stratification</span></code><a class="headerlink" href="#perform-multilabel-stratified-kfold-with-iterative-stratification" title="Permalink to this heading">#</a></h4>
<p>When doing Cross-Validation for classification,</p>
<p>StratifiedKFold from scikit-learn is a common choice.</p>
<p>Stratification aims to guarantee that every fold represents all strata of the data.</p>
<p>But, scikit-learn doesn’t support stratifying multilabel data.</p>
<p>For this use case, try the <code class="docutils literal notranslate"><span class="pre">iterative-stratification</span></code> package.</p>
<p>It offers implementations for stratyfing multilabel data in different ways.</p>
<p>See below how we can use MultilabelStratifiedKFold.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>iterative-stratification
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">iterstrat.ml_stratifiers</span> <span class="kn">import</span> <span class="n">MultilabelStratifiedKFold</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>

<span class="n">mskf</span> <span class="o">=</span> <span class="n">MultilabelStratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">mskf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TRAIN:&quot;</span><span class="p">,</span> <span class="n">train_index</span><span class="p">,</span> <span class="s2">&quot;TEST:&quot;</span><span class="p">,</span> <span class="n">test_index</span><span class="p">)</span>
   <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
   <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="interpret-your-model-with-shapash">
<h4><span class="section-number">5.6.20. </span>Interpret your Model with <code class="docutils literal notranslate"><span class="pre">Shapash</span></code><a class="headerlink" href="#interpret-your-model-with-shapash" title="Permalink to this heading">#</a></h4>
<p>Nobody cares about your SOTA ML Model if nobody can’t understand the predictions.</p>
<p>Therefore, interpretability of ML Models is a crucial point in industry cases.</p>
<p>To overcome this hurdle, use <code class="docutils literal notranslate"><span class="pre">Shapash</span></code> for Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">Shapash</span></code> offers several types of interpretability methods to understand your model’s predictions like:</p>
<ul class="simple">
<li><p>Feature Importance</p></li>
<li><p>Feature Contribution</p></li>
<li><p>LIME</p></li>
<li><p>SHAP</p></li>
</ul>
<p>It comes also with an intuitive GUI to interact with.</p>
<p>Check it out! Link is in the comments section.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>shapash
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">category_encoders</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">ExtraTreesRegressor</span>

<span class="kn">from</span> <span class="nn">shapash.data.data_loader</span> <span class="kn">import</span> <span class="n">data_loading</span>
<span class="n">house_df</span><span class="p">,</span> <span class="n">house_dict</span> <span class="o">=</span> <span class="n">data_loading</span><span class="p">(</span><span class="s1">&#39;house_prices&#39;</span><span class="p">)</span>

<span class="n">y_df</span><span class="o">=</span><span class="n">house_df</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="n">X_df</span><span class="o">=</span><span class="n">house_df</span><span class="p">[</span><span class="n">house_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">])]</span>

<span class="kn">from</span> <span class="nn">category_encoders</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>

<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">X_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">]</span>

<span class="n">encoder</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span>
    <span class="n">cols</span><span class="o">=</span><span class="n">categorical_features</span><span class="p">,</span>
    <span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
    <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_df</span><span class="p">)</span>

<span class="n">X_df</span><span class="o">=</span><span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_df</span><span class="p">)</span>

<span class="n">Xtrain</span><span class="p">,</span> <span class="n">Xtest</span><span class="p">,</span> <span class="n">ytrain</span><span class="p">,</span> <span class="n">ytest</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_df</span><span class="p">,</span> <span class="n">y_df</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">regressor</span> <span class="o">=</span> <span class="n">LGBMRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xtrain</span><span class="p">,</span><span class="n">ytrain</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">shapash</span> <span class="kn">import</span> <span class="n">SmartExplainer</span>

<span class="n">xpl</span> <span class="o">=</span> <span class="n">SmartExplainer</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">regressor</span><span class="p">,</span>
    <span class="n">preprocessing</span><span class="o">=</span><span class="n">encoder</span><span class="p">,</span>  
    <span class="n">features_dict</span><span class="o">=</span><span class="n">house_dict</span>  
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xpl</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Xtest</span><span class="p">,</span>
            <span class="n">y_target</span><span class="o">=</span><span class="n">ytest</span> 
           <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">xpl</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">title_story</span><span class="o">=</span><span class="s1">&#39;House Prices&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8020</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="validate-your-model-and-data-with-deepchecks">
<h4><span class="section-number">5.6.21. </span>Validate Your Model and Data with <code class="docutils literal notranslate"><span class="pre">Deepchecks</span></code><a class="headerlink" href="#validate-your-model-and-data-with-deepchecks" title="Permalink to this heading">#</a></h4>
<p>Validating your Model and Data is crucial in ML.</p>
<p>Not testing them will cause huge problems in production.</p>
<p>To change that, use <code class="docutils literal notranslate"><span class="pre">deepchecks</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">deepchecks</span></code> is an open-source solution which offers a suite for detailed validation methods.</p>
<p>It will calculate and visualize a bunch of things like:</p>
<ul class="simple">
<li><p>Train/Test Performance</p></li>
<li><p>Predictive Power Score</p></li>
<li><p>Feature Drift</p></li>
<li><p>Label Drift</p></li>
<li><p>Weak Segments for your model</p></li>
</ul>
<p>A powerful tool to consider for testing your models and datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>deepchecks
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="kn">from</span> <span class="nn">deepchecks.tabular.datasets.classification</span> <span class="kn">import</span> <span class="n">iris</span>
<span class="kn">from</span> <span class="nn">deepchecks.tabular</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">deepchecks.tabular.suites</span> <span class="kn">import</span> <span class="n">full_suite</span>

<span class="c1"># Load Data</span>
<span class="n">iris_df</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">data_format</span><span class="o">=</span><span class="s1">&#39;Dataframe&#39;</span><span class="p">,</span> <span class="n">as_train_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">label_col</span> <span class="o">=</span> <span class="s1">&#39;target&#39;</span>
<span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">iris_df</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">iris_df</span><span class="p">[</span><span class="n">label_col</span><span class="p">],</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Train Model</span>
<span class="n">rf_clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">rf_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">label_col</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">df_train</span><span class="p">[</span><span class="n">label_col</span><span class="p">])</span>


<span class="n">ds_train</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_col</span><span class="p">,</span> <span class="n">cat_features</span><span class="o">=</span><span class="p">[])</span>
<span class="n">ds_test</span> <span class="o">=</span>  <span class="n">Dataset</span><span class="p">(</span><span class="n">df_test</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="n">label_col</span><span class="p">,</span> <span class="n">cat_features</span><span class="o">=</span><span class="p">[])</span>

<span class="n">suite</span> <span class="o">=</span> <span class="n">full_suite</span><span class="p">()</span>

<span class="n">suite</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">=</span><span class="n">ds_train</span><span class="p">,</span> <span class="n">test_dataset</span><span class="o">=</span><span class="n">ds_test</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">rf_clf</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-high-performance-features-with-optuna">
<h4><span class="section-number">5.6.22. </span>Visualize high-performance Features with <code class="docutils literal notranslate"><span class="pre">Optuna</span></code><a class="headerlink" href="#visualize-high-performance-features-with-optuna" title="Permalink to this heading">#</a></h4>
<p>Optuna released a new feature for detecting high-performing parameters.</p>
<p>Its <code class="docutils literal notranslate"><span class="pre">plot_rank()</span></code> function visualizes different parameters, with individual points representing individual trials.</p>
<p>Since the plot is interactive, you can also hover over it and dive deeper into analysing your hyperparameter optimization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="kn">import</span> <span class="nn">optuna</span>


<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;gini&quot;</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;Mdpth&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">min_samples_split</span><span class="o">=</span><span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;mspl&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;mlfs&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">min_weight_fraction_leaf</span><span class="o">=</span><span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;mwfr&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
        <span class="n">max_features</span><span class="o">=</span><span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s2">&quot;Mfts&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
        <span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;Mnods&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

<span class="c1"># Optimize</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">)</span>
<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="c1"># Get parameters sorted by the importance values</span>
<span class="n">importances</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">importance</span><span class="o">.</span><span class="n">get_param_importances</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
<span class="n">params_sorted</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">importances</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># Plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_rank</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params_sorted</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-ensembling-with-combo">
<h4><span class="section-number">5.6.23. </span>Model Ensembling with <code class="docutils literal notranslate"><span class="pre">combo</span></code><a class="headerlink" href="#model-ensembling-with-combo" title="Permalink to this heading">#</a></h4>
<p>Looking at the top solutions on Kaggle you will notice one thing:</p>
<p>There is usually some sort of combination of various ML models involved.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">combo</span></code> for Python, you can combine</p>
<ul class="simple">
<li><p>Multiple Classifiers</p></li>
<li><p>Multiple Anomaly Detection Models</p></li>
<li><p>Multiple Clustering Models</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">combo</span></code> also offers multiple combination methods for every category.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>combo
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">combo.models.cluster_comb</span> <span class="kn">import</span> <span class="n">ClustererEnsemble</span>

<span class="n">estimators</span> <span class="o">=</span> <span class="p">[</span><span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">),</span>
              <span class="n">MiniBatchKMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">),</span>
              <span class="n">AgglomerativeClustering</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">)]</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">ClustererEnsemble</span><span class="p">(</span><span class="n">estimators</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="n">n_clusters</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">aligned_labels</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">aligned_labels_</span>
<span class="n">predicted_labels</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">labels_</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="residual-plots-with-yellowbrick">
<h4><span class="section-number">5.6.24. </span>Residual Plots with <code class="docutils literal notranslate"><span class="pre">yellowbrick</span></code><a class="headerlink" href="#residual-plots-with-yellowbrick" title="Permalink to this heading">#</a></h4>
<p>To analyze the variance of the error of your Regression model</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">ResidualPlot</span></code> from <code class="docutils literal notranslate"><span class="pre">yellowbrick</span></code>.</p>
<p>With Residual Plots, you can see how well-fitted your model is.</p>
<p>If the data points exhibit a random distribution along the horizontal axis, a linear regression model is typically suitable, whereas in cases of non-random dispersion, a non-linear model is a better choice.</p>
<p>See below how you can easily implement that with <code class="docutils literal notranslate"><span class="pre">yellowbrick</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>yellowbrick
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yellowbrick.datasets</span> <span class="kn">import</span> <span class="n">load_concrete</span>
<span class="kn">from</span> <span class="nn">yellowbrick.regressor</span> <span class="kn">import</span> <span class="n">ResidualsPlot</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">()</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">ResidualsPlot</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="powerful-and-distributed-hyperparameter-optimization-with-ray-tune">
<h4><span class="section-number">5.6.25. </span>Powerful and Distributed Hyperparameter Optimization with <code class="docutils literal notranslate"><span class="pre">ray.tune</span></code><a class="headerlink" href="#powerful-and-distributed-hyperparameter-optimization-with-ray-tune" title="Permalink to this heading">#</a></h4>
<p>Do you need hyperparameter tuning on steroids?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">tune</span></code> from <code class="docutils literal notranslate"><span class="pre">ray</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">tune</span></code> performs distributed hyperparameter tuning with multi-GPU and multi-node support, utilizing all the hardware you have.</p>
<p>It supports the most popular ML libraries and integrates many other common hyperparameter optimization tools like Optuna or Hyperopt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;ray[tune]&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install &quot;ray[tune]&quot;</span>
<span class="kn">import</span> <span class="nn">sklearn.datasets</span>
<span class="kn">import</span> <span class="nn">sklearn.metrics</span>
<span class="kn">import</span> <span class="nn">sklearn.datasets</span>
<span class="kn">import</span> <span class="nn">sklearn.metrics</span>
<span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">train</span><span class="p">,</span> <span class="n">tune</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>


<span class="k">def</span> <span class="nf">train_breast_cancer</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">load_breast_cancer</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">train_x</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">train_set</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">train_y</span><span class="p">)</span>
    <span class="n">test_set</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">test_x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">test_y</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
        <span class="n">config</span><span class="p">,</span>
        <span class="n">train_set</span><span class="p">,</span>
        <span class="n">evals</span><span class="o">=</span><span class="p">[(</span><span class="n">test_set</span><span class="p">,</span> <span class="s2">&quot;eval&quot;</span><span class="p">)],</span>
        <span class="n">evals_result</span><span class="o">=</span><span class="n">results</span><span class="p">,</span>
        <span class="n">verbose_eval</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;eval&quot;</span><span class="p">][</span><span class="s2">&quot;error&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">train</span><span class="o">.</span><span class="n">report</span><span class="p">({</span><span class="s2">&quot;mean_accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">,</span> <span class="s2">&quot;done&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>


<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;objective&quot;</span><span class="p">:</span> <span class="s2">&quot;binary:logistic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eval_metric&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;logloss&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">],</span>
    <span class="s2">&quot;min_child_weight&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span>
    <span class="s2">&quot;subsample&quot;</span><span class="p">:</span> <span class="n">tune</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">tuner</span> <span class="o">=</span> <span class="n">tune</span><span class="o">.</span><span class="n">Tuner</span><span class="p">(</span>
    <span class="n">train_breast_cancer</span><span class="p">,</span>
    <span class="n">tune_config</span><span class="o">=</span><span class="n">tune</span><span class="o">.</span><span class="n">TuneConfig</span><span class="p">(</span>
        <span class="n">num_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">param_space</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">get_best_result</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s2">&quot;mean_accuracy&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="use-pytorch-with-scikit-learn-api-with-skorch">
<h4><span class="section-number">5.6.26. </span>Use PyTorch with scikit-learn API with <code class="docutils literal notranslate"><span class="pre">skorch</span></code><a class="headerlink" href="#use-pytorch-with-scikit-learn-api-with-skorch" title="Permalink to this heading">#</a></h4>
<p>PyTorch and scikit-learn are one of the most popular libraries for ML/DL.</p>
<p>So, why not combine PyTorch with scikit-learn?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">skorch</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">skorch</span></code> is a high-level library for PyTorch that provides a scikit-learn-compatible neural network module.</p>
<p>It allows you to use the simple scikit-learn interface for PyTorch.</p>
<p>Therefore you can integrate PyTorch models into scikit-learn workflows.</p>
<p>See below for an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>skorch
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">skorch</span> <span class="kn">import</span> <span class="n">NeuralNetClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_units</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">nonlin</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dense</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">num_units</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nonlin</span> <span class="o">=</span> <span class="n">nonlin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">num_units</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">X</span>

<span class="n">net</span> <span class="o">=</span> <span class="n">NeuralNetClassifier</span><span class="p">(</span>
    <span class="n">MyModule</span><span class="p">,</span>
    <span class="n">max_epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">lr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">iterator_train__shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;net&#39;</span><span class="p">,</span> <span class="n">net</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">y_proba</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="online-ml-with-river">
<h4><span class="section-number">5.6.27. </span>Online ML with <code class="docutils literal notranslate"><span class="pre">river</span></code><a class="headerlink" href="#online-ml-with-river" title="Permalink to this heading">#</a></h4>
<p>Do you want ML models that learn on-the-fly from massive datasets?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">river</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">river</span></code> is a library for online machine learning.</p>
<p>You can continuously update your model with streaming data without using the full dataset for training again.</p>
<p>It provides online implementations for many algorithms like KNN, Tree-based models and Recommender systems.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>river
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">compose</span>
<span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">linear_model</span>
<span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">datasets</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Phishing</span><span class="p">()</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">compose</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">(),</span>
    <span class="n">linear_model</span><span class="o">.</span><span class="n">LogisticRegression</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">()</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>     
    <span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>           
    <span class="n">model</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>              
</pre></div>
</div>
</div>
</div>
</section>
<section id="sota-computer-vision-models-with-timm">
<h4><span class="section-number">5.6.28. </span>SOTA Computer Vision Models with <code class="docutils literal notranslate"><span class="pre">timm</span></code><a class="headerlink" href="#sota-computer-vision-models-with-timm" title="Permalink to this heading">#</a></h4>
<p>Do you want to use SOTA computer vision models?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">timm</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">timm</span></code> (PyTorch Image Models) is a library which contains multiple computer vision models, layers, optimizers, etc.</p>
<p>It provides models like Vision Transformer, MobileNet, Swin Transformer, ConvNeXt, DenseNet, and more.</p>
<p>You just have to define the name of the model and if you want to have the pretrained weights of it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>timm
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">timm</span>

<span class="nb">print</span><span class="p">(</span><span class="n">timm</span><span class="o">.</span><span class="n">list_models</span><span class="p">())</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">timm</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="s1">&#39;densenet121&#39;</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-guaranteed-prediction-intervals-and-sets-with-mapie">
<h4><span class="section-number">5.6.29. </span>Generate Guaranteed Prediction Intervals and Sets with <code class="docutils literal notranslate"><span class="pre">MAPIE</span></code><a class="headerlink" href="#generate-guaranteed-prediction-intervals-and-sets-with-mapie" title="Permalink to this heading">#</a></h4>
<p>For quantifying uncertainties of your models, use MAPIE.</p>
<p><code class="docutils literal notranslate"><span class="pre">MAPIE</span></code> (Model Agnostic Prediction Interval Estimator) takes your sklearn-/tensorflow-/pytorch-compatible model and generate prediction intervals or sets with guaranteed coverage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>mapie
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mapie.regression</span> <span class="kn">import</span> <span class="n">MapieRegressor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_regression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_regression</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">59</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">regressor</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>

<span class="n">mapie_regressor</span> <span class="o">=</span> <span class="n">MapieRegressor</span><span class="p">(</span><span class="n">regressor</span><span class="p">)</span>
<span class="n">mapie_regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">]</span>
<span class="n">y_pred</span><span class="p">,</span> <span class="n">y_pis</span> <span class="o">=</span> <span class="n">mapie_regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="extra-components-for-scikit-learn-with-scikit-lego">
<h4><span class="section-number">5.6.30. </span>Extra Components For scikit-learn with <code class="docutils literal notranslate"><span class="pre">scikit-lego</span></code><a class="headerlink" href="#extra-components-for-scikit-learn-with-scikit-lego" title="Permalink to this heading">#</a></h4>
<p>scikit-learn is one of the most popular ML libraries.</p>
<p>While it’s easy to write custom components, it would be nice to have all of them in a single place.</p>
<p><code class="docutils literal notranslate"><span class="pre">scikit-lego</span></code> is such a library which contains many custom components like:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DebugPipeline</span></code>, which adds debug information to pipelines</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ImbalancedLinearRegression</span></code> to punish over-/underestimation of a model</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">add_lags</span></code> to add lag values to a DataFrame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ZeroInflatedRegressor</span></code> which predicts zero or applies a regression based on a classifier</p></li>
</ul>
<p>and many more!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>scikit-lego
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklego.preprocessing</span> <span class="kn">import</span> <span class="n">RandomAdder</span>
<span class="kn">from</span> <span class="nn">sklego.mixture</span> <span class="kn">import</span> <span class="n">GMMClassifier</span>

<span class="o">...</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;random_noise&quot;</span><span class="p">,</span> <span class="n">RandomAdder</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">GMMClassifier</span><span class="p">())</span>
<span class="p">])</span>

<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="quantize-your-models-with-torchao">
<h4><span class="section-number">5.6.31. </span>Quantize your Models with <code class="docutils literal notranslate"><span class="pre">torchao</span></code><a class="headerlink" href="#quantize-your-models-with-torchao" title="Permalink to this heading">#</a></h4>
<p>Quantizing your Deep Learning models was never easier.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">torchao</span></code>, you can quantize and sparsify your models with 1 line of code.</p>
<p>If you are unsure which method to use, you can even use the autoquant method to quantize your layers automatically.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>torchao
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torchao</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">torchao</span><span class="o">.</span><span class="n">autoquant</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;max-autotune&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/machinelearning/outlierdetection"></span><section id="outlier-detection">
<h3><span class="section-number">5.7. </span>Outlier Detection<a class="headerlink" href="#outlier-detection" title="Permalink to this heading">#</a></h3>
<section id="ensembling-for-outlier-detection">
<h4><span class="section-number">5.7.1. </span>Ensembling for Outlier Detection<a class="headerlink" href="#ensembling-for-outlier-detection" title="Permalink to this heading">#</a></h4>
<p>Due to its unsupervised nature, outlier detection methods often suffer from model instability.</p>
<p>So, why not combine various models?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">PyOD</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">PyOD</span></code> is an easy-to-use library for outlier detection.</p>
<p>It includes more than 30 algorithms like density-based methods or ensembles.</p>
<p><code class="docutils literal notranslate"><span class="pre">PyOD</span></code> also supports combining multiple methods like</p>
<ul class="simple">
<li><p>Average of scores</p></li>
<li><p>Maximization of scores</p></li>
<li><p>Average of Maximum of scores</p></li>
<li><p>Maximum of Average of scores</p></li>
<li><p>Majority Vote</p></li>
</ul>
<p>To combine multiple models in Python, consider the example below.</p>
<ul class="simple">
<li><p>We define 3 outlier detectors.</p></li>
<li><p>We calculate the labels for every detector (0=inliner, 1=outlier).</p></li>
<li><p>We use <code class="docutils literal notranslate"><span class="pre">majority_vote()</span></code> method to calculate the highest-voted label for each sample.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pyod
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyod.models.combination</span> <span class="kn">import</span> <span class="n">majority_vote</span>
<span class="kn">from</span> <span class="nn">pyod.models.knn</span> <span class="kn">import</span> <span class="n">KNN</span>
<span class="kn">from</span> <span class="nn">pyod.models.abod</span> <span class="kn">import</span> <span class="n">ABOD</span>
<span class="kn">from</span> <span class="nn">pyod.models.iforest</span> <span class="kn">import</span> <span class="n">IForest</span>
<span class="kn">from</span> <span class="nn">pyod.utils.data</span> <span class="kn">import</span> <span class="n">generate_data</span>

<span class="n">X</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span> <span class="n">generate_data</span><span class="p">(</span><span class="n">train_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">KNN</span><span class="p">(),</span> <span class="n">ABOD</span><span class="p">(),</span> <span class="n">IForest</span><span class="p">()]</span>
<span class="n">n_models</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_models</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_models</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">labels</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">labels_</span>
    
<span class="n">majority_vote</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="robust-outlier-detection-with-puncc">
<h4><span class="section-number">5.7.2. </span>Robust Outlier Detection with <code class="docutils literal notranslate"><span class="pre">puncc</span></code><a class="headerlink" href="#robust-outlier-detection-with-puncc" title="Permalink to this heading">#</a></h4>
<p>Outlier Detection is notoriously hard.</p>
<p>But it doesn’t have to.</p>
<p><code class="docutils literal notranslate"><span class="pre">puncc</span></code> offers outlier detection, powered by Conformal Prediction, where the detection threshold will be calibrated.</p>
<p>So, false alarms are reduced.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install puncc
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>
<span class="kn">from</span> <span class="nn">deel.puncc.anomaly_detection</span> <span class="kn">import</span> <span class="n">SplitCAD</span>
<span class="kn">from</span> <span class="nn">deel.puncc.api.prediction</span> <span class="kn">import</span> <span class="n">BasePredictor</span>

<span class="c1"># We need to redefine the predict to output the nonconformity scores.</span>
<span class="k">class</span> <span class="nc">ADPredictor</span><span class="p">(</span><span class="n">BasePredictor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Wrap Isolation Forest in a predictor</span>
<span class="n">if_predictor</span> <span class="o">=</span> <span class="n">ADPredictor</span><span class="p">(</span><span class="n">IsolationForest</span><span class="p">())</span>

<span class="c1"># Instantiate CAD on top of IF predictor</span>
<span class="n">if_cad</span> <span class="o">=</span> <span class="n">SplitCAD</span><span class="p">(</span><span class="n">if_predictor</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">if_cad</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">fit_ratio</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># Maximum false detection rate</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">if_cad</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/machinelearning/timeseries"></span><section id="time-series">
<h3><span class="section-number">5.8. </span>Time Series<a class="headerlink" href="#time-series" title="Permalink to this heading">#</a></h3>
<section id="check-seasonality-automatically-with-darts">
<h4><span class="section-number">5.8.1. </span>Check Seasonality automatically with <code class="docutils literal notranslate"><span class="pre">darts</span></code><a class="headerlink" href="#check-seasonality-automatically-with-darts" title="Permalink to this heading">#</a></h4>
<p>Seasonality describes a pattern that repeats regularly over time.</p>
<p>Identifying and understanding the seasonality in time series can boost the performance of your model.</p>
<p>But you don’t have to find the seasonality effect and period by yourself.</p>
<p>Instead, you can use <code class="docutils literal notranslate"><span class="pre">check_seasonality()</span></code> from <code class="docutils literal notranslate"><span class="pre">darts</span></code> in Python.</p>
<p>It will check if the time series is seasonal and returns also the period, which is inferred from the Auto-correlation Function.</p>
<p>In the example below, it will return a seasonal period of 12 (Air Passenger Dataset has a monthly frequency).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install darts
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">darts.utils.statistics</span> <span class="kn">import</span> <span class="n">check_seasonality</span>
<span class="kn">from</span> <span class="nn">darts.datasets</span> <span class="kn">import</span> <span class="n">AirPassengersDataset</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">AirPassangersDataset</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="n">is_seasonal</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="n">check_seasonality</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cross-validation-for-time-series-data-with-timeseriessplit">
<h4><span class="section-number">5.8.2. </span>Cross-validation for Time Series Data with <code class="docutils literal notranslate"><span class="pre">TimeSeriesSplit</span></code><a class="headerlink" href="#cross-validation-for-time-series-data-with-timeseriessplit" title="Permalink to this heading">#</a></h4>
<p>How to do Cross-Validation with Time Series?</p>
<p>Using standard K-Fold Cross-Validation will not work.</p>
<p>In this case, you would simply partition the data into k folds, and then train and evaluate the model k times, each time using a different fold as the test set and the rest of the data as the training set.</p>
<p>But, this can lead to issues because the model will be trained on data that is both before and after the test data.</p>
<p>This can result in overfitting or biased estimates of model performance</p>
<p>Instead, use <code class="docutils literal notranslate"><span class="pre">TimeSeriesSplit</span></code> from scikit-learn.</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeSeriesSplit</span></code> ensures that the model is only trained on the past values and tested on future data.</p>
<p>This gives you a more accurate and less biased assessment of the model’s performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">TimeSeriesSplit</span><span class="p">,</span> <span class="n">cross_validate</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">()</span>

<span class="n">ts_cv</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">ts_cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="more-cross-validation-with-tscv">
<h4><span class="section-number">5.8.3. </span>More Cross-Validation with <code class="docutils literal notranslate"><span class="pre">tscv</span></code><a class="headerlink" href="#more-cross-validation-with-tscv" title="Permalink to this heading">#</a></h4>
<p>How to do Cross-Validation with Time Series?</p>
<p>Using standard K-Fold Cross-Validation will not work.</p>
<p>In this case, you would simply partition the data into k folds, and then train and evaluate the model k times, each time using a different fold as the test set and the rest of the data as the training set.</p>
<p>But, this can lead to issues because the model will be trained on data that is both before and after the test data.</p>
<p>This can result in overfitting or biased estimates of model performance.</p>
<p>Instead, use <code class="docutils literal notranslate"><span class="pre">tscv</span></code> package for Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">tscv</span></code> offers methods for correct splitting of your data with 3 classes implemented:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GapLeavePOut</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GapKFold</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GapRollForward</span></code></p></li>
</ul>
<p>This gives you a more accurate and less biased assessment of the model’s performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install tscv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tscv</span> <span class="kn">import</span> <span class="n">GapRollForward</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">GapRollForward</span><span class="p">(</span><span class="n">min_train_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">gap_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_test_size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;train:&quot;</span><span class="p">,</span> <span class="n">train</span><span class="p">,</span> <span class="s2">&quot;test:&quot;</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-series-forecasting-with-machine-learning-with-mlforecast">
<h4><span class="section-number">5.8.4. </span>Time Series Forecasting with Machine Learning with <code class="docutils literal notranslate"><span class="pre">mlforecast</span></code><a class="headerlink" href="#time-series-forecasting-with-machine-learning-with-mlforecast" title="Permalink to this heading">#</a></h4>
<p>Do you want to perform powerful time series forecasting?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">mlforecast</span></code> by Nixtla.</p>
<p><code class="docutils literal notranslate"><span class="pre">mlforecast</span></code> lets you run Machine Learning models for time series forecasting, even on remote clusters like Ray or Spark.</p>
<p>Feature Engineering, support for exogenous variables, and probabilistic forecasting are also included.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install mlforecast
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lightgbm</span> <span class="k">as</span> <span class="nn">lgb</span>

<span class="kn">from</span> <span class="nn">mlforecast</span> <span class="kn">import</span> <span class="n">MLForecast</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="n">mlf</span> <span class="o">=</span> <span class="n">MLForecast</span><span class="p">(</span>
    <span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">LinearRegression</span><span class="p">(),</span> <span class="n">lgb</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">()],</span>
    <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span>
<span class="p">)</span>
<span class="n">mlf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">mlf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="lightning-fast-time-series-forecasting-with-statsforecast">
<h4><span class="section-number">5.8.5. </span>Lightning Fast Time Series Forecasting with <code class="docutils literal notranslate"><span class="pre">statsforecast</span></code><a class="headerlink" href="#lightning-fast-time-series-forecasting-with-statsforecast" title="Permalink to this heading">#</a></h4>
<p>Do you want to perform lightning fast time series forecasting?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">statsforecast</span></code> by Nixtla.</p>
<p><code class="docutils literal notranslate"><span class="pre">statsforecast</span></code> lets you run statistical models on your time series data.</p>
<p>It’s up to 20x faster than existing libraries like pmdarima and statsmodels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install statsforecast
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsforecast</span> <span class="kn">import</span> <span class="n">StatsForecast</span>
<span class="kn">from</span> <span class="nn">statsforecast.models</span> <span class="kn">import</span> <span class="n">AutoARIMA</span>
<span class="kn">from</span> <span class="nn">statsforecast.utils</span> <span class="kn">import</span> <span class="n">AirPassengersDF</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">AirPassengersDF</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">StatsForecast</span><span class="p">(</span>
    <span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">AutoARIMA</span><span class="p">(</span><span class="n">season_length</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)],</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span>
<span class="p">)</span>

<span class="n">sf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">sf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="mi">95</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-series-with-polars-backend-with-functime">
<h4><span class="section-number">5.8.6. </span>Time Series with Polars Backend with <code class="docutils literal notranslate"><span class="pre">functime</span></code><a class="headerlink" href="#time-series-with-polars-backend-with-functime" title="Permalink to this heading">#</a></h4>
<p>Fast time-series forecasting with <code class="docutils literal notranslate"><span class="pre">functime</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">functime</span></code> is a Python library for time series forecasting and feature extraction, built with Polars.</p>
<p>Since it uses lazy Polars dataframes, <code class="docutils literal notranslate"><span class="pre">functime</span></code> speeds up forecasting and feature engineering.</p>
<p>Backtesting, cross-validation splitters and metrics are included too.</p>
<p>It even comes with a LLM agent to analyze and describe your forecasts.</p>
<p>Check it out!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install functime
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">from</span> <span class="nn">functime.cross_validation</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">functime.forecasting</span> <span class="kn">import</span> <span class="n">linear_model</span>
<span class="kn">from</span> <span class="nn">functime.metrics</span> <span class="kn">import</span> <span class="n">mase</span>

<span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">test_size</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

<span class="n">forecaster</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s2">&quot;1mo&quot;</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">forecaster</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">forecaster</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fh</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s2">&quot;1mo&quot;</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">24</span><span class="p">)(</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">scores</span> <span class="o">=</span> <span class="n">mase</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_train</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-series-forecasting-with-deep-learning-with-neuralforecast">
<h4><span class="section-number">5.8.7. </span>Time Series Forecasting with Deep Learning with <code class="docutils literal notranslate"><span class="pre">neuralforecast</span></code><a class="headerlink" href="#time-series-forecasting-with-deep-learning-with-neuralforecast" title="Permalink to this heading">#</a></h4>
<p>Do you want to perform powerful time series forecasting?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">neuralforecast</span></code> by nixtla.</p>
<p><code class="docutils literal notranslate"><span class="pre">neuralforecast</span></code> lets you run Deep Learning models for time series forecasting with models like N-BEATS or N-HiTS.</p>
<p>Support for exogenous variables and probabilistic forecasting are also included.</p>
<p>Check the example below!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install neuralforecast
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">neuralforecast</span> <span class="kn">import</span> <span class="n">NeuralForecast</span>
<span class="kn">from</span> <span class="nn">neuralforecast.models</span> <span class="kn">import</span> <span class="n">NBEATS</span><span class="p">,</span> <span class="n">NHITS</span>
<span class="kn">from</span> <span class="nn">neuralforecast.utils</span> <span class="kn">import</span> <span class="n">AirPassengersDF</span>

<span class="n">Y_df</span> <span class="o">=</span> <span class="n">AirPassengersDF</span>
<span class="n">Y_train_df</span> <span class="o">=</span> <span class="n">Y_df</span><span class="p">[</span><span class="n">Y_df</span><span class="o">.</span><span class="n">ds</span><span class="o">&lt;=</span><span class="s1">&#39;1959-12-31&#39;</span><span class="p">]</span>
<span class="n">Y_test_df</span> <span class="o">=</span> <span class="n">Y_df</span><span class="p">[</span><span class="n">Y_df</span><span class="o">.</span><span class="n">ds</span><span class="o">&gt;</span><span class="s1">&#39;1959-12-31&#39;</span><span class="p">]</span>

<span class="n">horizon</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">NBEATS</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">horizon</span><span class="p">,</span> <span class="n">max_steps</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
          <span class="n">NHITS</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">horizon</span><span class="p">,</span> <span class="n">max_steps</span><span class="o">=</span><span class="mi">50</span><span class="p">)]</span>

<span class="n">nf</span> <span class="o">=</span> <span class="n">NeuralForecast</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
<span class="n">nf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">Y_train_df</span><span class="p">)</span>
<span class="n">Y_hat_df</span> <span class="o">=</span> <span class="n">nf</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="efficient-preprocessing-and-feature-engineering-with-temporian">
<h4><span class="section-number">5.8.8. </span>Efficient Preprocessing and Feature Engineering with <code class="docutils literal notranslate"><span class="pre">temporian</span></code><a class="headerlink" href="#efficient-preprocessing-and-feature-engineering-with-temporian" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">temporian</span></code> is a Python library for preprocessing and feature engineering temporal data to feed into ML libraries like XGBoost, Scikit-learn or PyTorch.</p>
<p>It handles various types of temporal data like single- and multivariate data or flat- and multi-index data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install temporian
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">temporian</span> <span class="k">as</span> <span class="nn">tp</span>

<span class="n">sales</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">from_csv</span><span class="p">(</span><span class="s2">&quot;sales.csv&quot;</span><span class="p">)</span>

<span class="n">sales_per_store</span> <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">add_index</span><span class="p">(</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>

<span class="n">days</span> <span class="o">=</span> <span class="n">sales_per_store</span><span class="o">.</span><span class="n">tick_calendar</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">work_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">days</span><span class="o">.</span><span class="n">calendar_day_of_week</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">()</span>

<span class="n">daily_revenue</span> <span class="o">=</span> <span class="n">sales_per_store</span><span class="p">[</span><span class="s2">&quot;revenue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">moving_sum</span><span class="p">(</span>
                     <span class="n">tp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">days</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> 
                     <span class="n">sampling</span><span class="o">=</span><span class="n">work_days</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="change-point-detection-with-ruptures">
<h4><span class="section-number">5.8.9. </span>Change Point Detection with <code class="docutils literal notranslate"><span class="pre">ruptures</span></code><a class="headerlink" href="#change-point-detection-with-ruptures" title="Permalink to this heading">#</a></h4>
<p>Change point detection was never easier in Python with `ruptures``</p>
<p><code class="docutils literal notranslate"><span class="pre">ruptures</span></code> is a library which provides methods for detecting and displaying off-line change points.</p>
<p>It offers multiple exact and approximation detection methods.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install ruptures
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ruptures</span> <span class="k">as</span> <span class="nn">rpt</span>

<span class="c1"># Generate signal</span>
<span class="n">n_samples</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>
<span class="n">n_breakpoints</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">signal</span><span class="p">,</span> <span class="n">bkps</span> <span class="o">=</span> <span class="n">rpt</span><span class="o">.</span><span class="n">pw_constant</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">n_breakpoints</span><span class="p">,</span> <span class="n">noise_std</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>

<span class="c1"># Detection</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">rpt</span><span class="o">.</span><span class="n">Pelt</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;rbf&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pen</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Display</span>
<span class="n">rpt</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">bkps</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="probabilistic-machine-learning-with-skpro">
<h4><span class="section-number">5.8.10. </span>Probabilistic Machine Learning with <code class="docutils literal notranslate"><span class="pre">skpro</span></code><a class="headerlink" href="#probabilistic-machine-learning-with-skpro" title="Permalink to this heading">#</a></h4>
<p>Use supervised probabilistic prediction like a pro with <code class="docutils literal notranslate"><span class="pre">skpro</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">skpro</span></code> is a scikit-learn-like library for probabilistic predictions and evaluations.</p>
<p>It supports tabular regressors, survival prediction, and reductions to turn scikit-learn regressors into probabilistic <code class="docutils literal notranslate"><span class="pre">skpro</span></code> regressors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install skpro
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_diabetes</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="kn">from</span> <span class="nn">skpro.regression.residual</span> <span class="kn">import</span> <span class="n">ResidualDouble</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_diabetes</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_new</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">reg_mean</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">()</span>
<span class="n">reg_resid</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">reg_proba</span> <span class="o">=</span> <span class="n">ResidualDouble</span><span class="p">(</span><span class="n">reg_mean</span><span class="p">,</span> <span class="n">reg_resid</span><span class="p">)</span>

<span class="n">reg_proba</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">y_pred_proba</span> <span class="o">=</span> <span class="n">reg_proba</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>

<span class="n">y_pred_interval</span> <span class="o">=</span> <span class="n">reg_proba</span><span class="o">.</span><span class="n">predict_interval</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span> <span class="n">coverage</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>

<span class="n">y_pred_quantiles</span> <span class="o">=</span> <span class="n">reg_proba</span><span class="o">.</span><span class="n">predict_quantiles</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>

<span class="n">y_pred_var</span> <span class="o">=</span> <span class="n">reg_proba</span><span class="o">.</span><span class="n">predict_var</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>

<span class="n">y_pred_mean</span> <span class="o">=</span> <span class="n">reg_proba</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluating-forecasts-with-fev">
<h4><span class="section-number">5.8.11. </span>Evaluating Forecasts with <code class="docutils literal notranslate"><span class="pre">fev</span></code><a class="headerlink" href="#evaluating-forecasts-with-fev" title="Permalink to this heading">#</a></h4>
<p>Time Series Forecasting without evaluation is guessing, not knowing.</p>
<p>Make your life easier and use <strong>fev</strong>.</p>
<p><strong>fev</strong> is a new Python library aiming to benchmark forecasting models easily.</p>
<p>As a wrapper on top of Huggingface Datasets, it is very easy to define custom forecasting benchmarks.</p>
<p>It supports point and even probabilistic forecasts which is crucial in today’s world.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install fev
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fev</span>

<span class="c1"># Create Task</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">fev</span><span class="o">.</span><span class="n">Task</span><span class="p">(</span>
    <span class="n">dataset_path</span><span class="o">=</span><span class="s2">&quot;autogluon/chronos_datasets&quot;</span><span class="p">,</span>
    <span class="n">dataset_config</span><span class="o">=</span><span class="s2">&quot;monash_kdd_cup_2018&quot;</span><span class="p">,</span>
    <span class="n">horizon</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Load data</span>
<span class="n">past_data</span><span class="p">,</span> <span class="n">future_data</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get_input_data</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">naive_forecast</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">horizon</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">horizon</span><span class="p">)]</span>

<span class="c1"># Make predictions</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">past_data</span><span class="p">:</span>
    <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;predictions&quot;</span><span class="p">:</span> <span class="n">naive_forecast</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ts</span><span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">target_column</span><span class="p">],</span> <span class="n">horizon</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">horizon</span><span class="p">)}</span>
    <span class="p">)</span>
    

<span class="c1"># Evaluate</span>
<span class="n">task</span><span class="o">.</span><span class="n">evaluation_summary</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;naive&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/machinelearning/preprocessing"></span><section id="preprocessing">
<h3><span class="section-number">5.9. </span>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this heading">#</a></h3>
<section id="clean-your-text-data-with-clean-text">
<h4><span class="section-number">5.9.1. </span>Clean your text data with <code class="docutils literal notranslate"><span class="pre">clean-text</span></code><a class="headerlink" href="#clean-your-text-data-with-clean-text" title="Permalink to this heading">#</a></h4>
<p>Content on the Web and in Social Media is never clean.</p>
<p><code class="docutils literal notranslate"><span class="pre">clean-text</span></code> does the Preprocessing for you.</p>
<p>You can specify, if and how you want to clean your texts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install clean-text[gpl]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cleantext</span> <span class="kn">import</span> <span class="n">clean</span>

<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">       If you want to talk, send me an email: testmail@outlook.com, </span>
<span class="s1">       call me +71112392 or visit my website: https://testurl.com. </span>
<span class="s1">       Calling me is not free, It&#39;</span><span class="se">\\</span><span class="s1">u2018s</span><span class="se">\\</span><span class="s1">u2019 costing 0.40$ per </span>
<span class="s1">       minute.</span>
<span class="s1">       &#39;&#39;&#39;</span>

<span class="n">clean</span><span class="p">(</span><span class="n">text</span><span class="p">,</span>
    <span class="n">fix_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>              <span class="c1"># fix various unicode errors</span>
    <span class="n">to_ascii</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                 <span class="c1"># transliterate to closest ASCII representation</span>
    <span class="n">lower</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                    <span class="c1"># lowercase text</span>
    <span class="n">no_urls</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                  <span class="c1"># replace all URLs with a special token</span>
    <span class="n">no_emails</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                <span class="c1"># replace all email addresses with a special token</span>
    <span class="n">no_phone_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>         <span class="c1"># replace all phone numbers with a special token</span>
    <span class="n">no_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>               <span class="c1"># replace all numbers with a special token</span>
    <span class="n">no_digits</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                <span class="c1"># replace all digits with a special token</span>
    <span class="n">no_currency_symbols</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>      <span class="c1"># replace all currency symbols with a special token</span>
    <span class="n">no_punct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                 <span class="c1"># remove punctuations</span>
    <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span>                      <span class="c1"># set to &#39;de&#39; for German special handling</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="detect-and-fix-your-data-quality-issues">
<h4><span class="section-number">5.9.2. </span>Detect and Fix your Data Quality Issues<a class="headerlink" href="#detect-and-fix-your-data-quality-issues" title="Permalink to this heading">#</a></h4>
<p>Do you want to detect data quality issues?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">pandas_dq</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pandas_dq</span></code> is a relatively new library, focussing on detecting data quality issues and fixing them automatically like:</p>
<ul class="simple">
<li><p>Zero-Variance Columns</p></li>
<li><p>Rare Categories</p></li>
<li><p>Highly correlated Features</p></li>
<li><p>Skewed Distributions</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pandas_dq -q
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pandas_dq</span> <span class="kn">import</span> <span class="n">dq_report</span><span class="p">,</span> <span class="n">Fix_DQ</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]],</span>
                     <span class="n">columns</span><span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;feature_names&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dq_report</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fdq</span> <span class="o">=</span> <span class="n">Fix_DQ</span><span class="p">()</span>
<span class="n">data_transformed</span> <span class="o">=</span> <span class="n">fdq</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-natural-language-numbers-into-its-numerical-representation">
<h4><span class="section-number">5.9.3. </span>Convert Natural Language Numbers into its Numerical Representation<a class="headerlink" href="#convert-natural-language-numbers-into-its-numerical-representation" title="Permalink to this heading">#</a></h4>
<p>If you want to convert natural language numbers into numerical values, try numerizer.</p>
<p><code class="docutils literal notranslate"><span class="pre">numerizer</span></code> is a Python library for converting numbers in texts to their corresponding numerical values.</p>
<p><code class="docutils literal notranslate"><span class="pre">numerizer</span></code> supports a wide range of numeric formats, including whole numbers, decimals, percentages and currencies.</p>
<p>Note: Since version 0.2, <code class="docutils literal notranslate"><span class="pre">numerizer</span></code> is available as a SpaCy extension.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install numerizer
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numerizer</span> <span class="kn">import</span> <span class="n">numerize</span>

<span class="n">text_1</span> <span class="o">=</span> <span class="s2">&quot;Twenty five dollars&quot;</span>
<span class="n">text_2</span> <span class="o">=</span> <span class="s2">&quot;Two hundred and fourty three thousand four hundred and twenty one&quot;</span>
<span class="n">text_3</span> <span class="o">=</span> <span class="s2">&quot;platform nine and three quarters&quot;</span>


<span class="n">num_1</span> <span class="o">=</span> <span class="n">numerize</span><span class="p">(</span><span class="n">text_1</span><span class="p">)</span>
<span class="n">num_2</span> <span class="o">=</span> <span class="n">numerize</span><span class="p">(</span><span class="n">text_2</span><span class="p">)</span>
<span class="n">num_3</span> <span class="o">=</span> <span class="n">numerize</span><span class="p">(</span><span class="n">text_3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">num_1</span><span class="p">)</span> <span class="c1"># Output: 25 dollars</span>
<span class="nb">print</span><span class="p">(</span><span class="n">num_2</span><span class="p">)</span> <span class="c1"># Output: 243421</span>
<span class="nb">print</span><span class="p">(</span><span class="n">num_3</span><span class="p">)</span> <span class="c1"># Output: platform 9.75</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="make-your-numbers-and-dates-human-friendly">
<h4><span class="section-number">5.9.4. </span>Make your Numbers and dates human-friendly<a class="headerlink" href="#make-your-numbers-and-dates-human-friendly" title="Permalink to this heading">#</a></h4>
<p>Looking to make your numbers human-friendly?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">humanize</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">humanize</span></code> formats your numbers and dates in a way that is intuitive to understand.</p>
<p>It provides various functionalities like:</p>
<ul class="simple">
<li><p>Convert large integers of file sizes</p></li>
<li><p>Convert floats to fractions</p></li>
<li><p>Convert dates into a human-understandable format</p></li>
<li><p>Make big integers more readable</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install humanize
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">humanize</span>

<span class="c1"># Convert bytes to human readable format</span>
<span class="n">humanize</span><span class="o">.</span><span class="n">naturalsize</span><span class="p">(</span><span class="mi">1024000</span><span class="p">)</span> <span class="c1"># Output: 1.0 MB</span>

<span class="c1"># Convert a number to its word equivalent</span>
<span class="n">humanize</span><span class="o">.</span><span class="n">intword</span><span class="p">(</span><span class="mi">123500000</span><span class="p">)</span> <span class="c1"># Output: 123.5 million</span>

<span class="c1"># Convert a float to its fractional equivalent</span>
<span class="n">humanize</span><span class="o">.</span><span class="n">fractional</span><span class="p">(</span><span class="mf">0.9</span><span class="p">)</span> <span class="c1"># Output: 9/10</span>

<span class="c1"># Convert seconds to a readable format</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="n">humanize</span><span class="o">.</span><span class="n">naturaldelta</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">))</span> <span class="c1"># Output: 20 minutes</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cleaner-pipeline-definition-in-scikit-learn">
<h4><span class="section-number">5.9.5. </span>Cleaner Pipeline definition in Scikit-Learn<a class="headerlink" href="#cleaner-pipeline-definition-in-scikit-learn" title="Permalink to this heading">#</a></h4>
<p>When you build Pipelines in scikit-learn,</p>
<p>use <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code> instead of the Pipeline class.</p>
<p>The Pipeline class can be really long for more complex pipelines.</p>
<p><code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code> makes your pipeline definition short and elegant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>

<span class="n">num_pipeline</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">KNNImputer</span><span class="p">(),</span> <span class="n">RobustScaler</span><span class="p">())</span>
<span class="n">cat_pipeline</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="select-columns-for-your-pipeline-easily">
<h4><span class="section-number">5.9.6. </span>Select Columns for your Pipeline easily<a class="headerlink" href="#select-columns-for-your-pipeline-easily" title="Permalink to this heading">#</a></h4>
<p>If you want a convenient way to select columns for your Scikit-learn pipelines</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">make_column_selector</span></code>.</p>
<p>You can even provide complex regex patterns to select the columns you want.</p>
<p>Afterward, you can use the result in your Pipelines easily.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_selector</span>

<span class="c1"># Will only select columns with &#39;Feature&#39; in its name</span>
<span class="n">columns_with_feature</span> <span class="o">=</span> <span class="n">make_column_selector</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;Feature&#39;</span><span class="p">)</span>

<span class="c1"># Will only select numeric columns</span>
<span class="n">num_columns</span> <span class="o">=</span> <span class="n">make_column_selector</span><span class="p">(</span><span class="n">dtype_include</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="rare-label-encoding-with-feature-engine">
<h4><span class="section-number">5.9.7. </span>Rare Label Encoding with <code class="docutils literal notranslate"><span class="pre">feature-engine</span></code><a class="headerlink" href="#rare-label-encoding-with-feature-engine" title="Permalink to this heading">#</a></h4>
<p>How to tackle Rare Labels in your dataset?</p>
<p>Rare labels can cause issues during model training, as they may not have sufficient representation for the model to learn meaningful patterns.</p>
<p>For this problem, use <code class="docutils literal notranslate"><span class="pre">RareLabelEncoder</span></code> from <code class="docutils literal notranslate"><span class="pre">feature_engine</span></code>.</p>
<p>It will convert all rare labels (based on a threshold) to the label “Rare”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install feature_engine
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">feature_engine.encoding</span> <span class="kn">import</span> <span class="n">RareLabelEncoder</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;violet&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>

<span class="n">rare_encoder</span> <span class="o">=</span> <span class="n">RareLabelEncoder</span><span class="p">(</span><span class="n">tol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_categories</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">])</span>

<span class="n">df_encoded</span> <span class="o">=</span> <span class="n">rare_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">df</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/llm/index"></span><section id="llm">
<h2><span class="section-number">6. </span>LLM<a class="headerlink" href="#llm" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/llm/Chapter"></span><section id="llm">
<h3><span class="section-number">6.1. </span>LLM<a class="headerlink" href="#llm" title="Permalink to this heading">#</a></h3>
<section id="compressing-prompts-with-no-loss-with-llmlingua">
<h4><span class="section-number">6.1.1. </span>Compressing Prompts With No Loss with <code class="docutils literal notranslate"><span class="pre">llmlingua</span></code><a class="headerlink" href="#compressing-prompts-with-no-loss-with-llmlingua" title="Permalink to this heading">#</a></h4>
<p>Here is how to reduce the costs of working with LLMs.</p>
<p>When working with LLMs, we often encountered problems like exceeding token limits, forgetting context, or paying much more for usage than expected.</p>
<p>Researchers from Microsoft try to solve these problems with <code class="docutils literal notranslate"><span class="pre">llmlingua</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">llmlingua</span></code> compresses your prompt by taking a trained small LLM to detect unimportant tokens.</p>
<p>They claim to achieve up to 20x compression with no or minimal performance loss.</p>
<p>I tried it out by myself and I noticed no performance loss at all, but I would be cautious for critical applications.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install llmlingua
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install llmlingua</span>

<span class="kn">from</span> <span class="nn">llmlingua</span> <span class="kn">import</span> <span class="n">PromptCompressor</span>

<span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;&lt;YOUR_PROMPT&gt;&quot;</span>
<span class="n">llm_lingua</span> <span class="o">=</span> <span class="n">PromptCompressor</span><span class="p">(</span><span class="s2">&quot;lgaalves/gpt2-dolly&quot;</span><span class="p">,)</span>

<span class="n">compressed_prompt</span> <span class="o">=</span> <span class="n">llm_lingua</span><span class="o">.</span><span class="n">compress_prompt</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">instruction</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">question</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">target_token</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="c1"># {&#39;compressed_prompt&#39;: &#39;are- that turns into formatting &amp; with like &quot;[]&quot; best it.......&#39;</span>
<span class="c1"># &#39;origin_tokens&#39;: 2430,</span>
<span class="c1"># &#39;compressed_tokens&#39;: 261,</span>
<span class="c1"># &#39;ratio&#39;: &#39;9.3x&#39;,</span>
<span class="c1"># &#39;saving&#39;: &#39;Saving $0.1 in GPT-4.}&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="one-function-call-to-any-llm-with-litellm">
<h4><span class="section-number">6.1.2. </span>One-Function Call to Any LLM with <code class="docutils literal notranslate"><span class="pre">litellm</span></code><a class="headerlink" href="#one-function-call-to-any-llm-with-litellm" title="Permalink to this heading">#</a></h4>
<p>Do you want a One-Function call to any LLM in Python?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">litellm</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">litellm</span></code> is a Python package to call any LLM in a consistent format and to return a consistent output.</p>
<p>You only need to set the API key of the provider and the model name.</p>
<p>It also supports async calls and streaming the models response.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install litellm
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">litellm</span> <span class="kn">import</span> <span class="n">completion</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;your-api-key&quot;</span> 
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;ANTHROPIC_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;your-api-key&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MISTRAL_API_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;your-api-key&quot;</span>

<span class="n">messages</span> <span class="o">=</span> <span class="p">[{</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello, how are you?&quot;</span><span class="p">,</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">}]</span>

<span class="c1"># OpenAI</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">completion</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">)</span>

<span class="c1"># Anthropic</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">completion</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-instant-1&quot;</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">)</span>

<span class="c1"># Mistral</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">completion</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;mistral/mistral-tiny&quot;</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="safeguard-your-llms-with-llmguard">
<h4><span class="section-number">6.1.3. </span>Safeguard Your LLMs with <code class="docutils literal notranslate"><span class="pre">LLMGuard</span></code><a class="headerlink" href="#safeguard-your-llms-with-llmguard" title="Permalink to this heading">#</a></h4>
<p>Safeguarding your LLMs against unwanting behavior is critical.</p>
<p><code class="docutils literal notranslate"><span class="pre">LLMGuard</span></code>, a Python package, ensures a safe interaction between the user and LLM.</p>
<p>It checks prompts and outputs for:</p>
<ul class="simple">
<li><p>Sensitive Information like credit card number and sanitizes it</p></li>
<li><p>Toxic or harmful language</p></li>
<li><p>Prompt injections</p></li>
</ul>
<p>Use <code class="docutils literal notranslate"><span class="pre">LLMGuard</span></code> to make your LLMs more safe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install llm-guard
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">llm_guard</span> <span class="kn">import</span> <span class="n">scan_output</span><span class="p">,</span> <span class="n">scan_prompt</span>
<span class="kn">from</span> <span class="nn">llm_guard.input_scanners</span> <span class="kn">import</span> <span class="n">Anonymize</span><span class="p">,</span> <span class="n">PromptInjection</span><span class="p">,</span> <span class="n">Toxicity</span>
<span class="kn">from</span> <span class="nn">llm_guard.vault</span> <span class="kn">import</span> <span class="n">Vault</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;OPENAIKEY&quot;</span><span class="p">)</span>
<span class="n">vault</span> <span class="o">=</span> <span class="n">Vault</span><span class="p">()</span>
<span class="n">input_scanners</span> <span class="o">=</span> <span class="p">[</span><span class="n">Anonymize</span><span class="p">(</span><span class="n">vault</span><span class="p">),</span> <span class="n">Toxicity</span><span class="p">(),</span> <span class="n">PromptInjection</span><span class="p">()]</span>

<span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;Make an SQL insert statement to add a new user to our database. Name is John Doe. </span><span class="se">\</span>
<span class="s2">Email is test@test.com Phone number is 555-123-4567 and the IP address is 192.168.1.100. </span><span class="se">\</span>
<span class="s2">And credit card number is 4567-8901-2345-6789.&quot;</span>

<span class="n">sanitized_prompt</span><span class="p">,</span> <span class="n">results_valid</span><span class="p">,</span> <span class="n">results_score</span> <span class="o">=</span> <span class="n">scan_prompt</span><span class="p">(</span><span class="n">input_scanners</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a helpful assistant.&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">sanitized_prompt</span><span class="p">},</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="c1"># Sanitized Prompt: </span>
<span class="c1"># Make an SQL insert statement to add a new user to our database. </span>
<span class="c1"># Name is [REDACTED_PERSON_1]. Email is [REDACTED_EMAIL_ADDRESS_1] Phone number is </span>
<span class="c1"># [REDACTED_PHONE_NUMBER_1] and the IP address is [REDACTED_IP_ADDRESS_1]. </span>
<span class="c1"># And credit card number is [REDACTED_CREDIT_CARD_RE_1].</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluate-llms-with-uptrain">
<h4><span class="section-number">6.1.4. </span>Evaluate LLMs with <code class="docutils literal notranslate"><span class="pre">uptrain</span></code><a class="headerlink" href="#evaluate-llms-with-uptrain" title="Permalink to this heading">#</a></h4>
<p>Evaluating LLMs can be tricky.</p>
<p>Luckily, <code class="docutils literal notranslate"><span class="pre">uptrain</span></code> offers a neat library to do that.</p>
<p><code class="docutils literal notranslate"><span class="pre">uptrain</span></code> is a Python library to evaluate LLMs with 20+ preconfigured checks.</p>
<p>This includes the quality of the responses (completeness, validity,…), language proficiency (tonality, conciseness, …) and code hallucination.</p>
<p>It supports the biggest providers like OpenAI, Mistral, Claude and Ollama.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install uptrain
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">uptrain</span> <span class="kn">import</span> <span class="n">EvalLLM</span><span class="p">,</span> <span class="n">Evals</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="s2">&quot;*******&quot;</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="s1">&#39;Which is the most popular global sport?&#39;</span><span class="p">,</span>
    <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="s2">&quot;The popularity of sports can be measured in various ways, including TV viewership...&quot;</span><span class="p">,</span>
    <span class="s1">&#39;response&#39;</span><span class="p">:</span> <span class="s1">&#39;Football is the most popular sport with around 4 billion followers worldwide&#39;</span>
<span class="p">}]</span>

<span class="n">eval_llm</span> <span class="o">=</span> <span class="n">EvalLLM</span><span class="p">(</span><span class="n">openai_api_key</span><span class="o">=</span><span class="n">OPENAI_API_KEY</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">eval_llm</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">checks</span><span class="o">=</span><span class="p">[</span><span class="n">Evals</span><span class="o">.</span><span class="n">CONTEXT_RELEVANCE</span><span class="p">,</span> <span class="n">Evals</span><span class="o">.</span><span class="n">FACTUAL_ACCURACY</span><span class="p">,</span> <span class="n">Evals</span><span class="o">.</span><span class="n">RESPONSE_COMPLETENESS</span><span class="p">]</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="embed-any-type-of-file">
<h4><span class="section-number">6.1.5. </span>Embed Any Type of File<a class="headerlink" href="#embed-any-type-of-file" title="Permalink to this heading">#</a></h4>
<p>These days, everything is about Embeddings and LLMs.</p>
<p>The Python library <code class="docutils literal notranslate"><span class="pre">embed-anything</span></code> makes it easy to generate embeddings from multiple sources like image, video, or audio.</p>
<p>It’s built in Rust so it executes fast.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install embed-anything
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">embed_anything</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">embed_anything</span><span class="o">.</span><span class="n">embed_file</span><span class="p">(</span><span class="s2">&quot;filename.pdf&quot;</span><span class="p">,</span> <span class="n">embeder</span><span class="o">=</span> <span class="s2">&quot;Bert&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">embed_anything</span><span class="o">.</span><span class="n">embed_directory</span><span class="p">(</span><span class="s2">&quot;test_files&quot;</span><span class="p">,</span> <span class="n">embeder</span><span class="o">=</span> <span class="s2">&quot;Clip&quot;</span><span class="p">)</span>
<span class="n">embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="structured-llm-output-with-outlines">
<h4><span class="section-number">6.1.6. </span>Structured LLM Output with <code class="docutils literal notranslate"><span class="pre">outlines</span></code><a class="headerlink" href="#structured-llm-output-with-outlines" title="Permalink to this heading">#</a></h4>
<p>Are you annoyed of unstructured outputs of LLMs?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">outlines</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">outlines</span></code> is a Python library for structured generation of your LLMs.</p>
<p>There are multiple ways to enforce the output of the model like choices, type constraints, JSON output, and more.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install outlines
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">outlines</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">outlines</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">transformers</span><span class="p">(</span><span class="s2">&quot;mistralai/Mistral-7B-Instruct-v0.2&quot;</span><span class="p">)</span>

<span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You are a sentiment-labelling assistant.</span>
<span class="s2">Is the following review positive or negative?</span>

<span class="s2">Review: This restaurant is just awesome!</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">generator</span> <span class="o">=</span> <span class="n">outlines</span><span class="o">.</span><span class="n">generate</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Positive&quot;</span><span class="p">,</span> <span class="s2">&quot;Negative&quot;</span><span class="p">])</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluating-rag-pipelines-with-ragas">
<h4><span class="section-number">6.1.7. </span>Evaluating RAG Pipelines with <code class="docutils literal notranslate"><span class="pre">Ragas</span></code><a class="headerlink" href="#evaluating-rag-pipelines-with-ragas" title="Permalink to this heading">#</a></h4>
<p>How do you evaluate your RAG application?</p>
<p>Sure, you can look manually over your responses and see if it’s what you want.</p>
<p>But, it’s not scalable.</p>
<p>Instead, use <code class="docutils literal notranslate"><span class="pre">Ragas</span></code> in Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">Ragas</span></code> is a library providing evaluation techniques and metrics for your RAG pipeline like Context Precision/Recall, Faithfulness and answer relevancy.</p>
<p>See below how easy it is to run <code class="docutils literal notranslate"><span class="pre">Ragas</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install ragas
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">Dataset</span> 
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">ragas</span> <span class="kn">import</span> <span class="n">evaluate</span>
<span class="kn">from</span> <span class="nn">ragas.metrics</span> <span class="kn">import</span> <span class="n">faithfulness</span><span class="p">,</span> <span class="n">answer_correctness</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;your-openai-key&quot;</span>

<span class="n">data_samples</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;When was the first super bowl?&#39;</span><span class="p">,</span> <span class="s1">&#39;Who won the most super bowls?&#39;</span><span class="p">],</span>
    <span class="s1">&#39;answer&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;The first superbowl was held on Jan 15, 1967&#39;</span><span class="p">,</span> <span class="s1">&#39;The most super bowls have been won by The New England Patriots&#39;</span><span class="p">],</span>
    <span class="s1">&#39;contexts&#39;</span> <span class="p">:</span> <span class="p">[[</span><span class="s1">&#39;The First AFL–NFL World Championship Game was an American football game played on January 15, 1967, at the Los Angeles Memorial Coliseum in Los Angeles,&#39;</span><span class="p">],</span> 
    <span class="p">[</span><span class="s1">&#39;The Green Bay Packers...Green Bay, Wisconsin.&#39;</span><span class="p">,</span><span class="s1">&#39;The Packers compete...Football Conference&#39;</span><span class="p">]],</span>
    <span class="s1">&#39;ground_truth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;The first superbowl was held on January 15, 1967&#39;</span><span class="p">,</span> <span class="s1">&#39;The New England Patriots have won the Super Bowl a record six times&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_samples</span><span class="p">)</span>

<span class="n">score</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">faithfulness</span><span class="p">,</span><span class="n">answer_correctness</span><span class="p">])</span>
<span class="n">score</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="unified-reranker-api-with-rerankers">
<h4><span class="section-number">6.1.8. </span>Unified Reranker API with <code class="docutils literal notranslate"><span class="pre">rerankers</span></code><a class="headerlink" href="#unified-reranker-api-with-rerankers" title="Permalink to this heading">#</a></h4>
<p>An essential element of your RAG systems is reranking.</p>
<p>Reranking involves a reranking model that outputs a similarity score for each retrieved document and the user query.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">rerankers</span></code> library gives you a unified API to use with popular vendors and models such as Cohere, Jina or T5.</p>
<p>The perfect API to easily test and replace many methods.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install rerankers
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rerankers</span> <span class="kn">import</span> <span class="n">Reranker</span>

<span class="n">ranker</span> <span class="o">=</span> <span class="n">Reranker</span><span class="p">(</span><span class="s2">&quot;t5&quot;</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">ranker</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;I love you&quot;</span><span class="p">,</span> <span class="n">docs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;I hate you&quot;</span><span class="p">,</span> <span class="s2">&quot;I really like you&quot;</span><span class="p">],</span> <span class="n">doc_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-embeddings-on-your-cpu-with-fastembed">
<h4><span class="section-number">6.1.9. </span>Create Embeddings on your CPU with <code class="docutils literal notranslate"><span class="pre">fastembed</span></code><a class="headerlink" href="#create-embeddings-on-your-cpu-with-fastembed" title="Permalink to this heading">#</a></h4>
<p>My favourite library for creating embeddings:</p>
<p><code class="docutils literal notranslate"><span class="pre">fastembed</span></code>, developed by Qdrant.</p>
<p><code class="docutils literal notranslate"><span class="pre">fastembed</span></code> is a lightweight and fast library for using popular embedding models.</p>
<p>Without using your GPU.</p>
<p>It also integrates seamlessly with Qdrant’s vector database.</p>
<p>I would like to see more supported models though, as <code class="docutils literal notranslate"><span class="pre">fastembed</span></code> has so much potential.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install fastembed
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastembed</span> <span class="kn">import</span> <span class="n">TextEmbedding</span>

<span class="n">documents</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;This is some&quot;</span><span class="p">,</span>
    <span class="s2">&quot;example document&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">embedding_model</span> <span class="o">=</span> <span class="n">TextEmbedding</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;jinaai/jina-embeddings-v2-small-en&quot;</span><span class="p">)</span>

<span class="n">embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">embedding_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">documents</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-files-to-markdown-json-with-docling">
<h4><span class="section-number">6.1.10. </span>Convert Files to Markdown &amp; JSON with <code class="docutils literal notranslate"><span class="pre">docling</span></code><a class="headerlink" href="#convert-files-to-markdown-json-with-docling" title="Permalink to this heading">#</a></h4>
<p>Preparing your data for LLMs is a crucial step in RAG applications.</p>
<p><code class="docutils literal notranslate"><span class="pre">docling</span></code> simplifies this step for you by converting popular document formats like PDF or PPT to Markdown or JSON.</p>
<p>It uses two models, layout analyis model and table structure recognition model, to process the files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install docling
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docling.document_converter</span> <span class="kn">import</span> <span class="n">DocumentConverter</span>

<span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;https://arxiv.org/pdf/2408.09869&quot;</span>
<span class="n">converter</span> <span class="o">=</span> <span class="n">DocumentConverter</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">export_to_markdown</span><span class="p">())</span>  
<span class="c1"># Output: &quot;## Docling Technical Report[...]&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="simple-chunking-library-with-chonkie">
<h4><span class="section-number">6.1.11. </span>Simple Chunking Library with <code class="docutils literal notranslate"><span class="pre">chonkie</span></code><a class="headerlink" href="#simple-chunking-library-with-chonkie" title="Permalink to this heading">#</a></h4>
<p>Having a great chunking library without installing 500 MB of subdependencies is my childhood’s dream.</p>
<p>Luckily, <code class="docutils literal notranslate"><span class="pre">chonkie</span></code> provides you with the most important chunking strategies.</p>
<p>Currently, it supports:</p>
<ul class="simple">
<li><p>Token chunker</p></li>
<li><p>Word chunker</p></li>
<li><p>Sentence chunker</p></li>
<li><p>Semantic chunker</p></li>
<li><p>Semantic Double-Pass Merge chunker</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install chonkie
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chonkie</span> <span class="kn">import</span> <span class="n">SemanticChunker</span>

<span class="n">chunker</span> <span class="o">=</span> <span class="n">SemanticChunker</span><span class="p">(</span>
    <span class="n">embedding_model</span><span class="o">=</span><span class="s2">&quot;all-minilm-l6-v2&quot;</span><span class="p">,</span>
    <span class="n">chunk_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
    <span class="n">similarity_threshold</span><span class="o">=</span><span class="mf">0.7</span>
<span class="p">)</span>

<span class="n">chunks</span> <span class="o">=</span> <span class="n">chunker</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="s2">&quot;Some text with semantic meaning to chunk appropriately.&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chunk: </span><span class="si">{</span><span class="n">chunk</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of semantic sentences: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">sentences</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="type-safe-agentic-ai-with-pydantic-ai">
<h4><span class="section-number">6.1.12. </span>Type-Safe Agentic AI with <code class="docutils literal notranslate"><span class="pre">pydantic-ai</span></code><a class="headerlink" href="#type-safe-agentic-ai-with-pydantic-ai" title="Permalink to this heading">#</a></h4>
<p>A type-safe Python agent framework was on my Christmas wishlist.</p>
<p>Luckily, 𝗣𝘆𝗱𝗮𝗻𝘁𝗶𝗰𝗔𝗜 came out earlier.</p>
<p>𝗣𝘆𝗱𝗮𝗻𝘁𝗶𝗰𝗔𝗜 bridges the gap between LLMs and structured data validation.</p>
<p>Type-safety is my favourite feature, while making structured responses and using custom models easy.</p>
<p>Definitely something I have to go much deeper into it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pydantic-ai
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic_ai</span> <span class="kn">import</span> <span class="n">Agent</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>  
    <span class="s1">&#39;gemini-1.5-flash&#39;</span><span class="p">,</span>
    <span class="n">system_prompt</span><span class="o">=</span><span class="s1">&#39;Be concise, reply with one sentence.&#39;</span><span class="p">,</span>  
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="s1">&#39;Where does &quot;hello world&quot; come from?&#39;</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The first known use of &quot;hello, world&quot; was in a 1974 textbook about the C programming language.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-files-into-markdown-with-markitdown">
<h4><span class="section-number">6.1.13. </span>Convert Files into Markdown with <code class="docutils literal notranslate"><span class="pre">markitdown</span></code><a class="headerlink" href="#convert-files-into-markdown-with-markitdown" title="Permalink to this heading">#</a></h4>
<p>Preparing your data for LLMs can be hard.</p>
<p>Different file formats like PPT, Excel or Audio files need different preprocessing steps.</p>
<p>Luckily, with 𝗺𝗮𝗿𝗸𝗶𝘁𝗱𝗼𝘄𝗻 from Microsoft, this is easy.</p>
<p>𝗺𝗮𝗿𝗸𝗶𝘁𝗱𝗼𝘄𝗻 converts various file formats to Markdown:</p>
<p>Currently, it supports:</p>
<ul class="simple">
<li><p>PDF</p></li>
<li><p>PPT</p></li>
<li><p>Word</p></li>
<li><p>Excel</p></li>
<li><p>Images</p></li>
<li><p>Audio</p></li>
<li><p>HTML</p></li>
<li><p>JSON, XML</p></li>
<li><p>ZIP files</p></li>
</ul>
<p>What I really like is that for image descriptions, you can use LLMs and even adjust the prompt for it.</p>
<p>Thanks to Jimi Vaubien for showing me this gem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install markitdown
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">markitdown</span> <span class="kn">import</span> <span class="n">MarkItDown</span>
<span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">()</span>
<span class="n">md</span> <span class="o">=</span> <span class="n">MarkItDown</span><span class="p">(</span><span class="n">llm_client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">llm_model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span> <span class="n">llm_prompt</span><span class="o">=</span><span class="s2">&quot;Describe the image without going into details like colors or shapes.&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;example.jpg&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">text_content</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="route-queries-intelligently-with-routellm">
<h4><span class="section-number">6.1.14. </span>Route Queries Intelligently with <code class="docutils literal notranslate"><span class="pre">RouteLLM</span></code><a class="headerlink" href="#route-queries-intelligently-with-routellm" title="Permalink to this heading">#</a></h4>
<p>Using LLMs like o1/o3 or Claude Sonnet for every task is a waste of money.</p>
<p>For simple tasks, you may switch to a much simpler and lightweight model to save on costs and compute time.</p>
<p>With RouteLLM, queries will be routed intelligently to the right LLM for the job.</p>
<p>RouteLLM acts as a traffic controller for your LLM workflows.</p>
<p>Instead of blindly sending all requests to the most expensive model, it dynamically routes queries based on:
-&gt; Complexity: Simple tasks for smaller, cheaper models
-&gt; Accuracy needs: Critical tasks for heavyweight models</p>
<p>And it’s open-source!</p>
<p>See below for a simple example:
-&gt; We use GPT-4 as our strong model and Mixtral 8x7B as our weak model
-&gt; The router model <strong>router-mf-0.11593</strong> is the default routing model and sufficient for basic query routing. The threshold <strong>0.11593</strong> can be calibrated by yourself if you want to to say that e.g. ~30 % of the queries will be routed to the strong model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install &quot;routellm[serve,eval]&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">routellm.controller</span> <span class="kn">import</span> <span class="n">Controller</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sk-XXXXXX&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;ANYSCALE_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;esecret_XXXXXX&quot;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Controller</span><span class="p">(</span>
  <span class="n">routers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mf&quot;</span><span class="p">],</span>
  <span class="n">strong_model</span><span class="o">=</span><span class="s2">&quot;gpt-4-1106-preview&quot;</span><span class="p">,</span>
  <span class="n">weak_model</span><span class="o">=</span><span class="s2">&quot;anyscale/mistralai/Mixtral-8x7B-Instruct-v0.1&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
  <span class="n">model</span><span class="o">=</span><span class="s2">&quot;router-mf-0.11593&quot;</span><span class="p">,</span>
  <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello!&quot;</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/numpy/index"></span><section id="numpy-tips-and-tricks">
<h2><span class="section-number">7. </span>NumPy Tips and Tricks<a class="headerlink" href="#numpy-tips-and-tricks" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/numpy/Chapter"></span><section id="numpy-tips-and-tricks">
<h3><span class="section-number">7.1. </span>NumPy Tips and Tricks<a class="headerlink" href="#numpy-tips-and-tricks" title="Permalink to this heading">#</a></h3>
<section id="achieve-reproducibility-with-np-random-randomstate">
<h4><span class="section-number">7.1.1. </span>Achieve Reproducibility with <code class="docutils literal notranslate"><span class="pre">np.random.RandomState()</span></code><a class="headerlink" href="#achieve-reproducibility-with-np-random-randomstate" title="Permalink to this heading">#</a></h4>
<p>Reproducibility in Data Science projects is key.</p>
<p>For larger projects, use <code class="docutils literal notranslate"><span class="pre">numpy.random.RandomState()</span></code> to construct a random number generator.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">numpy.random.seed()</span></code> sets the global random seed, which affects all uses to the <code class="docutils literal notranslate"><span class="pre">numpy.random.*</span></code> module.</p>
<p>Imported packages or other modules can reset the global random seed to another one.</p>
<p>This can result in undesirable and unreproducible results across your project.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">numpy.random.RandomState()</span></code>, you are not relying on the global random state anymore (which could be resetted).</p>
<p>It’s a subtle, but important step to achieve reproducibility.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/pandas/index"></span><section id="pandas-tricks-and-tips">
<h2><span class="section-number">8. </span>Pandas Tricks and Tips<a class="headerlink" href="#pandas-tricks-and-tips" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/pandas/Chapter"></span><section id="pandas-tips-and-tricks">
<h3><span class="section-number">8.1. </span>Pandas Tips and Tricks<a class="headerlink" href="#pandas-tips-and-tricks" title="Permalink to this heading">#</a></h3>
<section id="filter-pandas-in-a-readable-format">
<h4><span class="section-number">8.1.1. </span>Filter Pandas in a readable format<a class="headerlink" href="#filter-pandas-in-a-readable-format" title="Permalink to this heading">#</a></h4>
<p>Do you need a more readable way to filter Dataframes in Pandas?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">df.query()</span></code>.</p>
<p>You can specify the condition using a string.</p>
<p>This can be sometimes more convenient and readable than boolean indexing.</p>
<p>And it’s fast, due to the optimized Cython-based code used under the hood.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]})</span>

<span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;A &gt; 1 &amp; B &lt; 6&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-frequency-of-time-series-with-pd-infer-freq">
<h4><span class="section-number">8.1.2. </span>Get frequency of time series with <code class="docutils literal notranslate"><span class="pre">pd.infer_freq</span></code><a class="headerlink" href="#get-frequency-of-time-series-with-pd-infer-freq" title="Permalink to this heading">#</a></h4>
<p>When working with time series, it is useful to know the frequency of the data.</p>
<p>But especially in larger datasets, it might be difficult to tell the frequency immediately.</p>
<p>To get the frequency of a time series in Pandas, use <code class="docutils literal notranslate"><span class="pre">pd.infer_freq()</span></code>.</p>
<p>It infers the most likely frequency given the input index.</p>
<p>Below you can see how to infer the most likely frequency for a <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">time_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1/1/2020 20:00:00&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;10/1/2020 00:00:00&#39;</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">time_index</span><span class="p">)</span>
<span class="s1">&#39;D&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="change-the-plotting-backend">
<h4><span class="section-number">8.1.3. </span>Change the Plotting Backend<a class="headerlink" href="#change-the-plotting-backend" title="Permalink to this heading">#</a></h4>
<p>By default, Pandas uses matplotlib as its plotting backend.</p>
<p>You can change it to, let’s say Plotly, with one line of code.</p>
<p>See below how to do that with only one line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="s1">&#39;plotly&#39;</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">]))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="style-your-dataframes">
<h4><span class="section-number">8.1.4. </span>Style your DataFrames<a class="headerlink" href="#style-your-dataframes" title="Permalink to this heading">#</a></h4>
<p>Did you know you can style your DataFrames in Pandas?</p>
<p>You just have to define a condition to apply colors in a function.</p>
<p>And use <code class="docutils literal notranslate"><span class="pre">DataFrame.style.applymap()</span></code> to apply the condition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">sales_data</span> <span class="o">=</span> <span class="n">sales_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Product Name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Product A&#39;</span><span class="p">,</span> <span class="s1">&#39;Product B&#39;</span><span class="p">,</span> <span class="s1">&#39;Product C&#39;</span><span class="p">,</span> <span class="s1">&#39;Product D&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Revenue&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">sales_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sales_data</span><span class="p">)</span>

<span class="c1"># Apply styles to the dataframe</span>
<span class="k">def</span> <span class="nf">coloring</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mi">10000</span> <span class="k">else</span> <span class="s1">&#39;green&#39;</span>
    <span class="k">return</span> <span class="s1">&#39;background-color: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">color</span>

<span class="n">sales_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">coloring</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Revenue&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-precision-of-displayed-floats">
<h4><span class="section-number">8.1.5. </span>Set Precision of Displayed Floats<a class="headerlink" href="#set-precision-of-displayed-floats" title="Permalink to this heading">#</a></h4>
<p>In Pandas, you can control the precision of the displayed values.</p>
<p>Just use the .set_option() function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.2343129</span><span class="p">,</span> <span class="mf">5.8956701</span><span class="p">,</span> <span class="mf">6.224289</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="faster-i-o-with-parquet">
<h4><span class="section-number">8.1.6. </span>Faster I/O with Parquet<a class="headerlink" href="#faster-i-o-with-parquet" title="Permalink to this heading">#</a></h4>
<p>Whenever you work with bigger datasets, please avoid using CSV format (or similar).</p>
<p>CSV files are text files, which are human-readable, and therefore a popular option to store data.</p>
<p>For small datasets, this is not a big issue.</p>
<p>But, what if your data has millions of rows?</p>
<p>It can get really slow to do read/write operations on them.</p>
<p>On the other side, binary files exist too.</p>
<p>They consist of 0s and 1s and are not meant to be human-readable but to be used by programs that know how to interpret them.</p>
<p>Because of that, binary files are more compact and consume less space.</p>
<p>Parquet is one popular binary file format, which is more memory-efficient than CSVs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Shape: (100000000, 5)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Time: 1m 58s</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data.csv&quot;</span><span class="p">)</span>

<span class="c1"># Time: 8s</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;data.parquet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/pandas/additionallibs"></span><section id="utility-libraries-for-pandas">
<h3><span class="section-number">8.2. </span>Utility Libraries for Pandas<a class="headerlink" href="#utility-libraries-for-pandas" title="Permalink to this heading">#</a></h3>
<section id="speed-up-pandas-apply">
<h4><span class="section-number">8.2.1. </span>Speed up Pandas’ <code class="docutils literal notranslate"><span class="pre">apply()</span></code><a class="headerlink" href="#speed-up-pandas-apply" title="Permalink to this heading">#</a></h4>
<p>Don’t use <code class="docutils literal notranslate"><span class="pre">.apply()</span></code> in Pandas blindly!</p>
<p><code class="docutils literal notranslate"><span class="pre">.apply()</span></code> is used to apply operations on all the elements in a dataframe (row-wise or column-wise).</p>
<p>It’s the most obvious choice, but there is a better option:</p>
<p>Instead, use the <code class="docutils literal notranslate"><span class="pre">𝐒𝐰𝐢𝐟𝐭𝐞𝐫</span></code> package.</p>
<p><code class="docutils literal notranslate"><span class="pre">𝐒𝐰𝐢𝐟𝐭𝐞𝐫</span></code> tries to pick up the best way to implement the <code class="docutils literal notranslate"><span class="pre">.apply()</span></code> function by either:</p>
<ul class="simple">
<li><p>Vectorizing your function</p></li>
<li><p>Parallelizing using Dask</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">.apply()</span></code> from Pandas if the dataset is small.</p></li>
</ul>
<p>That gives your function a huge boost.</p>
<p>In the example below, you only need to add df.swifter.apply() to make use of <code class="docutils literal notranslate"><span class="pre">Swifter</span></code>’s capabilities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install swifter
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">swifter</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">input_value</span><span class="p">):</span>
	<span class="o">...</span>
    <span class="k">return</span> <span class="n">output_value</span>
    
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Column&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Column&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">swifter</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">my_function</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="reduce-dataframe-memory-with-dtype-diet">
<h4><span class="section-number">8.2.2. </span>Reduce DataFrame Memory with <code class="docutils literal notranslate"><span class="pre">dtype_diet</span></code><a class="headerlink" href="#reduce-dataframe-memory-with-dtype-diet" title="Permalink to this heading">#</a></h4>
<p>By default, Pandas DataFrames don’t use the smallest data types for its columns.</p>
<p>This results in unnecessary memory usage.</p>
<p>Changing data types can drastically reduce the memory usage of your DataFrame.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">dtype_diet</span></code>, you can automatically change the data types to the smallest (and most memory-efficient) one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install dtype-diet
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dtype_diet</span> <span class="kn">import</span> <span class="n">optimize_dtypes</span><span class="p">,</span> <span class="n">report_on_dataframe</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="c1"># Get Recommendations</span>
<span class="n">proposed_df</span> <span class="o">=</span> <span class="n">report_on_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;MB&quot;</span><span class="p">)</span>
<span class="n">new_df</span> <span class="o">=</span> <span class="n">optimize_dtypes</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">proposed_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original df memory: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="si">}</span><span class="s1"> MB&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Propsed df memory: </span><span class="si">{</span><span class="n">new_df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="si">}</span><span class="s1"> MB&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="validate-pandas-dataframes-with-pandera">
<h4><span class="section-number">8.2.3. </span>Validate Pandas DataFrames with <code class="docutils literal notranslate"><span class="pre">pandera</span></code><a class="headerlink" href="#validate-pandas-dataframes-with-pandera" title="Permalink to this heading">#</a></h4>
<p>Do you want to validate your Pandas DataFrames?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">pandera</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pandera</span></code> is a data validation library for Pandas DataFrames and Series.</p>
<p>It provides a convenient way to define and enforce data quality constraints.</p>
<p>You can even define complex constraints or use the in-built constraints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pandera
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pandera</span> <span class="k">as</span> <span class="nn">pa</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrameSchema</span><span class="p">({</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">pa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">String</span><span class="p">),</span>
    <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">pa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">Int</span><span class="p">,</span> <span class="n">checks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">pa</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">element_wise</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">pa</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">,</span> <span class="n">element_wise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">]),</span>
<span class="p">})</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="s2">&quot;Charlie&quot;</span><span class="p">],</span>
    <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="n">schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="boost-pandas-performance-with-one-line-with-modin">
<h4><span class="section-number">8.2.4. </span>Boost Pandas’ Performance With One Line With <code class="docutils literal notranslate"><span class="pre">modin</span></code><a class="headerlink" href="#boost-pandas-performance-with-one-line-with-modin" title="Permalink to this heading">#</a></h4>
<p>If you already have a large codebase based on Pandas, think again.</p>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">modin</span></code> as a drop-in replacement for Pandas, with a 3X-5X speed-up.</p>
<p>Just install <code class="docutils literal notranslate"><span class="pre">modin</span></code> and replace the import statement.</p>
<p>It’s maybe not as fast as polars, but you will save hours of development time and gain some performance boost.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install &quot;modin[all]&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">modin.pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="chat-with-your-dataframe-with-pandasai">
<h4><span class="section-number">8.2.5. </span>Chat with your Dataframe with <code class="docutils literal notranslate"><span class="pre">PandasAI</span></code><a class="headerlink" href="#chat-with-your-dataframe-with-pandasai" title="Permalink to this heading">#</a></h4>
<p>You can chat with your Pandas dataframe with a few lines of code.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">PandasAI</span></code>, you can use LLMs to analyze your data, generate visuals, and create a report with your words.</p>
<p>Currently, <code class="docutils literal notranslate"><span class="pre">PandasAI</span></code> supports popular LLMs from providers like OpenAI, Anthropic, Google, Amazon, or Ollama for local LLMs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pandasai
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandasai</span> <span class="kn">import</span> <span class="n">SmartDataframe</span>
<span class="kn">from</span> <span class="nn">pandasai.llm</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">pandasai.helpers.openai_info</span> <span class="kn">import</span> <span class="n">get_openai_callback</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">SmartDataframe</span><span class="p">(</span><span class="s2">&quot;data.csv&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;llm&quot;</span><span class="p">:</span> <span class="n">llm</span><span class="p">,</span> <span class="s2">&quot;conversational&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

<span class="k">with</span> <span class="n">get_openai_callback</span><span class="p">()</span> <span class="k">as</span> <span class="n">cb</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="s2">&quot;Calculate the sum of the gdp of north american countries&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/polars/index"></span><section id="polars">
<h2><span class="section-number">9. </span>Polars<a class="headerlink" href="#polars" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/polars/Chapter"></span><section id="polars-tips-tricks">
<h3><span class="section-number">9.1. </span>Polars Tips &amp; Tricks<a class="headerlink" href="#polars-tips-tricks" title="Permalink to this heading">#</a></h3>
<section id="plugin-for-data-science-functions">
<h4><span class="section-number">9.1.1. </span>Plugin for Data Science Functions<a class="headerlink" href="#plugin-for-data-science-functions" title="Permalink to this heading">#</a></h4>
<p>Polars gains increasing popularity.</p>
<p>If you already ditched pandas for it, you don’t have to rewrite all of your functions in Polars again.</p>
<p><code class="docutils literal notranslate"><span class="pre">polars-ds</span></code>, a community plugin, has reimplemented common functions for Data Scientists like:</p>
<ul class="simple">
<li><p>Statistical tests (t-test, …),</p></li>
<li><p>String similarities (Levenshtein, …)</p></li>
<li><p>Loss Functions and metrics (ROC, R2, L1, Huber, …)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install polars_ds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">polars_ds</span>
<span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Calculate Loss and Metrics</span>
<span class="n">df</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s2">&quot;dummy_groups&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">num_ext</span><span class="o">.</span><span class="n">l2_loss</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;predicted&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;l2&quot;</span><span class="p">),</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">num_ext</span><span class="o">.</span><span class="n">bce</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;predicted&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;log loss&quot;</span><span class="p">),</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">num_ext</span><span class="o">.</span><span class="n">binary_metrics_combo</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;predicted&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;combo&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">unnest</span><span class="p">(</span><span class="s2">&quot;combo&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plugin-for-fitting-linear-models">
<h4><span class="section-number">9.1.2. </span>Plugin for Fitting Linear Models<a class="headerlink" href="#plugin-for-fitting-linear-models" title="Permalink to this heading">#</a></h4>
<p>In Polars, you can fit linear models with the <code class="docutils literal notranslate"><span class="pre">polars-ols</span></code> extension.</p>
<p>You can use ordinary, weighted or regularized least squares like Lasso or Elastic Net.</p>
<p>It can be 2x-88x times faster than popular libraries like sklearn or statsmodels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install polars-ols
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">polars_ols</span> <span class="k">as</span> <span class="nn">pls</span>

<span class="n">lasso_expr</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">least_squares</span><span class="o">.</span><span class="n">lasso</span><span class="p">(</span><span class="s2">&quot;x1&quot;</span><span class="p">,</span> <span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">add_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">)</span>

<span class="n">predictions</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">lasso_expr</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;predictions_lasso&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/pythontricks/index"></span><section id="python-tips-and-tricks">
<h2><span class="section-number">10. </span>Python Tips and Tricks<a class="headerlink" href="#python-tips-and-tricks" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/pythontricks/Chapter"></span><section id="pure-python-built-in-libraries">
<h3><span class="section-number">10.1. </span>Pure Python + Built-in libraries<a class="headerlink" href="#pure-python-built-in-libraries" title="Permalink to this heading">#</a></h3>
<section id="make-your-numbers-more-readable">
<h4><span class="section-number">10.1.1. </span>Make your numbers more readable<a class="headerlink" href="#make-your-numbers-more-readable" title="Permalink to this heading">#</a></h4>
<p>Do you want to make your numbers in Python more readable?</p>
<p>Use underscores such as <code class="docutils literal notranslate"><span class="pre">1_000_000</span></code>.</p>
<p>Underscores in numbers in Python are used to make large numbers more readable.</p>
<p>The underscores are ignored by the interpreter and do not affect the value of the number.</p>
<p>See below for a small example.</p>
<p>Note: Using two consecutive underscores is not allowed!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">big_number</span> <span class="o">=</span> <span class="mi">1_000_000_000_000</span>

<span class="nb">print</span><span class="p">(</span><span class="n">big_number</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-query-parameters-with-urllib-parse">
<h4><span class="section-number">10.1.2. </span>Get Query Parameters with <code class="docutils literal notranslate"><span class="pre">urllib.parse</span></code><a class="headerlink" href="#get-query-parameters-with-urllib-parse" title="Permalink to this heading">#</a></h4>
<p>How to extract query parameters from an URL in Python?</p>
<p>Query parameters are the extra pieces of information you can add to a URL to change how a website behaves.</p>
<p>They come after a ‘q’ character in the URL and are made up of key-value pairs.</p>
<p>The key describes what the information is for and the value is the actual information you want to send.</p>
<p>Query parameters are extra pieces of information that you can add to a URL to change how a website behaves.</p>
<p>To extract those query parameters in Python, use <code class="docutils literal notranslate"><span class="pre">urllib</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">urllib</span></code> provides functions to extract the query and its parameters for you.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://play.google.com/store/apps/details?id=com.happy.mood.diary&amp;hl=de&amp;gl=US&#39;</span>

<span class="c1"># Outputs &quot;id=com.happy.mood.diary&amp;hl=de&amp;gl=US&quot;</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">query</span>

<span class="c1"># Outputs &quot;{&#39;id&#39;: [&#39;com.happy.mood.diary&#39;], &#39;hl&#39;: [&#39;de&#39;], &#39;gl&#39;: [&#39;US&#39;]}&quot;</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">parse_qs</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="zip-iterables-to-the-longest-iterable">
<h4><span class="section-number">10.1.3. </span>Zip iterables to the longest iterable<a class="headerlink" href="#zip-iterables-to-the-longest-iterable" title="Permalink to this heading">#</a></h4>
<p>Don’t use <code class="docutils literal notranslate"><span class="pre">zip()</span></code> in Python.</p>
<p>When you have, let’s say, two lists of unequal length, zip() will return
an iterable with as many elements as the shortest list.</p>
<p>Instead, use <code class="docutils literal notranslate"><span class="pre">itertools.zip_longest()</span></code>.</p>
<p>It will “pad” any shorter lists (or other iterables) with a fill value so that the returned iterable has the same length as the longest iterable.</p>
<p>You will not lose any elements!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">zip_longest</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>

<span class="c1"># zip(): One element is missing</span>
<span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">1 5</span>
<span class="sd">2 6</span>
<span class="sd">3 7</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># zip_longest()</span>
<span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span> <span class="ow">in</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">)</span>
<span class="w">  </span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">1 5</span>
<span class="sd">2 6</span>
<span class="sd">3 7</span>
<span class="sd">4 None</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="improve-readability-with-named-slices">
<h4><span class="section-number">10.1.4. </span>Improve readability with Named slices<a class="headerlink" href="#improve-readability-with-named-slices" title="Permalink to this heading">#</a></h4>
<p>Do you want to make your code more readable in Python?</p>
<p>Use <strong>named slices</strong>.</p>
<p>They are reusable and make your code less messy.</p>
<p>Especially when there is a lot of slicing involved.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LETTERS</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">NUMS</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">CITY</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">code_1</span> <span class="o">=</span> <span class="s2">&quot;LH1234 BLN&quot;</span>
<span class="n">code_2</span> <span class="o">=</span> <span class="s2">&quot;LH7672 MUC&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">code_1</span><span class="p">[</span><span class="n">LETTERS</span><span class="p">],</span> <span class="n">code_1</span><span class="p">[</span><span class="n">NUMS</span><span class="p">],</span> <span class="n">code_1</span><span class="p">[</span><span class="n">CITY</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">code_2</span><span class="p">[</span><span class="n">LETTERS</span><span class="p">],</span> <span class="n">code_2</span><span class="p">[</span><span class="n">NUMS</span><span class="p">],</span> <span class="n">code_2</span><span class="p">[</span><span class="n">CITY</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="pythonic-way-for-matrix-multiplication">
<h4><span class="section-number">10.1.5. </span>Pythonic way for matrix multiplication<a class="headerlink" href="#pythonic-way-for-matrix-multiplication" title="Permalink to this heading">#</a></h4>
<p>Did you know the ‘&#64;’ operator performs 𝐦𝐚𝐭𝐫𝐢𝐱 𝐦𝐮𝐥𝐭𝐢𝐩𝐥𝐢𝐜𝐚𝐭𝐢𝐨𝐧 in Python?</p>
<p>Normally, you would use <code class="docutils literal notranslate"><span class="pre">numpy.matmul()</span></code>.</p>
<p>But since Python 3.5, you can also use the ‘&#64;’ operator as a more readable way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">a</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

<span class="n">a</span> <span class="o">@</span> <span class="n">b</span>

<span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="use-guard-clauses-for-better-if-statements">
<h4><span class="section-number">10.1.6. </span>Use Guard Clauses for better If statements<a class="headerlink" href="#use-guard-clauses-for-better-if-statements" title="Permalink to this heading">#</a></h4>
<p>Stop nesting your If-statements.</p>
<p>Instead, use the <strong>Guard Clause</strong> technique.</p>
<p>The <strong>Guard Clause</strong> pattern says you should terminate a block of code early by checking for invalid inputs or edge cases at the beginning of your functions.</p>
<p>Below you can see how we can make our If-statements more readable by checking for the conditions and immediately return None if it’s  false.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Old way</span>
<span class="k">def</span> <span class="nf">calculate_price</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">price_per_unit</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">price_per_unit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">price_per_unit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    
<span class="c1"># Better way with Guard Clause</span>
<span class="k">def</span> <span class="nf">calculate_price</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">price_per_unit</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">quantity</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">price_per_unit</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">price_per_unit</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="hide-password-input-from-user">
<h4><span class="section-number">10.1.7. </span>Hide Password Input from User<a class="headerlink" href="#hide-password-input-from-user" title="Permalink to this heading">#</a></h4>
<p>Do your Python Command-line apps include collecting secret keys or passwords?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">getpass</span></code>, from the Python Standard Library.</p>
<p><code class="docutils literal notranslate"><span class="pre">getpass</span></code> ensures the user’s inputs will not be echoed back to the screen.</p>
<p>A cool tool for your next Command-line app!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">getpass</span>

<span class="n">username</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2"> is logged in.&quot;</span><span class="p">)</span>

<span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Password entered is: </span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="turn-classes-into-callables">
<h4><span class="section-number">10.1.8. </span>Turn Classes into Callables<a class="headerlink" href="#turn-classes-into-callables" title="Permalink to this heading">#</a></h4>
<p>Did you know you can have callable objects in Python?</p>
<p>You have to override the <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method to call the object like a function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Example</span><span class="p">:</span>
  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I was called!&quot;</span><span class="p">)</span>
    
<span class="n">example_instance</span> <span class="o">=</span> <span class="n">Example</span><span class="p">()</span>
<span class="n">example_instance</span><span class="p">()</span> <span class="c1"># Will call the __call__ method</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="wrap-text-with-textwrap">
<h4><span class="section-number">10.1.9. </span>Wrap Text with <code class="docutils literal notranslate"><span class="pre">textwrap</span></code><a class="headerlink" href="#wrap-text-with-textwrap" title="Permalink to this heading">#</a></h4>
<p>Do you want to format your text output easily?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">textwrap</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">textwrap</span></code> lets you wrap paragraphs, adjust line widths and handle indentation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">textwrap</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec tellus vitae turpis tempus porttitor. Fusce cursus nisi eu urna pharetra, a congue ex aliquet. Quisque vitae consequat nulla, nec bibendum risus.&quot;</span>

<span class="c1"># Wrap text to a specific line width</span>
<span class="n">wrapped_text</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">wrapped_text</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="add-lru-caching-to-your-functions">
<h4><span class="section-number">10.1.10. </span>Add LRU Caching to your Functions<a class="headerlink" href="#add-lru-caching-to-your-functions" title="Permalink to this heading">#</a></h4>
<p>Python offers a neat way to add caching to functions.</p>
<p>You just need to add the <code class="docutils literal notranslate"><span class="pre">lru_cache</span></code> decorator from <code class="docutils literal notranslate"><span class="pre">functools</span></code>.</p>
<p>It takes a <code class="docutils literal notranslate"><span class="pre">maxsize</span></code> argument that specifies the maximum number of results to cache.</p>
<p>When the function is called with the same arguments, it first checks the cache and returns the cached result if available.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fibonacci</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cache-methods-in-classes-with-functools-cached-property">
<h4><span class="section-number">10.1.11. </span>Cache Methods in Classes with <code class="docutils literal notranslate"><span class="pre">functools.cached_property</span></code><a class="headerlink" href="#cache-methods-in-classes-with-functools-cached-property" title="Permalink to this heading">#</a></h4>
<p>To cache the result of a method of a class, use <code class="docutils literal notranslate"><span class="pre">functools.cached_property</span></code>.</p>
<p>It transforms a method into a property where its value is computed only once and then cached.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cached_property</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">expensive_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Perform some expensive computation here</span>
        <span class="k">return</span> <span class="n">result</span>

<span class="n">my_object</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">my_object</span><span class="o">.</span><span class="n">expensive_operation</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="for-else-loops-in-python">
<h4><span class="section-number">10.1.12. </span>For-Else Loops in Python<a class="headerlink" href="#for-else-loops-in-python" title="Permalink to this heading">#</a></h4>
<p>You probably know about If-Else.</p>
<p>But do you know about <code class="docutils literal notranslate"><span class="pre">For-Else</span></code>?</p>
<p>You can add an else-block which will be executed only if the loop completes all its iterations without executing a break statement.</p>
<p>See the small example below, where the else-block will be executed after nothing was found in the for-loop.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;pear&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">fruit</span> <span class="ow">in</span> <span class="n">fruits</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">fruit</span> <span class="o">==</span> <span class="s1">&#39;banana&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found the banana!&quot;</span><span class="p">)</span>
        <span class="k">break</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Banana not found in the list.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="heaps-in-python">
<h4><span class="section-number">10.1.13. </span>Heaps in Python<a class="headerlink" href="#heaps-in-python" title="Permalink to this heading">#</a></h4>
<p>Want an efficient way to retrieve the N smallest/largest elements in Python?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">𝐡𝐞𝐚𝐩𝐪</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">𝐡𝐞𝐚𝐩𝐪</span></code> is a standard library for working with heaps.</p>
<p>A heap is a specialized tree-based data structure that satisfies the heap property.</p>
<p>In a heap, the value of each node is either greater than or equal to (in a max heap) or less than or equal to (in a min heap) the values of its children.</p>
<p>Therefore, retrieving the N smallest/largest elements can be done in a fast way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">heapq</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>

<span class="n">largest</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Largest elements:&quot;</span><span class="p">,</span> <span class="n">largest</span><span class="p">)</span>  <span class="c1"># Output: [9, 8, 7]</span>

<span class="n">smallest</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Smallest elements:&quot;</span><span class="p">,</span> <span class="n">smallest</span><span class="p">)</span>  <span class="c1"># Output: [1, 2, 3]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="difference-between-str-and-repr">
<h4><span class="section-number">10.1.14. </span>Difference between <code class="docutils literal notranslate"><span class="pre">__str__</span></code> and <code class="docutils literal notranslate"><span class="pre">__repr__</span></code><a class="headerlink" href="#difference-between-str-and-repr" title="Permalink to this heading">#</a></h4>
<p>Do you know the difference between <code class="docutils literal notranslate"><span class="pre">__𝐬𝐭𝐫__</span></code> and <code class="docutils literal notranslate"><span class="pre">__𝐫𝐞𝐩𝐫__</span></code>?</p>
<p>In Python, both methods are used to define string representations of an
object.</p>
<p>But, when to use which one for your classes?</p>
<p>The <code class="docutils literal notranslate"><span class="pre">__𝐬𝐭𝐫__</span></code> method is intended to provide a human-readable string representation of the object.</p>
<p>While the <code class="docutils literal notranslate"><span class="pre">__𝐫𝐞𝐩𝐫__</span></code> method is intended to provide a detailed string representation.</p>
<p>See the example below with the built-in datetime library.</p>
<p>We see that the <code class="docutils literal notranslate"><span class="pre">__𝐫𝐞𝐩𝐫__</span></code> method of the datetime class has a detailed and unambiguous output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;str:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="p">))</span>
 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;repr: &quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">today</span><span class="p">))</span>

<span class="c1"># str:   2023-07-02 21:21:00.771969</span>
<span class="c1">#repr:  datetime.datetime(2023, 7, 2, 21, 21, 0, 771969)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="neat-way-to-merge-dictionaries">
<h4><span class="section-number">10.1.15. </span>Neat Way to Merge Dictionaries<a class="headerlink" href="#neat-way-to-merge-dictionaries" title="Permalink to this heading">#</a></h4>
<p>Do you need a clean way to merge two dictionaries in Python?</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">|</span></code> operator (available since Python 3.9)</p>
<p>Unlike other methods (like the .update method or unpacking), it offers a neat way to merge dictionaries.</p>
<p>See below for a small example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dict_1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">dict_2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>

<span class="n">dict_1</span> <span class="o">|</span> <span class="n">dict_2</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="switch-case-statements-in-python">
<h4><span class="section-number">10.1.16. </span>Switch Case Statements in Python<a class="headerlink" href="#switch-case-statements-in-python" title="Permalink to this heading">#</a></h4>
<p>Did you know Python has switch-cases too?</p>
<p>They’re called match-case and it was introduced in Python 3.10+.</p>
<p>It allows you to perform (complex) pattern matching on values and execute code blocks based on the matched patterns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">match_example</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">match</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value is 1&quot;</span><span class="p">)</span>

        <span class="k">case</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value is 2 or 3&quot;</span><span class="p">)</span>
        
        <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value is 4&quot;</span><span class="p">)</span>
        
        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value is something else&quot;</span><span class="p">)</span>

<span class="n">match_example</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="walrus-operator-in-python">
<h4><span class="section-number">10.1.17. </span>Walrus Operator in Python<a class="headerlink" href="#walrus-operator-in-python" title="Permalink to this heading">#</a></h4>
<p>Do you know about the Walrus operator in Python?</p>
<p>The Walrus operator allows you to assign a value to a variable as part of an expression.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># With Walrus Operator</span>
<span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">:=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter your name: &quot;</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello, anonymous!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Without Walrus Operator</span>
<span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter your name: &quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">name</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello, anonymous!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="count-occurrences-in-an-iterable-with-counter">
<h4><span class="section-number">10.1.18. </span>Count Occurrences in an Iterable with <code class="docutils literal notranslate"><span class="pre">Counter</span></code><a class="headerlink" href="#count-occurrences-in-an-iterable-with-counter" title="Permalink to this heading">#</a></h4>
<p>Don’t count the occurrences of elements in your list manually.</p>
<p>Instead, use <code class="docutils literal notranslate"><span class="pre">collections.Counter</span></code> in Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">Counter</span></code> is used for counting the occurrences of elements in an iterable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># With Counter</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;kiwi&quot;</span><span class="p">]</span>

<span class="n">fruit_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">fruits</span><span class="p">)</span>

<span class="c1"># Output: Counter({&#39;apple&#39;: 2, &#39;banana&#39;: 2, &#39;orange&#39;: 1, &#39;kiwi&#39;: 1})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Without Counter</span>
<span class="n">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="s2">&quot;kiwi&quot;</span><span class="p">]</span>

<span class="n">fruit_counts</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">fruit</span> <span class="ow">in</span> <span class="n">fruits</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">fruit</span> <span class="ow">in</span> <span class="n">fruit_counts</span><span class="p">:</span>
        <span class="n">fruit_counts</span><span class="p">[</span><span class="n">fruit</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fruit_counts</span><span class="p">[</span><span class="n">fruit</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-default-values-for-dictionaries-with-defaultdict">
<h4><span class="section-number">10.1.19. </span>Set Default Values for Dictionaries with <code class="docutils literal notranslate"><span class="pre">defaultdict</span></code><a class="headerlink" href="#set-default-values-for-dictionaries-with-defaultdict" title="Permalink to this heading">#</a></h4>
<p>Don’t use dictionaries in Python.</p>
<p>Instead use <code class="docutils literal notranslate"><span class="pre">defaultdicts</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">defaultdict</span></code> is similar to dictionaries, but it allows you to set a default value for new keys that haven’t been added yet.</p>
<p>This is useful when you want to perform operations without checking if a key exists.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
      
<span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<span class="n">d</span><span class="p">[</span><span class="s2">&quot;Fruits&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Kiwi&quot;</span><span class="p">)</span>
<span class="n">d</span><span class="p">[</span><span class="s2">&quot;Cars&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Mercedes&quot;</span><span class="p">)</span>
  
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;Fruits&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;Cars&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;Animals&quot;</span><span class="p">])</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Output:</span>
<span class="sd">[&#39;Kiwi&#39;]</span>
<span class="sd">[&#39;Mercedes&#39;]</span>
<span class="sd">[]</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="more-structured-tuples-with-namedtuple">
<h4><span class="section-number">10.1.20. </span>More Structured Tuples with <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code><a class="headerlink" href="#more-structured-tuples-with-namedtuple" title="Permalink to this heading">#</a></h4>
<p>You don’t know about <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code>?</p>
<p><code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> are similar to regular tuples, but have named fields.</p>
<p>This makes them more self-documenting and easier to work with.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
 
<span class="n">Point</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">3.2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mutable-default-values-for-function-arguments">
<h4><span class="section-number">10.1.21. </span>Mutable Default Values for Function Arguments<a class="headerlink" href="#mutable-default-values-for-function-arguments" title="Permalink to this heading">#</a></h4>
<p>One big mistake in Python:</p>
<p>Using mutable default values for function arguments.</p>
<p>When using mutable objects like a list as a default value, you have to be careful.</p>
<p>See the example below, where the default list is shared among all calls to the function.</p>
<p>To fix this, set the default value to None and create a new list inside the function if no list is provided.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dangerous behaviour:</span>
<span class="k">def</span> <span class="nf">increment_numbers</span><span class="p">(</span><span class="n">numbers</span><span class="o">=</span><span class="p">[]):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Numbers: </span><span class="si">{</span><span class="n">numbers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">increment_numbers</span><span class="p">()</span>  <span class="c1"># Output: Numbers: [0, 1, 2]</span>
<span class="n">increment_numbers</span><span class="p">()</span>  <span class="c1"># Output: Numbers: [0, 1, 2, 0, 1, 2]</span>


<span class="c1"># Better:</span>
<span class="k">def</span> <span class="nf">increment_numbers</span><span class="p">(</span><span class="n">numbers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">numbers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Numbers: </span><span class="si">{</span><span class="n">numbers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">increment_numbers</span><span class="p">()</span>  <span class="c1"># Output: Numbers: [0, 1, 2]</span>
<span class="n">increment_numbers</span><span class="p">()</span>  <span class="c1"># Output: Numbers: [0, 1, 2]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="optimize-your-python-objects-with-slots">
<h4><span class="section-number">10.1.22. </span>Optimize Your Python Objects with <code class="docutils literal notranslate"><span class="pre">__slots__</span></code><a class="headerlink" href="#optimize-your-python-objects-with-slots" title="Permalink to this heading">#</a></h4>
<p>Optimize your Python classes with this trick.</p>
<p>When creating objects, a dynamic dictionary is created too to store instance attributes.</p>
<p>But, what if you know all of your attributes beforehand?</p>
<p>With <code class="docutils literal notranslate"><span class="pre">__𝐬𝐥𝐨𝐭𝐬__</span></code>, you can specify which attributes your object instances will have.</p>
<p>This saves space in memory and prevents users from creating new attributes at runtime.</p>
<p>See below how setting a new instance attribute will throw an error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

<span class="n">point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">point</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># Throws an error</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="modify-print-statements">
<h4><span class="section-number">10.1.23. </span>Modify Print Statements<a class="headerlink" href="#modify-print-statements" title="Permalink to this heading">#</a></h4>
<p>When printing multiple elements in Python, it starts a new line by default.</p>
<p>But, you can change this default to whatever you like by setting the <code class="docutils literal notranslate"><span class="pre">end</span></code> parameter in <code class="docutils literal notranslate"><span class="pre">print()</span></code>.</p>
<p>See below where we change the <code class="docutils literal notranslate"><span class="pre">end</span></code> parameter to space.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sports</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;football&quot;</span><span class="p">,</span> <span class="s2">&quot;basketball&quot;</span><span class="p">,</span> <span class="s2">&quot;volleyball&quot;</span><span class="p">,</span> <span class="s2">&quot;tennis&quot;</span><span class="p">,</span> <span class="s2">&quot;handball&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">sport</span> <span class="ow">in</span> <span class="n">sports</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sport</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="type-variables-in-python-3-12">
<h4><span class="section-number">10.1.24. </span>Type Variables in Python 3.12<a class="headerlink" href="#type-variables-in-python-3-12" title="Permalink to this heading">#</a></h4>
<p>One cool feature in Python 3.12:</p>
<p>The support for Type Variables.</p>
<p>You can use them to parametrize generic classes and functions.</p>
<p>See below for a small example where our generic class is parametrized by T which we indicate with [T].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Stack</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="enumerations-in-python">
<h4><span class="section-number">10.1.25. </span>Enumerations in Python<a class="headerlink" href="#enumerations-in-python" title="Permalink to this heading">#</a></h4>
<p>To make your Python Code cleaner, use <code class="docutils literal notranslate"><span class="pre">Enums</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Enums</span></code> (or enumerations) are a way to represent a set of named values as symbolic names.</p>
<p>It provides a way to work with meaningful names instead of raw integers or weird string constants.</p>
<p>Python supports enums with its standard library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Option 1</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">auto</span>

<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">3</span>
    
<span class="nb">print</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># Output: 1</span>

<span class="c1"># Option 2: auto() assigns unique values starting by 1</span>
<span class="k">class</span> <span class="nc">Status</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">PENDING</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">APPROVED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">REJECTED</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    
<span class="nb">print</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">PENDING</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="c1"># Output: 1</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="never-use-eval">
<h4><span class="section-number">10.1.26. </span>Never use <code class="docutils literal notranslate"><span class="pre">eval</span></code><a class="headerlink" href="#never-use-eval" title="Permalink to this heading">#</a></h4>
<p>One big mistake in Python:</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">eval</span></code> in your code.</p>
<p><code class="docutils literal notranslate"><span class="pre">eval</span></code>, like the name suggests, evaluates a Python expression.</p>
<p>The big problem: One could inject malicious code which will be evaluated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="n">expression</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;5 + 5&quot;</span><span class="p">))</span>

<span class="c1"># DON&#39;T RUN THIS LINE OF CODE</span>
<span class="nb">print</span><span class="p">(</span><span class="n">calculate</span><span class="p">(</span><span class="s2">&quot;__import__(&#39;os&#39;).system(&#39;rm -rf /&#39;)&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="never-use-import">
<h4><span class="section-number">10.1.27. </span>Never use <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">*</span></code><a class="headerlink" href="#never-use-import" title="Permalink to this heading">#</a></h4>
<p>One nooby Python mistake:</p>
<p>Running <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">*</span></code>.</p>
<p>You will only pollute your namespace, leading to potential naming conflicts.</p>
<p>Your code also becomes less readable and maintainable when it’s not clear where each name is coming from.</p>
<p>Remember “<em>Explicit is better than implicit</em>”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ugly</span>
<span class="kn">from</span> <span class="nn">module</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Better</span>
<span class="kn">from</span> <span class="nn">module</span> <span class="kn">import</span> <span class="n">Class1</span><span class="p">,</span> <span class="n">Class2</span><span class="p">,</span> <span class="n">Class3</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="control-what-gets-imported">
<h4><span class="section-number">10.1.28. </span>Control What Gets Imported<a class="headerlink" href="#control-what-gets-imported" title="Permalink to this heading">#</a></h4>
<p>How to control what gets imported when you use <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code> in Python?</p>
<p><code class="docutils literal notranslate"><span class="pre">__all__</span></code> lets you specify which symbols should be imported when you run <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code>.</p>
<p>By defining <code class="docutils literal notranslate"><span class="pre">__all__</span></code> in your module, you can explicitly control what gets exposed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mymodule.py</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;my_function&#39;</span><span class="p">,</span> <span class="s1">&#39;MyClass&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">internal_helper</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># main.py</span>
<span class="kn">from</span> <span class="nn">mymodule</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">my_function</span><span class="p">()</span>
<span class="n">internal_helper</span><span class="p">()</span> <span class="c1"># Error</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="make-fields-keyword-only-in-dataclasses">
<h4><span class="section-number">10.1.29. </span>Make Fields Keyword-Only in <code class="docutils literal notranslate"><span class="pre">dataclasses</span></code><a class="headerlink" href="#make-fields-keyword-only-in-dataclasses" title="Permalink to this heading">#</a></h4>
<p>If you want to have keyword-only fields in Python, use the <code class="docutils literal notranslate"><span class="pre">kw_only</span></code> option from <code class="docutils literal notranslate"><span class="pre">dataclasses</span></code>.</p>
<p>This will throw an error whenever you set parameters without the keyword.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Example</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">example</span> <span class="o">=</span> <span class="n">Example</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">example</span> <span class="o">=</span> <span class="n">Example</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Error  </span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="keyword-only-and-positional-only-arguments">
<h4><span class="section-number">10.1.30. </span>Keyword-only and Positional-only Arguments<a class="headerlink" href="#keyword-only-and-positional-only-arguments" title="Permalink to this heading">#</a></h4>
<p>How do you define keyword-only and positional arguments in Python?</p>
<ul class="simple">
<li><p>𝗞𝗲𝘆𝘄𝗼𝗿𝗱-𝗼𝗻𝗹𝘆 arguments: Specified after an 𝗮𝘀𝘁𝗲𝗿𝗶𝘀𝗸 in the function definition. Perfect for readability and when passing optional arguments to a function.</p></li>
<li><p>𝗣𝗼𝘀𝗶𝘁𝗶𝗼𝗻𝗮𝗹 𝗼𝗻𝗹𝘆: Specified before a 𝘀𝗹𝗮𝘀𝗵 in the function definition. Perfect for functions where argument names may change.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Keyword-only</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s2">&quot;Hello&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">greeting</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>

<span class="c1"># This works:</span>
<span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>

<span class="c1"># This raises an error:</span>
<span class="n">greet</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>

<span class="c1"># Positional-only</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">greeting</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>

<span class="c1"># This works:</span>
<span class="n">greet</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>

<span class="c1"># This raises an error:</span>
<span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/pythontricks/utility"></span><section id="utilities-for-python">
<h3><span class="section-number">10.2. </span>Utilities for Python<a class="headerlink" href="#utilities-for-python" title="Permalink to this heading">#</a></h3>
<section id="speed-up-for-loop-with-joblib-parallel">
<h4><span class="section-number">10.2.1. </span>Speed up For-Loop with <code class="docutils literal notranslate"><span class="pre">joblib.Parallel</span></code><a class="headerlink" href="#speed-up-for-loop-with-joblib-parallel" title="Permalink to this heading">#</a></h4>
<p>Don’t use plain for loops in Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">Joblib</span></code> provides a <code class="docutils literal notranslate"><span class="pre">Parallel</span></code> class to write parallel for loops using multiprocessing.</p>
<p>Below you can see an example of how to use it with all of your processors to speed up your calculations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="k">def</span> <span class="nf">process_image</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
   <span class="o">...</span>
    <span class="k">return</span> <span class="n">image</span>
  
 <span class="n">image_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;path1.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;path2.jpg&quot;</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;multiprocessing&quot;</span><span class="p">)(</span>
  <span class="n">delayed</span><span class="p">(</span><span class="n">process_image</span><span class="p">)(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">image_paths</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="work-with-datetimes-easily-with-pendulum">
<h4><span class="section-number">10.2.2. </span>Work with datetimes easily with <code class="docutils literal notranslate"><span class="pre">pendulum</span></code><a class="headerlink" href="#work-with-datetimes-easily-with-pendulum" title="Permalink to this heading">#</a></h4>
<p>Tired of the difficulties of working with dates and times in Python?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">pendulum</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">pendulum</span></code> takes the built-in <code class="docutils literal notranslate"><span class="pre">datetime</span></code> library from Python to the next level with its intuitive and human-friendly way of handling dates and times.</p>
<p>This includes easy timezone manipulation, daylight saving time calculations, and more!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!pip install pendulum</span>
<span class="kn">import</span> <span class="nn">pendulum</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">pendulum</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">to_iso8601_string</span><span class="p">())</span>
<span class="c1"># Output: 2023-02-08T13:44:23.798316+01:00</span>

<span class="n">now_in_london</span> <span class="o">=</span> <span class="n">pendulum</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="s1">&#39;Europe/London&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">now_in_london</span><span class="p">)</span>
<span class="c1"># Output: 2023-02-08T12:44:23.799317+00:00</span>

<span class="n">past</span> <span class="o">=</span> <span class="n">pendulum</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">past</span><span class="o">.</span><span class="n">diff_for_humans</span><span class="p">())</span>
<span class="c1"># Output: 8 minutes ago</span>

<span class="n">delta</span> <span class="o">=</span> <span class="n">past</span> <span class="o">-</span> <span class="n">pendulum</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">in_words</span><span class="p">())</span>
<span class="c1"># Output: 6 days 23 hours 51 minutes 59 seconds</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="prettify-your-data-structures-with-pprint">
<h4><span class="section-number">10.2.3. </span>Prettify your Data Structures with <code class="docutils literal notranslate"><span class="pre">pprint</span></code><a class="headerlink" href="#prettify-your-data-structures-with-pprint" title="Permalink to this heading">#</a></h4>
<p>Using <code class="docutils literal notranslate"><span class="pre">print()</span></code> on your data structures can give you ugly outputs.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">pprint</span></code>, you can print data structures in a pretty way</p>
<p>Don’t use plain <code class="docutils literal notranslate"><span class="pre">print()</span></code> for printing data structures anymore.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
               <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="s1">&#39;B&#39;</span><span class="p">,</span>
               <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="s1">&#39;C&#39;</span><span class="p">,</span>
               <span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="s1">&#39;D&#39;</span><span class="p">,</span>
               <span class="s1">&#39;e&#39;</span><span class="p">:</span><span class="s1">&#39;E&#39;</span><span class="p">,</span>
               <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="s1">&#39;F&#39;</span><span class="p">,</span>
               <span class="s1">&#39;g&#39;</span><span class="p">:</span><span class="s1">&#39;G&#39;</span><span class="p">,</span>
               <span class="s1">&#39;h&#39;</span><span class="p">:</span><span class="s1">&#39;H&#39;</span><span class="p">,</span>
               <span class="p">})</span>
         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
         <span class="p">]</span>
         
<span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="easy-logging-with-loguru">
<h4><span class="section-number">10.2.4. </span>Easy Logging with <code class="docutils literal notranslate"><span class="pre">loguru</span></code><a class="headerlink" href="#easy-logging-with-loguru" title="Permalink to this heading">#</a></h4>
<p>Are you too lazy for logging?</p>
<p><code class="docutils literal notranslate"><span class="pre">loguru</span></code> makes logging in Python easy.</p>
<p>It comes with pre-built formats and colors so you don’t have to set them manually.</p>
<p>A more elegant alternative to Python’s standard logging module.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;DEBUG message&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;INFO message&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;WARNING message&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;ERROR message&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;CRITICAL message&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-truly-random-numbers">
<h4><span class="section-number">10.2.5. </span>Generate Truly Random Numbers<a class="headerlink" href="#generate-truly-random-numbers" title="Permalink to this heading">#</a></h4>
<p>How to generate <code class="docutils literal notranslate"><span class="pre">truly</span></code> random numbers?</p>
<p>One problem with random number generators in your favourite programming language is:</p>
<p>They are <code class="docutils literal notranslate"><span class="pre">pseudo-random</span></code>.</p>
<p>That means they are generated using a deterministic algorithm.</p>
<p>If you want to generate truly random numbers,</p>
<p>You have to make an API request to <code class="docutils literal notranslate"><span class="pre">random(dot)org</span></code>.</p>
<p>They create random numbers based on atmospheric noise.</p>
<p>See below how you can use it with Python.</p>
<p>What do the Query Parameters mean?</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">num=1</span></code>: Specifies that only one integer should be generated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min=1</span></code>: Specifies that the minimum value for the generated integer should be 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max=1000</span></code>: Specifies that the maximum value for the generated integer should be 1000.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">col=1</span></code>: Specifies that the output should be in a single column. Only useful for displaying purposes when you are generating more than one number.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">base=10</span></code>: Specifies that the generated integers should be in base 10 (decimal).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">format=plain</span></code>: Specifies that the output should be in plain text format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rnd=new</span></code>: Specifies that a new random sequence should be used for each request.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://www.random.org/integers/?num=1&amp;min=1&amp;max=1000&amp;col=1&amp;base=10&amp;format=plain&amp;rnd=new&quot;</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="powerful-dictionaries-with-python-benedict">
<h4><span class="section-number">10.2.6. </span>Powerful Dictionaries with <code class="docutils literal notranslate"><span class="pre">python-benedict</span></code><a class="headerlink" href="#powerful-dictionaries-with-python-benedict" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">python-benedict</span></code> is a library for dictionaries on steroids.</p>
<p>You can access values of your nested dictionary with a neat syntax, perform searching and GroupBy, and much more.</p>
<p>Of course, Pandas offers similar functionalities, but takes also much memory when installing. But 𝐩𝐲𝐭𝐡𝐨𝐧-𝐛𝐞𝐧𝐞𝐝𝐢𝐜𝐭 is more suitable for more unstructured data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install python-benedict
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">benedict</span> <span class="kn">import</span> <span class="n">benedict</span>

<span class="n">my_dict</span> <span class="o">=</span> <span class="n">benedict</span><span class="p">({</span>
    <span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
        <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
        <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;street&#39;</span><span class="p">:</span> <span class="s1">&#39;123 Main St&#39;</span><span class="p">,</span>
            <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">,</span>
            <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="s1">&#39;USA&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="n">my_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person.address.street&quot;</span><span class="p">)</span>

<span class="n">my_dict</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="clear-exception-output-with-pretty-errors">
<h4><span class="section-number">10.2.7. </span>Clear Exception Output with <code class="docutils literal notranslate"><span class="pre">pretty_errors</span></code><a class="headerlink" href="#clear-exception-output-with-pretty-errors" title="Permalink to this heading">#</a></h4>
<p>Are you annoyed by the unclear Python error messages?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">pretty_errors</span></code>.</p>
<p>It’s a library to prettify Python exception output to make it more readable and clear.</p>
<p>It also allows you to configure the output like changing colors, separator character, displaying locals, etc..</p>
<p>You just have to:</p>
<p>Install it: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pretty_errors</span></code>
Import it: <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pretty_errors</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pretty_errors
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pretty_errors</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="deprecate-functions-with-deprecated">
<h4><span class="section-number">10.2.8. </span>Deprecate Functions with <code class="docutils literal notranslate"><span class="pre">deprecated</span></code><a class="headerlink" href="#deprecate-functions-with-deprecated" title="Permalink to this heading">#</a></h4>
<p>How to deprecate functions in Python?</p>
<p>You can use the library <code class="docutils literal notranslate"><span class="pre">deprecation</span></code> which offers decorators to wrap functions.</p>
<p>Proper warnings in documentation and in the console are displayed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install deprecation
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">deprecation</span> <span class="kn">import</span> <span class="n">deprecated</span>

<span class="nd">@deprecated</span><span class="p">(</span><span class="n">deprecated_in</span><span class="o">=</span><span class="s2">&quot;0.10&quot;</span><span class="p">,</span> <span class="n">removed_in</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="n">current_version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="s2">&quot;Use my_func2 instead&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_func</span><span class="p">():</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
  
<span class="n">my_func</span><span class="p">()</span>
<span class="c1"># UnsupportedWarning: my_func is unsupported as of 1.0. Use my_func2 instead</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="case-insensitive-dictionaries">
<h4><span class="section-number">10.2.9. </span>Case Insensitive Dictionaries<a class="headerlink" href="#case-insensitive-dictionaries" title="Permalink to this heading">#</a></h4>
<p>Are you annoyed by case-sensitive dictionaries in Python?</p>
<p>Try 𝐂𝐚𝐬𝐞𝐈𝐧𝐬𝐞𝐧𝐬𝐢𝐭𝐢𝐯𝐞𝐃𝐢𝐜𝐭𝐬.</p>
<p>As the name says, you can access values by the key without paying attention to lowercase or uppercase.</p>
<p>It’s useful for everyone who is scraping API data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">requests.structures</span> <span class="kn">import</span> <span class="n">CaseInsensitiveDict</span>

<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">CaseInsensitiveDict</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Accept&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<span id="document-book/pythontricks/tooling"></span><section id="tooling-for-python-projects">
<h3><span class="section-number">10.3. </span>Tooling for Python Projects<a class="headerlink" href="#tooling-for-python-projects" title="Permalink to this heading">#</a></h3>
<section id="uv-super-fast-pip-alternative">
<h4><span class="section-number">10.3.1. </span><code class="docutils literal notranslate"><span class="pre">uv</span></code>: Super-fast pip Alternative<a class="headerlink" href="#uv-super-fast-pip-alternative" title="Permalink to this heading">#</a></h4>
<p>Forget plain pip for installing packages.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">uv</span></code> for Python package installing.</p>
<p><code class="docutils literal notranslate"><span class="pre">uv</span></code> is a blazingly fast package installer and resolver, written in Rust for high performance.</p>
<p>It is a drop-in replacement for pip and pip-tools, being up to 115x faster.</p>
<p><code class="docutils literal notranslate"><span class="pre">uv</span></code> is still in an early phase, but it’s interesting to see where it goes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!curl -LsSf https://astral.sh/uv/install.sh | sh
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!uv pip install requests
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/selenium/index"></span><section id="scraping-tips-and-tricks">
<h2><span class="section-number">11. </span>Scraping Tips and Tricks<a class="headerlink" href="#scraping-tips-and-tricks" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/selenium/Chapter"></span><section id="scraping-tips-and-tricks">
<h3><span class="section-number">11.1. </span>Scraping Tips and Tricks<a class="headerlink" href="#scraping-tips-and-tricks" title="Permalink to this heading">#</a></h3>
<section id="manage-your-webdrivers-with-webdriver-manager">
<h4><span class="section-number">11.1.1. </span>Manage your Webdrivers with <code class="docutils literal notranslate"><span class="pre">webdriver-manager</span></code><a class="headerlink" href="#manage-your-webdrivers-with-webdriver-manager" title="Permalink to this heading">#</a></h4>
<p>When using <code class="docutils literal notranslate"><span class="pre">Selenium</span></code> with Python, you probably did the following:</p>
<ul class="simple">
<li><p>Download Chromedriver Binary</p></li>
<li><p>Unzip it</p></li>
<li><p>Set the path to the driver</p></li>
</ul>
<p>This is annoying.</p>
<ul class="simple">
<li><p>The Path can be changed</p></li>
<li><p>You have to somehow manage those browser drivers for each OS</p></li>
<li><p>Check if new updates for drivers are released</p></li>
</ul>
<p>Instead of doing this manually, use <code class="docutils literal notranslate"><span class="pre">webdriver-manager</span></code>.</p>
<p>It makes managing binaries for different browsers easy.</p>
<p><code class="docutils literal notranslate"><span class="pre">webdriver-manager</span></code> downloads binaries automatically for you.</p>
<p>So you don’t have to go through the pain of doing it manually.</p>
<p>To use it in your project, see the example below. It’s straightforward and saves you time and energy.</p>
<p>Especially when you integrate <code class="docutils literal notranslate"><span class="pre">Selenium</span></code> in your CI/CD Pipeline.</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">webdriver-manager</span></code> installs the latest version.</p>
<p>But you can also define a specific version of the driver.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install webdriver-manager
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Old way</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="s1">&#39;path/to/driver.exe&#39;</span><span class="p">)</span>

<span class="c1"># New way with webdriver-manager and Selenium 4</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">webdriver_manager.chrome</span> <span class="kn">import</span> <span class="n">ChromeDriverManager</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="n">Service</span><span class="p">(</span><span class="n">ChromeDriverManager</span><span class="p">()</span><span class="o">.</span><span class="n">install</span><span class="p">()))</span>

<span class="c1"># New way with webdriver-manager and Selenium 3</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">webdriver_manager.chrome</span> <span class="kn">import</span> <span class="n">ChromeDriverManager</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">ChromeDriverManager</span><span class="p">()</span><span class="o">.</span><span class="n">install</span><span class="p">())</span>

<span class="c1"># Use specific version</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="n">ChromeDriverManager</span><span class="p">(</span><span class="s2">&quot;&lt;your_version&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">install</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="speed-up-your-scraping-with-disabling-image-loading">
<h4><span class="section-number">11.1.2. </span>Speed up your Scraping with disabling image loading<a class="headerlink" href="#speed-up-your-scraping-with-disabling-image-loading" title="Permalink to this heading">#</a></h4>
<p>Do you want to speed up your web scraper?</p>
<p>Disable image loading!</p>
<p>Disabling image loading while scraping is a great way to speed up your scraper.</p>
<p>You are wasting a lot of connection bandwidth.</p>
<p>To disable image loading in Selenium, you only have to set one option (like below).</p>
<p>This will save you time and money.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">chrome_options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">ChromeOptions</span><span class="p">()</span>

<span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--blink-settings=imagesEnabled=false&#39;</span><span class="p">)</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">chrome_options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>
<span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.instagram.com/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="ai-powered-web-scraper-with-scrapegraph-ai">
<h4><span class="section-number">11.1.3. </span>AI-Powered Web Scraper with <code class="docutils literal notranslate"><span class="pre">scrapegraph-ai</span></code><a class="headerlink" href="#ai-powered-web-scraper-with-scrapegraph-ai" title="Permalink to this heading">#</a></h4>
<p>Do you want to let AI scrape your website?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">scrapegraph-ai</span></code>.</p>
<p>This library uses LLM and direct graph logic to scrape websites by only providing the information you need.</p>
<p>See below where we give it a prompt and an URL.</p>
<p>It also supports multi-page scraper that extracts information from the top n search results of a search engine.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install scrapegraphai
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scrapegraphai.graphs</span> <span class="kn">import</span> <span class="n">SmartScraperGraph</span>

<span class="n">graph_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;llm&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="n">OPENAI_API_KEY</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;temperature&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;verbose&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">smart_scraper_graph</span> <span class="o">=</span> <span class="n">SmartScraperGraph</span><span class="p">(</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;List me all the projects with their descriptions.&quot;</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;https://perinim.github.io/projects/&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">graph_config</span>
<span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Output</span>
<span class="sd">{</span>
<span class="sd">  &quot;projects&quot;: [</span>
<span class="sd">    {</span>
<span class="sd">      &quot;title&quot;: &quot;Rotary Pendulum RL&quot;,</span>
<span class="sd">      &quot;description&quot;: &quot;Open Source project aimed at controlling ...&quot;</span>
<span class="sd">    },</span>
<span class="sd">    {</span>
<span class="sd">      &quot;title&quot;: &quot;DQN Implementation from scratch&quot;,</span>
<span class="sd">      &quot;description&quot;: &quot;Developed a Deep Q-Network algorithm to train a ...&quot;</span>
<span class="sd">    },</span>
<span class="sd">    {</span>
<span class="sd">      &quot;title&quot;: &quot;Multi Agents HAED&quot;,</span>
<span class="sd">      &quot;description&quot;: &quot;University project which focuses ....&quot;</span>
<span class="sd">    },</span>
<span class="sd">    {</span>
<span class="sd">      &quot;title&quot;: &quot;Wireless ESC for Modular Drones&quot;,</span>
<span class="sd">      &quot;description&quot;: &quot;Modular drone architecture ...&quot;</span>
<span class="sd">    }</span>
<span class="sd">  ]</span>
<span class="sd">}</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/terraform/index"></span><section id="terraform">
<h2><span class="section-number">12. </span>Terraform<a class="headerlink" href="#terraform" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/terraform/Chapter"></span><section id="terraform">
<h3><span class="section-number">12.1. </span>Terraform<a class="headerlink" href="#terraform" title="Permalink to this heading">#</a></h3>
<section id="static-code-analyzer-with-tflint">
<h4><span class="section-number">12.1.1. </span>Static Code Analyzer with <code class="docutils literal notranslate"><span class="pre">TFLint</span></code><a class="headerlink" href="#static-code-analyzer-with-tflint" title="Permalink to this heading">#</a></h4>
<p>As your Terraform codebase grows, it’s more prone to errors.</p>
<p>And they can become nasty.</p>
<p>To analyze your files, use <code class="docutils literal notranslate"><span class="pre">TFLint</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">TFLint</span></code> is a linting tool to check for common smells and issues before you even run your code.</p>
<p>You can even define custom rules to tailor it to your team’s standards.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>tflint

Error: &quot;type_abc&quot; is an invalid value as instance_type (aws_instance_invalid_type)

  on main.tf line 15:
   15: instance_type = &quot;invalid_type&quot;
When you run TFLint again, you’ll receive an error message indicating that the
instance_type value is invalid. TFLint identifies this issue without applying the Terraform configuration,
helping you catch errors early in your development workflow.
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-for-security-risks-with-tfsec">
<h4><span class="section-number">12.1.2. </span>Check for Security Risks with <code class="docutils literal notranslate"><span class="pre">Tfsec</span></code><a class="headerlink" href="#check-for-security-risks-with-tfsec" title="Permalink to this heading">#</a></h4>
<p>To check your Terraform files for common security issues, use <code class="docutils literal notranslate"><span class="pre">Tfsec</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">TFsec</span></code> is a static code analyzer to detect security risks, with hundreds of built-in rules.</p>
<p>It’s easy to set-up and run. Perfect for CI pipelines too.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>brew install tfsec
tfsec .

Result #1 CRITICAL Storage account uses an insecure TLS version.
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  deployment/modules/storage_account/main.tf:1-8
   via deployment/main.tf:23-28 (module.storage_account)
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
    1    resource &quot;azurerm_storage_account&quot; &quot;storage_account&quot; {
    2      name                     = var.account_name
    3      resource_group_name      = var.resource_group_name
    4      location                 = var.location
    5      account_kind             = &quot;Storage&quot;
    6      account_tier             = &quot;Standard&quot;
    7      account_replication_type = &quot;LRS&quot;
    8    }
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-least-privileges-with-pike">
<h4><span class="section-number">12.1.3. </span>Generate Least Privileges with <code class="docutils literal notranslate"><span class="pre">Pike</span></code><a class="headerlink" href="#generate-least-privileges-with-pike" title="Permalink to this heading">#</a></h4>
<p>When managing your infrastructure, follow the Principle of Least Privilege (PoLP).</p>
<p>PoLP says that a user should only have the minimum level of access required for a particular resource to function correctly.</p>
<p>For your infrastructure managed by Terraform, you can use 𝐏𝐢𝐤𝐞.</p>
<p>𝐏𝐢𝐤𝐞 is a tool that determines the minimum permissions required to run your Terraform code with one command.</p>
<p>It supports the big cloud providers (Azure, AWS, GCP).</p>
<p>Check it out: github(dot)com/JamesWoolfenden/pike</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!brew tap jameswoolfenden/homebrew-tap
!brew install jameswoolfenden/tap/pike
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pike</span> <span class="n">scan</span> <span class="o">-</span><span class="n">d</span> <span class="o">.</span>\<span class="n">terraform</span>\
<span class="p">{</span>
    <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;ec2:MonitorInstances&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:UnmonitorInstances&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:DescribeInstances&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:DescribeTags&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:DescribeInstanceAttribute&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:DescribeVolumes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:DescribeInstanceTypes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:RunInstances&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:DescribeInstanceCreditSpecifications&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:StopInstances&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:StartInstances&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:ModifyInstanceAttribute&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:TerminateInstances&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:AuthorizeSecurityGroupIngress&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:AuthorizeSecurityGroupEgress&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:CreateSecurityGroup&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:DescribeSecurityGroups&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:DescribeAccountAttributes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:DescribeNetworkInterfaces&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:DeleteSecurityGroup&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec2:RevokeSecurityGroupEgress&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="static-code-analysis-tool-for-iac-with-checkov">
<h4><span class="section-number">12.1.4. </span>Static Code Analysis Tool for IaC with <code class="docutils literal notranslate"><span class="pre">checkov</span></code><a class="headerlink" href="#static-code-analysis-tool-for-iac-with-checkov" title="Permalink to this heading">#</a></h4>
<p>Catch security problems in your Terraform code before they reach production.</p>
<p>This is easy to do with 𝗰𝗵𝗲𝗰𝗸𝗼𝘃.</p>
<p>𝗰𝗵𝗲𝗰𝗸𝗼𝘃 is a static code analysis tool for IaC with over 1000 policies.</p>
<p>As a CLI tool it is perfect for CI/CD pipelines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install checkov
!checkov --directory /user/path/to/iac/code

# check: CKV_AWS_21: &quot;Ensure all data stored in the S3 bucket have versioning enabled&quot;
#   FAILED for resource: aws_s3_bucket.customer
#   File: /tf/tf.json:0-0
#   Guide: https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/s3-policies/s3-16-enable-versioning
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/testing/index"></span><section id="testing-in-python">
<h2><span class="section-number">13. </span>Testing in Python<a class="headerlink" href="#testing-in-python" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/testing/Chapter"></span><section id="testing">
<h3><span class="section-number">13.1. </span>Testing<a class="headerlink" href="#testing" title="Permalink to this heading">#</a></h3>
<section id="pytest-on-steroids-parallelize-your-test-with-pytest-xdist">
<h4><span class="section-number">13.1.1. </span>Pytest on steroids: Parallelize your test with <code class="docutils literal notranslate"><span class="pre">pytest-xdist</span></code><a class="headerlink" href="#pytest-on-steroids-parallelize-your-test-with-pytest-xdist" title="Permalink to this heading">#</a></h4>
<p>Your test suite takes a very long time to run in Python?</p>
<p>With <code class="docutils literal notranslate"><span class="pre">pytest-xdist</span></code> installed, you can run your tests in parallel.</p>
<p>Specify the number of CPUs you want to use with <code class="docutils literal notranslate"><span class="pre">--numprocesses</span></code>.</p>
<p>This allows you to speed up your test executions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pytest-xdist
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pytest --numprocesses 4
</pre></div>
</div>
</div>
</div>
</section>
<section id="shuffle-the-order-of-your-tests-with-pytest-randomly">
<h4><span class="section-number">13.1.2. </span>Shuffle the order of your tests with <code class="docutils literal notranslate"><span class="pre">pytest-randomly</span></code><a class="headerlink" href="#shuffle-the-order-of-your-tests-with-pytest-randomly" title="Permalink to this heading">#</a></h4>
<p>Sometimes it is interesting to run your test cases in a random order to check if there is any test case order dependency.</p>
<p>By running test cases in a random order, you can check if any test cases are dependent on the order of execution.</p>
<p>To do that in Python, try <code class="docutils literal notranslate"><span class="pre">pytest-randomly</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pytest-randomly</span></code> is a pytest plugin to randomly shuffle the order of your tests.</p>
<p>It can be helpful in addition to other test strategies.</p>
<ul class="simple">
<li><p>The output tells you which random seed was used.</p></li>
<li><p>If you want to use that seed again, use the flag <code class="docutils literal notranslate"><span class="pre">--randomly-seed</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pytest-randomly
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pytest 
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-test-coverage-with-pytest-cov">
<h4><span class="section-number">13.1.3. </span>Get Test coverage with <code class="docutils literal notranslate"><span class="pre">pytest-cov</span></code><a class="headerlink" href="#get-test-coverage-with-pytest-cov" title="Permalink to this heading">#</a></h4>
<p>Do you want to measure the test coverage of your code in Python?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">pytest-cov</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pytest-cov</span></code> is a pytest plugin producing test coverage reports for you.</p>
<p>You can see how many statements in your code are covered in a nicely generated report.</p>
<p>Below you can see an example of how to use <code class="docutils literal notranslate"><span class="pre">pytest-cov</span></code>.</p>
<ul class="simple">
<li><p>With the –𝐜𝐨𝐯 flag, you set the path to the module or package you want to measure coverage for.</p></li>
</ul>
<p>-You can also specify the minimum required test coverage percentage using the
<code class="docutils literal notranslate"><span class="pre">--cov-fail-under</span></code> flag.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pytest-cov
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pytest --cov=src --cov-fail-under=90
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">--------------------</span> <span class="n">coverage</span><span class="p">:</span> <span class="o">...</span> <span class="o">---------------------</span>
<span class="n">Name</span>                 <span class="n">Stmts</span>   <span class="n">Miss</span>  <span class="n">Cover</span>
<span class="o">----------------------------------------</span>
<span class="n">src</span><span class="o">/</span><span class="fm">__init__</span>             <span class="mi">2</span>      <span class="mi">0</span>   <span class="mi">100</span><span class="o">%</span>
<span class="n">src</span><span class="o">/</span><span class="n">module1</span><span class="o">.</span><span class="n">py</span>         <span class="mi">257</span>     <span class="mi">13</span>    <span class="mi">94</span><span class="o">%</span>
<span class="n">src</span><span class="o">/</span><span class="n">module2</span><span class="o">.</span><span class="n">py</span>         <span class="mi">100</span>      <span class="mi">0</span>   <span class="mi">100</span><span class="o">%</span>
<span class="o">----------------------------------------</span>
<span class="n">TOTAL</span>                  <span class="mi">359</span>     <span class="mi">13</span>    <span class="mi">97</span><span class="o">%</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-your-plots-with-pytest-mpl">
<h4><span class="section-number">13.1.4. </span>Test your plots with <code class="docutils literal notranslate"><span class="pre">pytest-mpl</span></code><a class="headerlink" href="#test-your-plots-with-pytest-mpl" title="Permalink to this heading">#</a></h4>
<p>How to test your plots in Python?</p>
<p>Nowadays, you can test everything.</p>
<p>Functions, classes, websites, …</p>
<p>But how to make sure to check if your plots are correctly generated in Python?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">pytest-mpl</span></code>!</p>
<p><code class="docutils literal notranslate"><span class="pre">pytest-mpl</span></code> is a Pytest plugin for testing plots created using Matplotlib.</p>
<p>It allows you to compare the output of your Matplotlib plots with expected results by automatically saving them as images and comparing them with pre-saved “baseline” images using image diffing techniques.</p>
<p>Below, you can see an example of how to use <code class="docutils literal notranslate"><span class="pre">pytest-mpl</span></code>.</p>
<ul class="simple">
<li><p>You have to mark the function where you want to compare images with <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.mpl_image_compare</span></code>.</p></li>
<li><p>Provide the <code class="docutils literal notranslate"><span class="pre">--mpl-generate-path</span></code> option with the name of the directory where the baseline images should be saved.</p></li>
<li><p>To test if the images are the same, provide the <code class="docutils literal notranslate"><span class="pre">--mpl</span></code> option.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pytest-mpl
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># testfile.py</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">mpl_image_compare</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test_plotting_line</span><span class="p">():</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X Axis&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y Axis&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pytest -k test_plotting_line --mpl-generate-path=baseline
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pytest --mpl
</pre></div>
</div>
</div>
</div>
</section>
<section id="instantly-show-errors-in-your-test-suite">
<h4><span class="section-number">13.1.5. </span>Instantly show errors in your Test Suite<a class="headerlink" href="#instantly-show-errors-in-your-test-suite" title="Permalink to this heading">#</a></h4>
<p>When you run your tests with <code class="docutils literal notranslate"><span class="pre">pytest</span></code>, it will run all test cases and show you the results at the end.</p>
<p>But you don’t want to wait until the end to see if some tests failed. You want to see the failed tests instantly.</p>
<p><code class="docutils literal notranslate"><span class="pre">pytest-instafail</span></code> is a plugin which shows failures immediately instead of waiting until the end.</p>
<p>See below for an example of how to install and use it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pytest-instafail
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pytest --instafail
</pre></div>
</div>
</div>
</div>
</section>
<section id="limit-pytest-s-output-to-a-minimum">
<h4><span class="section-number">13.1.6. </span>Limit pytest’s output to a minimum<a class="headerlink" href="#limit-pytest-s-output-to-a-minimum" title="Permalink to this heading">#</a></h4>
<p>Do you want to reduce pytest’s chatty output?</p>
<p>Try pytest-tldr.</p>
<p>pytest-tldr is a pytest plugin to limit the output to the most important things.</p>
<p>A nice plugin if you don’t want to be annoyed by pytest’s default output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pytest-tldr
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pytest -v # -v for detailed but clean output
</pre></div>
</div>
</div>
</div>
</section>
<section id="property-based-testing-with-hypothesis">
<h4><span class="section-number">13.1.7. </span>Property-based Testing with <code class="docutils literal notranslate"><span class="pre">hypothesis</span></code><a class="headerlink" href="#property-based-testing-with-hypothesis" title="Permalink to this heading">#</a></h4>
<p>Looking for a smarter way to test your Python code?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">hypothesis</span></code>.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">hypothesis</span></code>, you define properties your code should uphold, and it generates diverse test cases, uncovering edge cases and unexpected bugs.</p>
<p>I encourage you to look into their documentation since it’s really upgrading your testing game.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install hypothesis
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hypothesis</span> <span class="kn">import</span> <span class="n">given</span><span class="p">,</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(),</span> <span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">test_addition_commutative</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">==</span> <span class="n">b</span> <span class="o">+</span> <span class="n">a</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mocking-dependencies-with-pytest-mock">
<h4><span class="section-number">13.1.8. </span>Mocking Dependencies with <code class="docutils literal notranslate"><span class="pre">pytest-mock</span></code><a class="headerlink" href="#mocking-dependencies-with-pytest-mock" title="Permalink to this heading">#</a></h4>
<p>Testing is an essential part of Software projects.</p>
<p>Especially unit testing, where you test the smallest piece of code that can be isolated.</p>
<p>They should be independent, and fast &amp; cheap to execute.</p>
<p>But, what if you have some dependencies like API calls or interactions with databases and systems?</p>
<p>Here’s where mocking comes into play.</p>
<p>Mocking allows you to replace dependencies and real objects with fake ones which mimic the real behavior.</p>
<p>So, you don’t have to rely on the availability of your API, or ask for permission to interact with a database, but you can test your functions isolated and independently.</p>
<p>In Python, you can perform mocking with <code class="docutils literal notranslate"><span class="pre">pytest-mock</span></code>, a wrapper around the built-in mock functionality of Python.</p>
<p>See the example below, where we mock the file removal functionality. We can test it without deleting a file from the disk.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">class</span> <span class="nc">UnixFS</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_unix_fs</span><span class="p">(</span><span class="n">mocker</span><span class="p">):</span>
    <span class="n">mocker</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;os.remove&#39;</span><span class="p">)</span>
    <span class="n">UnixFS</span><span class="o">.</span><span class="n">rm</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="freeze-datetime-module-for-testing-with-freezegun">
<h4><span class="section-number">13.1.9. </span>Freeze Datetime Module For Testing with <code class="docutils literal notranslate"><span class="pre">freezegun</span></code><a class="headerlink" href="#freeze-datetime-module-for-testing-with-freezegun" title="Permalink to this heading">#</a></h4>
<p>When you want to test functions with datetime,</p>
<p>Consider using <code class="docutils literal notranslate"><span class="pre">freezegun</span></code> for Python.</p>
<p><code class="docutils literal notranslate"><span class="pre">freezegun</span></code> mocks the datetime module which makes testing deterministic.</p>
<p>See below how we can specify a date and freeze the return value of datetime.datetime.now().</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install freezegun
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">freezegun</span> <span class="kn">import</span> <span class="n">freeze_time</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="nd">@freeze_time</span><span class="p">(</span><span class="s2">&quot;2015-02-20&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mock-aws-services-with-moto">
<h4><span class="section-number">13.1.10. </span>Mock AWS Services with <code class="docutils literal notranslate"><span class="pre">moto</span></code><a class="headerlink" href="#mock-aws-services-with-moto" title="Permalink to this heading">#</a></h4>
<p>If you have worked with AWS Services and Python,</p>
<p>you know how difficult testing your code can be.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">moto</span></code>, you can easily mock out AWS Services and write your tests without headaches.t</p>
<p>Note: Not all services are covered, so check out the implementation coverage in their repository.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">moto</span> <span class="kn">import</span> <span class="n">mock_aws</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s2">&quot;us-east-1&quot;</span><span class="p">)</span>
        <span class="n">s3</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s2">&quot;mybucket&quot;</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Body</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<span class="nd">@mock_aws</span>
<span class="k">def</span> <span class="nf">test_my_model_save</span><span class="p">():</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s2">&quot;us-east-1&quot;</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s2">&quot;mybucket&quot;</span><span class="p">)</span>
    <span class="n">model_instance</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;testtest&quot;</span><span class="p">)</span>
    <span class="n">model_instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="s2">&quot;mybucket&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s2">&quot;Body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">body</span> <span class="o">==</span> <span class="s2">&quot;testtest&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="clean-output-diff-with-pytest-clarity">
<h4><span class="section-number">13.1.11. </span>Clean Output Diff with <code class="docutils literal notranslate"><span class="pre">pytest-clarity</span></code><a class="headerlink" href="#clean-output-diff-with-pytest-clarity" title="Permalink to this heading">#</a></h4>
<p>Improving the output of pytest with one plugin?</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">pytest-clarity</span></code>.</p>
<p>It brings a coloured diff output which is much cleaner than pytest’s standard output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pytest-clarity
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pytest -vv --diff-width=60
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-environment-variables-with-pytest-env">
<h4><span class="section-number">13.1.12. </span>Using Environment Variables with <code class="docutils literal notranslate"><span class="pre">pytest-env</span></code><a class="headerlink" href="#using-environment-variables-with-pytest-env" title="Permalink to this heading">#</a></h4>
<p>How to use environment variables when testing your code?</p>
<p>It’s important to not mix up your test environment and local environment, especially when you want to define environment variables specifically for your tests.</p>
<p>For this case, use <code class="docutils literal notranslate"><span class="pre">pytest-env</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pytest-env</span></code> is a pytest plugin to define your environment variables in a pytest.ini file.</p>
<p>Those variables will be isolated from the local environment, perfect for writing and running tests.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pytest-env
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest.ini</span>
<span class="p">[</span><span class="n">pytest</span><span class="p">]</span>
<span class="n">env</span> <span class="o">=</span>
    <span class="n">API_KEY</span><span class="o">=</span><span class="n">example</span><span class="o">-</span><span class="n">key</span>
    <span class="n">API_ENDPOINT</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">.</span><span class="n">endpoint</span><span class="o">.</span><span class="n">net</span>
    
<span class="c1"># test_example.py</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">test_load_env_vars</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;example-key&quot;</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;API_ENDPOINT&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">.</span><span class="n">endpoint</span><span class="o">.</span><span class="n">net</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mock-your-file-system-with-pyfakefs">
<h4><span class="section-number">13.1.13. </span>Mock your File system with <code class="docutils literal notranslate"><span class="pre">pyfakefs</span></code><a class="headerlink" href="#mock-your-file-system-with-pyfakefs" title="Permalink to this heading">#</a></h4>
<p>How do you write tests that interact with your filesystem?</p>
<p>This can be tricky, as you don’t want to touch your real disc.</p>
<p>For Python and pytest you can use <code class="docutils literal notranslate"><span class="pre">pyfakefs</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">pyfakefs</span></code> is a pytest plugin that provides an empty in-memory filesystem at each test start.</p>
<p>This allows you to test your file system interactions without breaking anything.</p>
<p>It comes with the fs fixture, which you can use right after installation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install pyfakefs
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">test_fakefs</span><span class="p">(</span><span class="n">fs</span><span class="p">):</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">create_file</span><span class="p">(</span><span class="s2">&quot;/var/data/xx1.txt&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/var/data/xx1.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/sql/index"></span><section id="sql-tips-tricks">
<h2><span class="section-number">14. </span>SQL Tips &amp; Tricks<a class="headerlink" href="#sql-tips-tricks" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/sql/Chapter"></span><section id="sql-tips-tricks">
<h3><span class="section-number">14.1. </span>SQL Tips &amp; Tricks<a class="headerlink" href="#sql-tips-tricks" title="Permalink to this heading">#</a></h3>
<section id="qualify-statement-for-cleaner-queries">
<h4><span class="section-number">14.1.1. </span><code class="docutils literal notranslate"><span class="pre">QUALIFY</span></code> Statement For Cleaner Queries<a class="headerlink" href="#qualify-statement-for-cleaner-queries" title="Permalink to this heading">#</a></h4>
<p>One underrated SQL command: <code class="docutils literal notranslate"><span class="pre">QUALIFY</span></code>.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">QUALIFY</span></code>, you can filter the results of a window function like <code class="docutils literal notranslate"><span class="pre">RANK()</span></code> without needing another <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement.</p>
<p>See the example below where we want to get the 3rd highest earner in every department.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># With QUALIFY</span>
<span class="n">SELECT</span>
  <span class="n">employee_id</span><span class="p">,</span>
  <span class="n">department_id</span><span class="p">,</span>
  <span class="n">salary</span>
  <span class="n">RANK</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">department_id</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">salary</span> <span class="n">DESC</span><span class="p">)</span> <span class="n">AS</span> <span class="n">ranking</span>
<span class="n">FROM</span> 
  <span class="n">employees</span>
<span class="n">QUALIFY</span>
  <span class="n">ranking</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  
<span class="c1"># Without QUALIFY</span>
<span class="n">SELECT</span> <span class="o">*</span>
<span class="n">FROM</span> <span class="p">(</span>
  <span class="n">SELECT</span>
    <span class="n">employee_id</span><span class="p">,</span>
    <span class="n">department_id</span><span class="p">,</span>
    <span class="n">salary</span><span class="p">,</span>
    <span class="n">RANK</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="n">BY</span> <span class="n">department_id</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">salary</span> <span class="n">DESC</span><span class="p">)</span> <span class="n">AS</span> <span class="n">ranking</span>
  <span class="n">FROM</span> 
    <span class="n">employees</span>
<span class="p">)</span> <span class="n">AS</span> <span class="n">rank_employees</span>
<span class="n">WHERE</span>
  <span class="n">ranking</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
<span id="document-book/Miscellaneous/index"></span><section id="miscellaneous">
<h2><span class="section-number">15. </span>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this heading">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-book/Miscellaneous/Chapter"></span><section id="miscellaneous">
<h3><span class="section-number">15.1. </span>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this heading">#</a></h3>
<section id="must-have-vscode-extensions-for-python">
<h4><span class="section-number">15.1.1. </span>Must-Have VSCode Extensions for Python<a class="headerlink" href="#must-have-vscode-extensions-for-python" title="Permalink to this heading">#</a></h4>
<p>Add these 8 must-have VSCode extensions when you work with Python to boost your productivity.</p>
<ol class="arabic simple">
<li><p>𝐏𝐲𝐭𝐡𝐨𝐧 𝐈𝐧𝐝𝐞𝐧𝐭: Makes sure your indentation is correct with every Enter you make</p></li>
<li><p>𝐏𝐲𝐥𝐚𝐧𝐜𝐞: A no-brainer. Includes many benefits like Parameter suggestions, Code navigation, Signature help, and many more. Microsoft declared it as the default language server for Python.</p></li>
<li><p>𝐆𝐢𝐭𝐋𝐞𝐧𝐬: Provides powerful features for your Git experience like seeing when a specific line was committed by whom in which pull request with which commit message. And much more. A must-have!</p></li>
<li><p>𝐉𝐮𝐩𝐲𝐭𝐞𝐫: Notebook supports and allows any Python environment to be used as a Jupyter kernel.</p></li>
<li><p>𝐀𝐑𝐄𝐏𝐋 𝐟𝐨𝐫 𝐏𝐲𝐭𝐡𝐨𝐧: Automatically evaluates Python code in real time as you type. Displays variables and errors in a readable way. Only works for Python &gt;= 3.7.</p></li>
<li><p>𝐏𝐲𝐭𝐡𝐨𝐧 𝐏𝐚𝐭𝐡: Helps you generate internal import statements in a Python project.</p></li>
<li><p>𝐏𝐲𝐭𝐡𝐨𝐧 𝐓𝐞𝐬𝐭 𝐄𝐱𝐩𝐥𝐨𝐫𝐞𝐫: Shows a test explorer without effort instead of going through the output from the terminal.</p></li>
<li><p>𝐚𝐮𝐭𝐨𝐃𝐨𝐜𝐬𝐭𝐫𝐢𝐧𝐠: Quickly generate docstrings for your functions</p></li>
</ol>
</section>
<section id="project-setup-from-templates-with-cookiecutter">
<h4><span class="section-number">15.1.2. </span>Project Setup from Templates with <code class="docutils literal notranslate"><span class="pre">cookiecutter</span></code><a class="headerlink" href="#project-setup-from-templates-with-cookiecutter" title="Permalink to this heading">#</a></h4>
<p>Are you starting a new Data Science Project?</p>
<p>And go through the hassle of setting up the project structure?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">cookiecutter</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">cookiecutter</span></code> is a command-line tool to create projects from templates.</p>
<p>This allows you to save time and have a standardized project structure.</p>
<p>There are tons of <code class="docutils literal notranslate"><span class="pre">cookiecutter</span></code> projects on GitHub you can use.</p>
<p>Say goodbye to tedious project setup.</p>
<p>Link to <code class="docutils literal notranslate"><span class="pre">cookiecutter</span></code> repository: https://github.com/cookiecutter/cookiecutter</p>
<p>Data Science <code class="docutils literal notranslate"><span class="pre">cookiecutter</span></code>: https://github.com/drivendata/cookiecutter-data-science</p>
</section>
<section id="project-scaffolding-with-smol-developer">
<h4><span class="section-number">15.1.3. </span>Project Scaffolding with <code class="docutils literal notranslate"><span class="pre">smol-developer</span></code><a class="headerlink" href="#project-scaffolding-with-smol-developer" title="Permalink to this heading">#</a></h4>
<p>Do you want something like create-react-app, but for anything?</p>
<p>Try <code class="docutils literal notranslate"><span class="pre">smol-developer</span></code> from smol-ai.</p>
<p><code class="docutils literal notranslate"><span class="pre">smol-developer</span></code> scaffolds an entire codebase, based on a Markdown file with your specifications.</p>
<p>You describe, what kind of application you want to develop and it will create the necessary boilerplate code.</p>
<p>Link to Repository: https://github.com/smol-ai/developer</p>
</section>
<section id="well-commits-with-commitizen">
<h4><span class="section-number">15.1.4. </span>Well Commits with <code class="docutils literal notranslate"><span class="pre">commitizen</span></code><a class="headerlink" href="#well-commits-with-commitizen" title="Permalink to this heading">#</a></h4>
<p>Clear and standardized commit messages are important.</p>
<p>But it’s not always easy to have a standardized way in teams.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">commitizen</span></code>, you will get a release management tool designed for teams.</p>
<p>It helps you define committing rules, bump project versions and create a changelog.</p>
<p>It makes your life easier by enforcing writing descriptive commits.</p>
</section>
<section id="docker-best-practice-use-dockerignore">
<h4><span class="section-number">15.1.5. </span>Docker Best Practice: Use <code class="docutils literal notranslate"><span class="pre">.dockerignore</span></code><a class="headerlink" href="#docker-best-practice-use-dockerignore" title="Permalink to this heading">#</a></h4>
<p>One Docker Tip:</p>
<p>Use a <code class="docutils literal notranslate"><span class="pre">.dockerignore</span></code> file to avoid adding unnecessary files to the image.</p>
<p>This will definitely reduce your Docker image size, but also more safe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># .dockerignore
.git
.cache
*.md
!README*.md
README-secret.md
.env
</pre></div>
</div>
</div>
</div>
</section>
</section>
</div>
</section>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/index">1. Code Quality</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/automation">1.1. Automation</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/cicd">1.2. CI/CD</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/codestyle">1.3. Code Style</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/memory">1.4. Memory Optimization</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/security">1.5. Security in Projects</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/typing">1.6. Typing</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/codequality/principles">1.7. Principles for Code Quality</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/cooltools/index">2. Cool Tools</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/cooltools/Chapter">2.1. Cool Tools</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/jupyternotebook/index">3. Jupyter Notebook Tricks and Tips</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/jupyternotebook/Chapter">3.1. Jupyter Notebook Tips and Tricks</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/documentation/index">4. Documentation</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/documentation/Chapter">4.1. Documentation</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/index">5. Machine Learning</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/dataaugmentation">5.1. Data Augmentation</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/deployment">5.2. Deployment</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/eda">5.3. EDA</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/featureselection">5.4. Feature Selection</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/getdata">5.5. Get Data</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/modeltraining">5.6. Model Training</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/outlierdetection">5.7. Outlier Detection</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/timeseries">5.8. Time Series</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/machinelearning/preprocessing">5.9. Preprocessing</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/llm/index">6. LLM</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/llm/Chapter">6.1. LLM</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/numpy/index">7. NumPy Tips and Tricks</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/numpy/Chapter">7.1. NumPy Tips and Tricks</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pandas/index">8. Pandas Tricks and Tips</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pandas/Chapter">8.1. Pandas Tips and Tricks</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pandas/additionallibs">8.2. Utility Libraries for Pandas</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/polars/index">9. Polars</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/polars/Chapter">9.1. Polars Tips &amp; Tricks</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pythontricks/index">10. Python Tips and Tricks</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pythontricks/Chapter">10.1. Pure Python + Built-in libraries</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pythontricks/utility">10.2. Utilities for Python</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/pythontricks/tooling">10.3. Tooling for Python Projects</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/selenium/index">11. Scraping Tips and Tricks</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/selenium/Chapter">11.1. Scraping Tips and Tricks</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/terraform/index">12. Terraform</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/terraform/Chapter">12.1. Terraform</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/testing/index">13. Testing in Python</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/testing/Chapter">13.1. Testing</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/sql/index">14. SQL Tips &amp; Tricks</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/sql/Chapter">14.1. SQL Tips &amp; Tricks</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/Miscellaneous/index">15. Miscellaneous</a><ul class="visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="README.html#document-book/Miscellaneous/Chapter">15.1. Miscellaneous</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Banias Baabe
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>